From mboxrd@z Thu Jan  1 00:00:00 1970
Received: from mail-pf1-f181.google.com (mail-pf1-f181.google.com [209.85.210.181])
	(using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 191FF20DC8
	for <linux-kernel@vger.kernel.org>; Tue, 19 Mar 2024 16:33:26 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=209.85.210.181
ARC-Seal: i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1710866008; cv=none; b=RU3Nb4EHmmrREr7QjFDCI+Y1UXnxQakKMuU43Gr/sJieJBbi//X1TV2BmFYVSKNSKPLaqHaMiQiqhXq1lE6vKrgivUrciEq3A2DnjgMmRdOyg6kDAZkDD3vHk2ogAYdUk0ad+vD1yEL1vWaHWkCo8Kr1BdZz2gyd3Nm69l4X+sA=
ARC-Message-Signature: i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1710866008; c=relaxed/simple;
	bh=PeIAsruLzkLKeE08ndyRTXfNaTUHjpsUFBRVrP/igeQ=;
	h=Date:From:To:Cc:Subject:Message-ID:References:MIME-Version:
	 Content-Type:Content-Disposition:In-Reply-To; b=Gqm2tRbUqaBvrLr5zHBIZMTvN0Y0Ge+Ny4g8pEofYDRtHXlefuHsnSmmhuGkRHiw0oREtZwM24g624j1ZVjg/nTCL5YkG79u9kb4b7YHPCsL+Uah2tOAjsuCeLNXkrNNIrE979DOfLjmxGvAB1o5nlhOzievBkdyny5ErRTNzGg=
ARC-Authentication-Results: i=1; smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=linaro.org; spf=pass smtp.mailfrom=linaro.org; dkim=pass (2048-bit key) header.d=linaro.org header.i=@linaro.org header.b=P1INXCQ6; arc=none smtp.client-ip=209.85.210.181
Authentication-Results: smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=linaro.org
Authentication-Results: smtp.subspace.kernel.org; spf=pass smtp.mailfrom=linaro.org
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (2048-bit key) header.d=linaro.org header.i=@linaro.org header.b="P1INXCQ6"
Received: by mail-pf1-f181.google.com with SMTP id d2e1a72fcca58-6e6f6d782e4so3687249b3a.0
        for <linux-kernel@vger.kernel.org>; Tue, 19 Mar 2024 09:33:26 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=linaro.org; s=google; t=1710866006; x=1711470806; darn=vger.kernel.org;
        h=in-reply-to:content-transfer-encoding:content-disposition
         :mime-version:references:message-id:subject:cc:to:from:date:from:to
         :cc:subject:date:message-id:reply-to;
        bh=21zEQnfxcYpMdB2q3MtSkNSfUlYefH4UFBDqIUczato=;
        b=P1INXCQ6Sj05vE1MDcr1mcdBElgam/U8b5vHWQuP4n1qRQi19d9KKAO7R8znZBLgnc
         Fr72Shr6MmTXNZJFaMA3ddDfunj/q+6AJ+p/lpLdm+P5TX3UMBTMZd2nAO2W53dUuYCD
         OJMEsWCYhj/sifr6jjJtZZK+IJOxWcgT+3HEffxzfMXE4BZfvMbKuBwN/FfWBQpVibjX
         qEcAAKyR88g2rIOb1MtzjZ1WU2dAuNrTZpyr3rDMkIftgFyPXme86DlxJ4/90lg0IOKb
         iUflrYDbv+ijBAAQ4w+vsR5Q2+IKiybz7ytx9ctS/9o00S1QlJ8xgM+CrXa7jx4UXLRS
         UC4Q==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1710866006; x=1711470806;
        h=in-reply-to:content-transfer-encoding:content-disposition
         :mime-version:references:message-id:subject:cc:to:from:date
         :x-gm-message-state:from:to:cc:subject:date:message-id:reply-to;
        bh=21zEQnfxcYpMdB2q3MtSkNSfUlYefH4UFBDqIUczato=;
        b=kYAVaHh63ATHyXoNAaSeJy73+JVaaDNDtiO4w+cmvrj1seJm5eailDHmlSWkHfJ6Hv
         KUMprMxLjDs/x1Hlz0pZvdJDMlAKbcX1kxljdnxWerqgvaymSgq6thW5IgV73AvUj0Bf
         TfS5esaocyt16zRkyrv+c6FXZavPR1CTrW74ePJbq4H2GXZYsvBu++BWqsaNvEJoAtkH
         rYsfHQ40hyw9xzJHfPrxo2IecdT8Ea8VnCG/38WS9zhc7jDIBGdDV9rOV7yPNwA/5imd
         rLVuJ0C7kBCxJ82RZLF0mF47R9/oP2Q5//4WDNLHqpaxupe+l08x08nlnLOe2lbV7arb
         aj4Q==
X-Forwarded-Encrypted: i=1; AJvYcCWyIZi8bPd+6Bwwq4M0UsdEQO5NNrdgm9hIF1B9onjg2H/T5JYGeFA5JjJj5aAumfq1PPVfGMbReSD+srgtWcQ8Okn4XuvNAHw8NLK4
X-Gm-Message-State: AOJu0Yw0Arm1asX7/SvppaH6VkzsNwRGn/DmilRqISUveVMsVL20FXKJ
	NNINDXz5ri1g0RcGCVCkpHHqQpNOIjEfLos82/FA+AFRdSZDPPL+wnj46Ro6HQ==
X-Google-Smtp-Source: AGHT+IGdOZw8YS4SHpor1EHU9P51zW05feF5360p5IkyjhPjT10QsmUSI91PX9X2UnQj0tJ6FnFOuQ==
X-Received: by 2002:aa7:8883:0:b0:6e6:b32c:501d with SMTP id z3-20020aa78883000000b006e6b32c501dmr17160677pfe.19.1710866005021;
        Tue, 19 Mar 2024 09:33:25 -0700 (PDT)
Received: from thinkpad ([120.56.201.52])
        by smtp.gmail.com with ESMTPSA id lb3-20020a056a004f0300b006e664031f10sm10042675pfb.51.2024.03.19.09.33.18
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Tue, 19 Mar 2024 09:33:24 -0700 (PDT)
Date: Tue, 19 Mar 2024 22:03:15 +0530
From: 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org>
To: Shradha Todi <shradha.t@samsung.com>
Cc: bp@alien8.de, tony.luck@intel.com, james.morse@arm.com,
	mchehab@kernel.org, rric@kernel.org, lpieralisi@kernel.org,
	kw@linux.com, robh@kernel.org, bhelgaas@google.com,
	jingoohan1@gmail.com, gustavo.pimentel@synopsys.com,
	josh@joshtriplett.org, lukas.bulwahn@gmail.com,
	hongxing.zhu@nxp.com, pankaj.dubey@samsung.com,
	linux-kernel@vger.kernel.org, linux-pci@vger.kernel.org,
	vidyas@nvidia.com, gost.dev@samsung.com, alim.akhtar@samsung.com
Subject: Re: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
 controller
Message-ID: <20240319163315.GD3297@thinkpad>
References: <CGME20231130115055epcas5p4e29befa80877be45dbee308846edc0ba@epcas5p4.samsung.com>
 <20231130115044.53512-1-shradha.t@samsung.com>
 <20231130165514.GW3043@thinkpad>
 <000601da3e07$c39e5e00$4adb1a00$@samsung.com>
 <20240104055030.GA3031@thinkpad>
 <0df701da5ff0$df1165a0$9d3430e0$@samsung.com>
 <20240216134921.GH2559@thinkpad>
 <120d01da657e$66b9d3b0$342d7b10$@samsung.com>
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <120d01da657e$66b9d3b0$342d7b10$@samsung.com>

On Thu, Feb 22, 2024 at 04:30:47PM +0530, Shradha Todi wrote:
> + Borislav, Tony, James, Mauro, Robert
> 
> Hi All,
> 
> Synopsys DesignWare PCIe controllers have a vendor specific capability (which
> means that this set of registers are only present in DesignWare controllers)
> to perform debug operations called "RASDES".
> The functionalities provided by this extended capability are:
> 
> 1. Debug: This has some debug related diagnostic features like holding LTSSM
> in certain states, reading the status of lane detection, checking if any PCIe
> lanes are broken (RX Valid) and so on. It's a debug only feature used for diagnostic
> use-cases.
> 
> 2. Error Injection: This is a way to inject certain errors in PCIe like LCRC, ECRC,
> Bad TLPs and so on. Again, this is a debug feature and generally not used in
> functional use-case.
> 
> 3. Statistical counters: This has 3 parts
>  - Error counters
>  - Non error counters (covered as part of perf [1])
>  - Time based analysis counters (covered as part of perf [1])
> 
> Selective features of  the above functionality has been implemented
> by vendor specific PCIe controller drivers (pcie-tegra194.c) that use
> Synopsys DesignWare PCIe controllers.
> In order to make it useful to all vendors using DWC controller, we had
> proposed a common implementation in DWC PCIe controller directory
> (drivers/pci/controller/dwc/) and our original idea was based on debugfs
> filesystem. v1 and v2 are mentioned in [2] and [3].
> 
> We got a suggestion to implement this as part of EDAC framework [3] and
> we looked into the same. But as far as I understood, what I am trying to
> implement is a very specific feature (only valid for Synopsys DWC PCIe controllers).
> This doesn't seem to fit in very well with the EDAC framework and we can 
> hardly use any of the EDAC framework APIs. We tried implementing a
> "pci_driver" but since a function driver will already be running on the EP and
> portdrv on the root-complex, we will not be able to bind 2 drivers to a single
> PCI device (root-complex or endpoint). Ultimately, what I will be doing is
> writing a platform driver with debugfs entries which will be present in EDAC
> directory instead of DWC directory.
> 
> Can  you please help us out by going through this thread [3] and letting us
> know if our understanding is wrong at any point. If you think it is a better
> idea to integrate this in the EDAC framework, can you guide me as
> to how I can utilize the framework better?
> Please let me know if you need any other information to conclude.
> 
> [1] https://lore.kernel.org/linux-pci/20231121013400.18367-1-xueshuai@linux.alibaba.com/
> [2] https://lore.kernel.org/all/20210518174618.42089-1-shradha.t@samsung.com/T/
> [3] https://lore.kernel.org/all/20231130115044.53512-1-shradha.t@samsung.com/
> 

Gentle ping for the EDAC maintainers.

- Mani

> Thanks,
> Shradha
> 
> > -----Original Message-----
> > From: 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org>
> > Sent: 16 February 2024 19:19
> > To: Shradha Todi <shradha.t@samsung.com>
> > Cc: lpieralisi@kernel.org; kw@linux.com; robh@kernel.org;
> > bhelgaas@google.com; jingoohan1@gmail.com;
> > gustavo.pimentel@synopsys.com; josh@joshtriplett.org;
> > lukas.bulwahn@gmail.com; hongxing.zhu@nxp.com;
> > pankaj.dubey@samsung.com; linux-kernel@vger.kernel.org; linux-
> > pci@vger.kernel.org; vidyas@nvidia.com; gost.dev@samsung.com
> > Subject: Re: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
> > controller
> > 
> > On Thu, Feb 15, 2024 at 02:55:06PM +0530, Shradha Todi wrote:
> > >
> > >
> > 
> > [...]
> > 
> > > > For the error injection and counters, we already have the EDAC
> > > > framework. So adding them in the DWC driver doesn't make sense to me.
> > > >
> > >
> > > Sorry for late response, was going through the EDAC framework to understand
> > better how we can fit RAS DES support in it. Below are some technical challenges
> > found so far:
> > > 1: This debugfs framework proposed [1] can run on both side of the link i.e. RC
> > and EP as it will be a part of the link controller platform driver. Here for the EP
> > side the assumption is that it has Linux running, which is primarily a use case for
> > chip-to-chip communication.  After your suggestion to migrate to EDAC
> > framework we studied and here are the findings:
> > > - If we move to EDAC framework, we need to have RAS DES as a
> > > pci_driver which will be binded based on vendor_id and device_id. Our
> > > observation is that on EP side system we are unable to bind two
> > > function driver (pci_driver), as pci_endpoint_test function driver or
> > > some other chip-to-chip function driver will already be bound. On the
> > > other hand, on RC side we observed that if we have portdrv enabled in
> > > Linux running on RC system, it gets bound to RC controller and then it
> > > does not allow EDAC pci_driver to bind. So basically we see a problem
> > > here, that we can't have two pci_driver binding to same PCI device
> > > 2: Another point is even though we use EDAC driver framework, we may not be
> > able to use any of EDAC framework APIs as they are mostly suitable for memory
> > controller devices sitting on PCI BUS. We will end up using debugfs entries just via
> > a pci_driver placed inside EDAC framework.
> > 
> > Please wrap your replies to 80 characters.
> > 
> > There is no need to bind the edac driver to VID:PID of the device. The edac driver
> > can be a platform driver and you can instantiate the platform device from the
> > DWC driver. This way, the PCI device can be assocaited with whatever driver, but
> > still there can be a separate edac driver for handling errors.
> > 
> > Regarding API limitation, you should ask the maintainer about the possibility of
> > extending them.
> > 
> > >
> > > Please let me know if my understanding is wrong.
> > >
> > > > But first check with the perf driver author if they have any plans
> > > > on adding the proposed functionality. If they do not have any plan
> > > > or not working on it, then look into EDAC.
> > > >
> > > > - Mani
> > > >
> > >
> > > Since we already worked and posted patches [1], [2], we will continue to work
> > on this and based on consent from community we will adopt to most suitable
> > framework.
> > > We see many subsystems like ethernet, usb, gpu, cxl having debugfs files that
> > give information about the current status of the running system and as of now
> > based on our findings, we still feel there is no harm in having debugfs entry based
> > support in DesignWare controller driver itself.
> > 
> > There is no issue in exposing the debug information through debugfs, that's the
> > sole purpose of the interface. But here, you are trying to add support for DWC
> > RAS feature for which a dedicated framework already exists.
> > 
> > And there will be more similar requests coming for vendor specific error protocols
> > as well. So your investigation could benefit everyone.
> > 
> > From your above investigation, looks like there are some shortcomings of the
> > EDAC framework. So let's get that clarified by writing to the EDAC maintainers
> > (keep us in CC). If the EDAC maintainer suggests you to add support for this
> > feature in DWC driver itself citing some reasons, then no issues with me.
> > 
> > - Mani
> > 
> > --
> > மணிவண்ணன் சதாசிவம்
> 
> 

-- 
மணிவண்ணன் சதாசிவம்

From mboxrd@z Thu Jan  1 00:00:00 1970
Received: from frasgout.his.huawei.com (frasgout.his.huawei.com [185.176.79.56])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 7841A3BB35;
	Wed, 20 Mar 2024 10:01:54 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=185.176.79.56
ARC-Seal: i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1710928917; cv=none; b=DHTb496axEGGMzumU4tAtlq3zbLBXebwmBOm3cN7MYZH7+aQ7mQFW60Bo4sT7wTN02Bf2xzsPgmNhS3PkOMl+rm2/MHpaKQzxSmdxo8sN4I55+C6bhZCkjSqmNV97m/YQajBeqdb7CTysPzaWZiGyssKpoivZ/wVzSA32vztvw4=
ARC-Message-Signature: i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1710928917; c=relaxed/simple;
	bh=5tEz/6rWjOymYkie4hlvcP8h52XbYzxHTb9B+0fX4rc=;
	h=Date:From:To:CC:Subject:Message-ID:In-Reply-To:References:
	 MIME-Version:Content-Type; b=ggIsCchDAHFQ0kUsSJS9egbl6aB/aKyEJYkW+F9kt+cJ+vVaCewXYhK0Vs4WTf8LK9sHVDzum/DlYmZn7cCbygRl/dW3uP+7ffAI5L82nnyUv2fOEdYn410g6ZWdk7MVTBt+bgsfd2YWJQbDYdPIEoY09Kwq6SJpOATuKI/t7UI=
ARC-Authentication-Results: i=1; smtp.subspace.kernel.org; dmarc=pass (p=quarantine dis=none) header.from=Huawei.com; spf=pass smtp.mailfrom=huawei.com; arc=none smtp.client-ip=185.176.79.56
Authentication-Results: smtp.subspace.kernel.org; dmarc=pass (p=quarantine dis=none) header.from=Huawei.com
Authentication-Results: smtp.subspace.kernel.org; spf=pass smtp.mailfrom=huawei.com
Received: from mail.maildlp.com (unknown [172.18.186.231])
	by frasgout.his.huawei.com (SkyGuard) with ESMTP id 4V03yL3r2bz6K5Zq;
	Wed, 20 Mar 2024 18:01:14 +0800 (CST)
Received: from lhrpeml500005.china.huawei.com (unknown [7.191.163.240])
	by mail.maildlp.com (Postfix) with ESMTPS id 97D2B140D26;
	Wed, 20 Mar 2024 18:01:46 +0800 (CST)
Received: from localhost (10.202.227.76) by lhrpeml500005.china.huawei.com
 (7.191.163.240) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.1.2507.35; Wed, 20 Mar
 2024 10:01:45 +0000
Date: Wed, 20 Mar 2024 10:01:44 +0000
From: Jonathan Cameron <Jonathan.Cameron@Huawei.com>
To: 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org>
CC: Shradha Todi <shradha.t@samsung.com>, <bp@alien8.de>,
	<tony.luck@intel.com>, <james.morse@arm.com>, <mchehab@kernel.org>,
	<rric@kernel.org>, <lpieralisi@kernel.org>, <kw@linux.com>,
	<robh@kernel.org>, <bhelgaas@google.com>, <jingoohan1@gmail.com>,
	<gustavo.pimentel@synopsys.com>, <josh@joshtriplett.org>,
	<lukas.bulwahn@gmail.com>, <hongxing.zhu@nxp.com>,
	<pankaj.dubey@samsung.com>, <linux-kernel@vger.kernel.org>,
	<linux-pci@vger.kernel.org>, <vidyas@nvidia.com>, <gost.dev@samsung.com>,
	<alim.akhtar@samsung.com>, <shiju.jose@huawei.com>, "Terry Bowman"
	<Terry.Bowman@amd.com>
Subject: Re: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
 controller
Message-ID: <20240320100144.0000056c@Huawei.com>
In-Reply-To: <20240319163315.GD3297@thinkpad>
References: <CGME20231130115055epcas5p4e29befa80877be45dbee308846edc0ba@epcas5p4.samsung.com>
	<20231130115044.53512-1-shradha.t@samsung.com>
	<20231130165514.GW3043@thinkpad>
	<000601da3e07$c39e5e00$4adb1a00$@samsung.com>
	<20240104055030.GA3031@thinkpad>
	<0df701da5ff0$df1165a0$9d3430e0$@samsung.com>
	<20240216134921.GH2559@thinkpad>
	<120d01da657e$66b9d3b0$342d7b10$@samsung.com>
	<20240319163315.GD3297@thinkpad>
Organization: Huawei Technologies Research and Development (UK) Ltd.
X-Mailer: Claws Mail 4.1.0 (GTK 3.24.33; x86_64-w64-mingw32)
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-ClientProxiedBy: lhrpeml500006.china.huawei.com (7.191.161.198) To
 lhrpeml500005.china.huawei.com (7.191.163.240)

On Tue, 19 Mar 2024 22:03:15 +0530
'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org> wrote:

> On Thu, Feb 22, 2024 at 04:30:47PM +0530, Shradha Todi wrote:
> > + Borislav, Tony, James, Mauro, Robert
> >=20
> > Hi All,
> >=20
> > Synopsys DesignWare PCIe controllers have a vendor specific capability =
(which
> > means that this set of registers are only present in DesignWare control=
lers)
> > to perform debug operations called "RASDES".
> > The functionalities provided by this extended capability are:
> >=20
> > 1. Debug: This has some debug related diagnostic features like holding =
LTSSM
> > in certain states, reading the status of lane detection, checking if an=
y PCIe
> > lanes are broken (RX Valid) and so on. It's a debug only feature used f=
or diagnostic
> > use-cases.
> >=20
> > 2. Error Injection: This is a way to inject certain errors in PCIe like=
 LCRC, ECRC,
> > Bad TLPs and so on. Again, this is a debug feature and generally not us=
ed in
> > functional use-case.
> >=20
> > 3. Statistical counters: This has 3 parts
> >  - Error counters
> >  - Non error counters (covered as part of perf [1])
> >  - Time based analysis counters (covered as part of perf [1])
> >=20
> > Selective features of  the above functionality has been implemented
> > by vendor specific PCIe controller drivers (pcie-tegra194.c) that use
> > Synopsys DesignWare PCIe controllers.
> > In order to make it useful to all vendors using DWC controller, we had
> > proposed a common implementation in DWC PCIe controller directory
> > (drivers/pci/controller/dwc/) and our original idea was based on debugfs
> > filesystem. v1 and v2 are mentioned in [2] and [3].
> >=20
> > We got a suggestion to implement this as part of EDAC framework [3] and
> > we looked into the same. But as far as I understood, what I am trying to
> > implement is a very specific feature (only valid for Synopsys DWC PCIe =
controllers).

For error part there are (at least superficially) similar features in the P=
CIe
standard that we've started thinking about how to support.

See Flit Logging Extended capablity (7.7.8 in PCIe Base Spec rev6.
That has the benefit that they are part of the standard so we can
support them directly in portdrv / EP drivers using some library code in the
PCI core.

There are other interconnect and PCI PMU drivers that log retries etc which=
 are also basically error
counts. At least some of that is done through perf today.=20


> > This doesn't seem to fit in very well with the EDAC framework and we ca=
n=20
> > hardly use any of the EDAC framework APIs. We tried implementing a
> > "pci_driver" but since a function driver will already be running on the=
 EP and
> > portdrv on the root-complex, we will not be able to bind 2 drivers to a=
 single
> > PCI device (root-complex or endpoint). Ultimately, what I will be doing=
 is
> > writing a platform driver with debugfs entries which will be present in=
 EDAC
> > directory instead of DWC directory.

The addition of this type of functionality to pordrv is a long running ques=
tion.
Everyone wants a solution, I believe some people are looking at it (+CC Ter=
ry)

Terry, another case for your long list.

For the EP end, this should be fired up by the EP driver, whilst it might be
infrastructure used on a bunch of devices,  it is a feature of that particu=
lar
EP - so you'd want to provide any functionality in a form that could be used
by both the EP driver and a nice shiny new portdrv replacement.

> >=20
> > Can  you please help us out by going through this thread [3] and lettin=
g us
> > know if our understanding is wrong at any point. If you think it is a b=
etter
> > idea to integrate this in the EDAC framework, can you guide me as
> > to how I can utilize the framework better?
> > Please let me know if you need any other information to conclude.
> >=20
> > [1] https://lore.kernel.org/linux-pci/20231121013400.18367-1-xueshuai@l=
inux.alibaba.com/
> > [2] https://lore.kernel.org/all/20210518174618.42089-1-shradha.t@samsun=
g.com/T/
> > [3] https://lore.kernel.org/all/20231130115044.53512-1-shradha.t@samsun=
g.com/
> >  =20
>=20
> Gentle ping for the EDAC maintainers.
>=20
> - Mani
>=20
> > Thanks,
> > Shradha
> >  =20
> > > -----Original Message-----
> > > From: 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org>
> > > Sent: 16 February 2024 19:19
> > > To: Shradha Todi <shradha.t@samsung.com>
> > > Cc: lpieralisi@kernel.org; kw@linux.com; robh@kernel.org;
> > > bhelgaas@google.com; jingoohan1@gmail.com;
> > > gustavo.pimentel@synopsys.com; josh@joshtriplett.org;
> > > lukas.bulwahn@gmail.com; hongxing.zhu@nxp.com;
> > > pankaj.dubey@samsung.com; linux-kernel@vger.kernel.org; linux-
> > > pci@vger.kernel.org; vidyas@nvidia.com; gost.dev@samsung.com
> > > Subject: Re: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
> > > controller
> > >=20
> > > On Thu, Feb 15, 2024 at 02:55:06PM +0530, Shradha Todi wrote: =20
> > > >
> > > > =20
> > >=20
> > > [...]
> > >  =20
> > > > > For the error injection and counters, we already have the EDAC
> > > > > framework. So adding them in the DWC driver doesn't make sense to=
 me.
> > > > > =20
> > > >
> > > > Sorry for late response, was going through the EDAC framework to un=
derstand =20
> > > better how we can fit RAS DES support in it. Below are some technical=
 challenges
> > > found so far: =20
> > > > 1: This debugfs framework proposed [1] can run on both side of the =
link i.e. RC =20
> > > and EP as it will be a part of the link controller platform driver. H=
ere for the EP
> > > side the assumption is that it has Linux running, which is primarily =
a use case for
> > > chip-to-chip communication.  After your suggestion to migrate to EDAC
> > > framework we studied and here are the findings: =20
> > > > - If we move to EDAC framework, we need to have RAS DES as a
> > > > pci_driver which will be binded based on vendor_id and device_id. O=
ur
> > > > observation is that on EP side system we are unable to bind two
> > > > function driver (pci_driver), as pci_endpoint_test function driver =
or
> > > > some other chip-to-chip function driver will already be bound. On t=
he
> > > > other hand, on RC side we observed that if we have portdrv enabled =
in
> > > > Linux running on RC system, it gets bound to RC controller and then=
 it
> > > > does not allow EDAC pci_driver to bind. So basically we see a probl=
em
> > > > here, that we can't have two pci_driver binding to same PCI device
> > > > 2: Another point is even though we use EDAC driver framework, we ma=
y not be =20
> > > able to use any of EDAC framework APIs as they are mostly suitable fo=
r memory
> > > controller devices sitting on PCI BUS. We will end up using debugfs e=
ntries just via
> > > a pci_driver placed inside EDAC framework.
> > >=20
> > > Please wrap your replies to 80 characters.
> > >=20
> > > There is no need to bind the edac driver to VID:PID of the device. Th=
e edac driver
> > > can be a platform driver and you can instantiate the platform device =
from the
> > > DWC driver. This way, the PCI device can be assocaited with whatever =
driver, but
> > > still there can be a separate edac driver for handling errors.
> > >=20
> > > Regarding API limitation, you should ask the maintainer about the pos=
sibility of
> > > extending them.
> > >  =20
> > > >
> > > > Please let me know if my understanding is wrong.
> > > > =20
> > > > > But first check with the perf driver author if they have any plans
> > > > > on adding the proposed functionality. If they do not have any plan
> > > > > or not working on it, then look into EDAC.
> > > > >
> > > > > - Mani
> > > > > =20
> > > >
> > > > Since we already worked and posted patches [1], [2], we will contin=
ue to work =20
> > > on this and based on consent from community we will adopt to most sui=
table
> > > framework. =20
> > > > We see many subsystems like ethernet, usb, gpu, cxl having debugfs =
files that =20
> > > give information about the current status of the running system and a=
s of now
> > > based on our findings, we still feel there is no harm in having debug=
fs entry based
> > > support in DesignWare controller driver itself.
> > >=20
> > > There is no issue in exposing the debug information through debugfs, =
that's the
> > > sole purpose of the interface. But here, you are trying to add suppor=
t for DWC
> > > RAS feature for which a dedicated framework already exists.
> > >=20
> > > And there will be more similar requests coming for vendor specific er=
ror protocols
> > > as well. So your investigation could benefit everyone.
> > >=20
> > > From your above investigation, looks like there are some shortcomings=
 of the
> > > EDAC framework. So let's get that clarified by writing to the EDAC ma=
intainers
> > > (keep us in CC). If the EDAC maintainer suggests you to add support f=
or this
> > > feature in DWC driver itself citing some reasons, then no issues with=
 me.
> > >=20
> > > - Mani
> > >=20
> > > --
> > > =E0=AE=AE=E0=AE=A3=E0=AE=BF=E0=AE=B5=E0=AE=A3=E0=AF=8D=E0=AE=A3=E0=AE=
=A9=E0=AF=8D =E0=AE=9A=E0=AE=A4=E0=AE=BE=E0=AE=9A=E0=AE=BF=E0=AE=B5=E0=AE=
=AE=E0=AF=8D =20
> >=20
> >  =20
>=20


From mboxrd@z Thu Jan  1 00:00:00 1970
Received: from mail-yw1-f177.google.com (mail-yw1-f177.google.com [209.85.128.177])
	(using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 75B403D0D9
	for <linux-kernel@vger.kernel.org>; Fri, 22 Mar 2024 10:46:29 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=209.85.128.177
ARC-Seal: i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1711104391; cv=none; b=XtVMjyy2akid2iDvoijRJRSiu0DGHY9iMuuuf6a45sFeVVqytlp0Z6WTDkjgDNW3Ki9/X1BDi2ttclME8Ey+FCfwQBlSdSp/aH6OpQOUOzD7H6QH7ElVNHRK+XUN/nGMcDEROf1w5HhQvON1MlsEMS9PuJt/l32g3l/P+yOyf+w=
ARC-Message-Signature: i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1711104391; c=relaxed/simple;
	bh=QGR7xcLql5isKboVB8Rcqcg5AQuhvZfEMrcZLfakR7M=;
	h=Date:From:To:Cc:Subject:Message-ID:References:MIME-Version:
	 Content-Type:Content-Disposition:In-Reply-To; b=NM2xcXNL/y1h8Bwqy5ZT7NcVgy5FQOqaTkkMfwDspo9WuOkY/8Lf04XYXA+LUvdK3IIE14b92UMDHKZfnBZ0mHxD+biT2vuluTAJy7ez/nMYdS3uKLQvEpIZGQ1JleTr0EDwFhqKRYHrKTEo4pGw7eazGg9Iz5miZnTr5Tv1fek=
ARC-Authentication-Results: i=1; smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=linaro.org; spf=pass smtp.mailfrom=linaro.org; dkim=pass (2048-bit key) header.d=linaro.org header.i=@linaro.org header.b=tKuYgS6G; arc=none smtp.client-ip=209.85.128.177
Authentication-Results: smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=linaro.org
Authentication-Results: smtp.subspace.kernel.org; spf=pass smtp.mailfrom=linaro.org
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (2048-bit key) header.d=linaro.org header.i=@linaro.org header.b="tKuYgS6G"
Received: by mail-yw1-f177.google.com with SMTP id 00721157ae682-60a0579a931so21101087b3.0
        for <linux-kernel@vger.kernel.org>; Fri, 22 Mar 2024 03:46:29 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=linaro.org; s=google; t=1711104388; x=1711709188; darn=vger.kernel.org;
        h=in-reply-to:content-transfer-encoding:content-disposition
         :mime-version:references:message-id:subject:cc:to:from:date:from:to
         :cc:subject:date:message-id:reply-to;
        bh=97wDgtdQd/tbYmjqEKsHUC2QXzy0inSI9dKHg+PWn5c=;
        b=tKuYgS6GuGgMeeOIuhcgKQU0ESAl2O9Jry9wWLkxXZo/TP/JNEnTxhAFWy6xq0Lsk7
         iNnAKDKb02qVSYJrhEXdBkKd9ZXUgNR3QdMtkll2Hk8kLAN/vCM1wYRKYzV6/gQkjklE
         jTN07p9cE5/k7msyy9R9KeHrohq4U9jpXNEh4TxSI01Tyoo2Hi9taiuyklgRkox6QMQE
         IrtLsl9iCVn5YXswbkQ/RZi7r5CdZiNhrAs1u0xmT2w9D4OevOJ6kEw6pj/nLSG+tnNy
         mK7GdPTwDABZYJWmkN6TD7JjXuNx3p3PSdyO2Y2ecDgOG5HMhHKg1MYENGDTNHrZBR5n
         RuDg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1711104388; x=1711709188;
        h=in-reply-to:content-transfer-encoding:content-disposition
         :mime-version:references:message-id:subject:cc:to:from:date
         :x-gm-message-state:from:to:cc:subject:date:message-id:reply-to;
        bh=97wDgtdQd/tbYmjqEKsHUC2QXzy0inSI9dKHg+PWn5c=;
        b=dEaRG2wQ0++7D53oC4qz0l3lBWtwRmjT6qC0j+raRQ8d1BRGZ+BNTzoXCtFhOzOs6J
         HGjtQR2c3rLMQEJOf/d7j0E8OQOYom2MCVHJ3lQ8QmioUdoDD2GIfkR+6RKFrh1ucM4/
         u93i+kwjZXg2g4oqSTV9X1V6A2t2qlO9pghGGPLt2P1svPtV0yXDHwiv0QnizqKt3tjD
         YCdaaQ+Iu26ZpGj7BcqWgZU0BS9fRlJlreXF/oc9D8L35HCCx7v5AfhybqY4+ljmUES6
         VUvMhA05kjyemvyrDjC+ojYF3eCluJokC3NjDnrs0N4q/Pb/u7PUolsl/G5HNVncwrQk
         QVVg==
X-Forwarded-Encrypted: i=1; AJvYcCUXthfTaRmmXIu4Qxh6gL4hQfJo0yIz+gSkBbAlXyaDdZwoCLYqNLDc/uFjPirJ0BtGHTnsXkhwTHIJcKY3ZMESglkPjUur9wGoaORL
X-Gm-Message-State: AOJu0YzDiMzd9EWLlYJDMYAdAKaDNEQPJQ6Tqm0u9JmpZP017mc0VauU
	+v653L3XajDtaQYITSGVeUfU3gnIJbOfHvgsCBPXXbT4bpO5dlkc2MaYQXjaOJU/1E38jLLMRI8
	=
X-Google-Smtp-Source: AGHT+IHCtSqnlRUT3IQHM6cO7aExK3dHje4/hrZRKFBm1rkVrshemniCoiZ/NZDXGu4R1cb/6z9avQ==
X-Received: by 2002:a05:6a20:d38c:b0:1a3:579f:2c5c with SMTP id iq12-20020a056a20d38c00b001a3579f2c5cmr2534308pzb.53.1711103998405;
        Fri, 22 Mar 2024 03:39:58 -0700 (PDT)
Received: from thinkpad ([2409:40f4:101a:4667:2dab:fb9d:47a0:28fe])
        by smtp.gmail.com with ESMTPSA id x6-20020a170902ec8600b001ddb57a4dffsm1554671plg.132.2024.03.22.03.39.37
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Fri, 22 Mar 2024 03:39:57 -0700 (PDT)
Date: Fri, 22 Mar 2024 16:09:35 +0530
From: 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org>
To: Jonathan Cameron <Jonathan.Cameron@Huawei.com>
Cc: Shradha Todi <shradha.t@samsung.com>, bp@alien8.de, tony.luck@intel.com,
	james.morse@arm.com, mchehab@kernel.org, rric@kernel.org,
	lpieralisi@kernel.org, kw@linux.com, robh@kernel.org,
	bhelgaas@google.com, jingoohan1@gmail.com,
	gustavo.pimentel@synopsys.com, josh@joshtriplett.org,
	lukas.bulwahn@gmail.com, hongxing.zhu@nxp.com,
	pankaj.dubey@samsung.com, linux-kernel@vger.kernel.org,
	linux-pci@vger.kernel.org, vidyas@nvidia.com, gost.dev@samsung.com,
	alim.akhtar@samsung.com, shiju.jose@huawei.com,
	Terry Bowman <Terry.Bowman@amd.com>
Subject: Re: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
 controller
Message-ID: <20240322103935.GD3638@thinkpad>
References: <CGME20231130115055epcas5p4e29befa80877be45dbee308846edc0ba@epcas5p4.samsung.com>
 <20231130115044.53512-1-shradha.t@samsung.com>
 <20231130165514.GW3043@thinkpad>
 <000601da3e07$c39e5e00$4adb1a00$@samsung.com>
 <20240104055030.GA3031@thinkpad>
 <0df701da5ff0$df1165a0$9d3430e0$@samsung.com>
 <20240216134921.GH2559@thinkpad>
 <120d01da657e$66b9d3b0$342d7b10$@samsung.com>
 <20240319163315.GD3297@thinkpad>
 <20240320100144.0000056c@Huawei.com>
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <20240320100144.0000056c@Huawei.com>

On Wed, Mar 20, 2024 at 10:01:44AM +0000, Jonathan Cameron wrote:
> On Tue, 19 Mar 2024 22:03:15 +0530
> 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org> wrote:
> 
> > On Thu, Feb 22, 2024 at 04:30:47PM +0530, Shradha Todi wrote:
> > > + Borislav, Tony, James, Mauro, Robert
> > > 
> > > Hi All,
> > > 
> > > Synopsys DesignWare PCIe controllers have a vendor specific capability (which
> > > means that this set of registers are only present in DesignWare controllers)
> > > to perform debug operations called "RASDES".
> > > The functionalities provided by this extended capability are:
> > > 
> > > 1. Debug: This has some debug related diagnostic features like holding LTSSM
> > > in certain states, reading the status of lane detection, checking if any PCIe
> > > lanes are broken (RX Valid) and so on. It's a debug only feature used for diagnostic
> > > use-cases.
> > > 
> > > 2. Error Injection: This is a way to inject certain errors in PCIe like LCRC, ECRC,
> > > Bad TLPs and so on. Again, this is a debug feature and generally not used in
> > > functional use-case.
> > > 
> > > 3. Statistical counters: This has 3 parts
> > >  - Error counters
> > >  - Non error counters (covered as part of perf [1])
> > >  - Time based analysis counters (covered as part of perf [1])
> > > 
> > > Selective features of  the above functionality has been implemented
> > > by vendor specific PCIe controller drivers (pcie-tegra194.c) that use
> > > Synopsys DesignWare PCIe controllers.
> > > In order to make it useful to all vendors using DWC controller, we had
> > > proposed a common implementation in DWC PCIe controller directory
> > > (drivers/pci/controller/dwc/) and our original idea was based on debugfs
> > > filesystem. v1 and v2 are mentioned in [2] and [3].
> > > 
> > > We got a suggestion to implement this as part of EDAC framework [3] and
> > > we looked into the same. But as far as I understood, what I am trying to
> > > implement is a very specific feature (only valid for Synopsys DWC PCIe controllers).
> 
> For error part there are (at least superficially) similar features in the PCIe
> standard that we've started thinking about how to support.
> 
> See Flit Logging Extended capablity (7.7.8 in PCIe Base Spec rev6.
> That has the benefit that they are part of the standard so we can
> support them directly in portdrv / EP drivers using some library code in the
> PCI core.
> 

Sounds good. But v6 is a relatively new version and the DWC RAS predates that.
So we still need to support it somehow (either in EDAC or in
drivers/pci/controller/dwc).

> There are other interconnect and PCI PMU drivers that log retries etc which are also basically error
> counts. At least some of that is done through perf today. 
> 

IMO all the RAS support should be exposed through EDAC, otherwise it defeats the
purpose of the subsystem.

- Mani

> 
> > > This doesn't seem to fit in very well with the EDAC framework and we can 
> > > hardly use any of the EDAC framework APIs. We tried implementing a
> > > "pci_driver" but since a function driver will already be running on the EP and
> > > portdrv on the root-complex, we will not be able to bind 2 drivers to a single
> > > PCI device (root-complex or endpoint). Ultimately, what I will be doing is
> > > writing a platform driver with debugfs entries which will be present in EDAC
> > > directory instead of DWC directory.
> 
> The addition of this type of functionality to pordrv is a long running question.
> Everyone wants a solution, I believe some people are looking at it (+CC Terry)
> 
> Terry, another case for your long list.
> 
> For the EP end, this should be fired up by the EP driver, whilst it might be
> infrastructure used on a bunch of devices,  it is a feature of that particular
> EP - so you'd want to provide any functionality in a form that could be used
> by both the EP driver and a nice shiny new portdrv replacement.
> 
> > > 
> > > Can  you please help us out by going through this thread [3] and letting us
> > > know if our understanding is wrong at any point. If you think it is a better
> > > idea to integrate this in the EDAC framework, can you guide me as
> > > to how I can utilize the framework better?
> > > Please let me know if you need any other information to conclude.
> > > 
> > > [1] https://lore.kernel.org/linux-pci/20231121013400.18367-1-xueshuai@linux.alibaba.com/
> > > [2] https://lore.kernel.org/all/20210518174618.42089-1-shradha.t@samsung.com/T/
> > > [3] https://lore.kernel.org/all/20231130115044.53512-1-shradha.t@samsung.com/
> > >   
> > 
> > Gentle ping for the EDAC maintainers.
> > 
> > - Mani
> > 
> > > Thanks,
> > > Shradha
> > >   
> > > > -----Original Message-----
> > > > From: 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org>
> > > > Sent: 16 February 2024 19:19
> > > > To: Shradha Todi <shradha.t@samsung.com>
> > > > Cc: lpieralisi@kernel.org; kw@linux.com; robh@kernel.org;
> > > > bhelgaas@google.com; jingoohan1@gmail.com;
> > > > gustavo.pimentel@synopsys.com; josh@joshtriplett.org;
> > > > lukas.bulwahn@gmail.com; hongxing.zhu@nxp.com;
> > > > pankaj.dubey@samsung.com; linux-kernel@vger.kernel.org; linux-
> > > > pci@vger.kernel.org; vidyas@nvidia.com; gost.dev@samsung.com
> > > > Subject: Re: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
> > > > controller
> > > > 
> > > > On Thu, Feb 15, 2024 at 02:55:06PM +0530, Shradha Todi wrote:  
> > > > >
> > > > >  
> > > > 
> > > > [...]
> > > >   
> > > > > > For the error injection and counters, we already have the EDAC
> > > > > > framework. So adding them in the DWC driver doesn't make sense to me.
> > > > > >  
> > > > >
> > > > > Sorry for late response, was going through the EDAC framework to understand  
> > > > better how we can fit RAS DES support in it. Below are some technical challenges
> > > > found so far:  
> > > > > 1: This debugfs framework proposed [1] can run on both side of the link i.e. RC  
> > > > and EP as it will be a part of the link controller platform driver. Here for the EP
> > > > side the assumption is that it has Linux running, which is primarily a use case for
> > > > chip-to-chip communication.  After your suggestion to migrate to EDAC
> > > > framework we studied and here are the findings:  
> > > > > - If we move to EDAC framework, we need to have RAS DES as a
> > > > > pci_driver which will be binded based on vendor_id and device_id. Our
> > > > > observation is that on EP side system we are unable to bind two
> > > > > function driver (pci_driver), as pci_endpoint_test function driver or
> > > > > some other chip-to-chip function driver will already be bound. On the
> > > > > other hand, on RC side we observed that if we have portdrv enabled in
> > > > > Linux running on RC system, it gets bound to RC controller and then it
> > > > > does not allow EDAC pci_driver to bind. So basically we see a problem
> > > > > here, that we can't have two pci_driver binding to same PCI device
> > > > > 2: Another point is even though we use EDAC driver framework, we may not be  
> > > > able to use any of EDAC framework APIs as they are mostly suitable for memory
> > > > controller devices sitting on PCI BUS. We will end up using debugfs entries just via
> > > > a pci_driver placed inside EDAC framework.
> > > > 
> > > > Please wrap your replies to 80 characters.
> > > > 
> > > > There is no need to bind the edac driver to VID:PID of the device. The edac driver
> > > > can be a platform driver and you can instantiate the platform device from the
> > > > DWC driver. This way, the PCI device can be assocaited with whatever driver, but
> > > > still there can be a separate edac driver for handling errors.
> > > > 
> > > > Regarding API limitation, you should ask the maintainer about the possibility of
> > > > extending them.
> > > >   
> > > > >
> > > > > Please let me know if my understanding is wrong.
> > > > >  
> > > > > > But first check with the perf driver author if they have any plans
> > > > > > on adding the proposed functionality. If they do not have any plan
> > > > > > or not working on it, then look into EDAC.
> > > > > >
> > > > > > - Mani
> > > > > >  
> > > > >
> > > > > Since we already worked and posted patches [1], [2], we will continue to work  
> > > > on this and based on consent from community we will adopt to most suitable
> > > > framework.  
> > > > > We see many subsystems like ethernet, usb, gpu, cxl having debugfs files that  
> > > > give information about the current status of the running system and as of now
> > > > based on our findings, we still feel there is no harm in having debugfs entry based
> > > > support in DesignWare controller driver itself.
> > > > 
> > > > There is no issue in exposing the debug information through debugfs, that's the
> > > > sole purpose of the interface. But here, you are trying to add support for DWC
> > > > RAS feature for which a dedicated framework already exists.
> > > > 
> > > > And there will be more similar requests coming for vendor specific error protocols
> > > > as well. So your investigation could benefit everyone.
> > > > 
> > > > From your above investigation, looks like there are some shortcomings of the
> > > > EDAC framework. So let's get that clarified by writing to the EDAC maintainers
> > > > (keep us in CC). If the EDAC maintainer suggests you to add support for this
> > > > feature in DWC driver itself citing some reasons, then no issues with me.
> > > > 
> > > > - Mani
> > > > 
> > > > --
> > > > மணிவண்ணன் சதாசிவம்  
> > > 
> > >   
> > 
> 

-- 
மணிவண்ணன் சதாசிவம்

From mboxrd@z Thu Jan  1 00:00:00 1970
Received: from mailout2.samsung.com (mailout2.samsung.com [203.254.224.25])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id F004C3EA88
	for <linux-kernel@vger.kernel.org>; Fri, 22 Mar 2024 11:37:24 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=203.254.224.25
ARC-Seal: i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1711107447; cv=none; b=jlyVxOVJB8cW/uEk1w2eeNBHGJLoMqRp10M2k/QldBlBuEwIyYlZxt90+4l+u+i9v3Mw5CD4Nm6PM0Bpq4uQyxF7+xHkai1+ROUE1bh2hR82FFLgGBVLgGlN/b4Qr8XyOZYquhJJXp9UYy6ZUvhzOQnbQz0ISmp6cv1HHauC6lc=
ARC-Message-Signature: i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1711107447; c=relaxed/simple;
	bh=TimyXEnSMCMupMVrXo/0kXThu421K8Ag8jSJ5Wm6oiI=;
	h=From:To:Cc:In-Reply-To:Subject:Date:Message-ID:MIME-Version:
	 Content-Type:References; b=XJ2LT5Uw5ioCm+aru8WPsqDTFywl6pYy5cFd51p1p+ly/lmve8X/+2xFx34+OyAEmaIv9ycGPBJGh8gw2xTYJN7CpitNYPG3iZEZn2neNhGFk2M/ogAkgKLX5ijCjUGY0Kc4s+8Y+v+FoXkIDA/eUibS4tw4OK3W+CTsiJr/qqE=
ARC-Authentication-Results: i=1; smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=samsung.com; spf=pass smtp.mailfrom=samsung.com; dkim=pass (1024-bit key) header.d=samsung.com header.i=@samsung.com header.b=jva2DrDM; arc=none smtp.client-ip=203.254.224.25
Authentication-Results: smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=samsung.com
Authentication-Results: smtp.subspace.kernel.org; spf=pass smtp.mailfrom=samsung.com
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (1024-bit key) header.d=samsung.com header.i=@samsung.com header.b="jva2DrDM"
Received: from epcas5p1.samsung.com (unknown [182.195.41.39])
	by mailout2.samsung.com (KnoxPortal) with ESMTP id 20240322113716epoutp0238ca6a035db8b2eaf5a22143df1c45d8~-EyXkn8FU2910829108epoutp02k
	for <linux-kernel@vger.kernel.org>; Fri, 22 Mar 2024 11:37:16 +0000 (GMT)
DKIM-Filter: OpenDKIM Filter v2.11.0 mailout2.samsung.com 20240322113716epoutp0238ca6a035db8b2eaf5a22143df1c45d8~-EyXkn8FU2910829108epoutp02k
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=samsung.com;
	s=mail20170921; t=1711107436;
	bh=BOmetlTwaNKvKFKIwahvFByB4VTueYCmBSAEBsP4hfg=;
	h=From:To:Cc:In-Reply-To:Subject:Date:References:From;
	b=jva2DrDMTl4lascGE1aYTh0nl5Mazwe7LSXiOUrWnp/+ipGrQ+ZM9jqU9ay0WhACf
	 XLbXftMOLRpefHdLTrUT6tFaGtJvZeLngfU9tq5+bWjUim97dizFYjezS/FYIfzW+b
	 9R2YC8Ac8SkSwm4q2dNdcNmY7TiQDgRFH/xQrhHY=
Received: from epsnrtp4.localdomain (unknown [182.195.42.165]) by
	epcas5p3.samsung.com (KnoxPortal) with ESMTP id
	20240322113716epcas5p3820487949e0305da87345b43702074b0~-EyW3nfGT1001910019epcas5p3l;
	Fri, 22 Mar 2024 11:37:16 +0000 (GMT)
Received: from epsmgec5p1new.samsung.com (unknown [182.195.38.179]) by
	epsnrtp4.localdomain (Postfix) with ESMTP id 4V1L0B291Bz4x9Q1; Fri, 22 Mar
	2024 11:37:14 +0000 (GMT)
Received: from epcas5p1.samsung.com ( [182.195.41.39]) by
	epsmgec5p1new.samsung.com (Symantec Messaging Gateway) with SMTP id
	FA.C9.08600.A6D6DF56; Fri, 22 Mar 2024 20:37:14 +0900 (KST)
Received: from epsmtrp2.samsung.com (unknown [182.195.40.14]) by
	epcas5p1.samsung.com (KnoxPortal) with ESMTPA id
	20240322112129epcas5p1b94af4317c52764b4129598734786fa0~-EklN6Ppc0150001500epcas5p1f;
	Fri, 22 Mar 2024 11:21:29 +0000 (GMT)
Received: from epsmgmcp1.samsung.com (unknown [182.195.42.82]) by
	epsmtrp2.samsung.com (KnoxPortal) with ESMTP id
	20240322112129epsmtrp290e630b497127149d59220e98053708f~-EklM3o_u1200512005epsmtrp2u;
	Fri, 22 Mar 2024 11:21:29 +0000 (GMT)
X-AuditID: b6c32a44-6c3ff70000002198-90-65fd6d6a9f98
Received: from epsmtip2.samsung.com ( [182.195.34.31]) by
	epsmgmcp1.samsung.com (Symantec Messaging Gateway) with SMTP id
	2A.77.19234.9B96DF56; Fri, 22 Mar 2024 20:21:29 +0900 (KST)
Received: from FDSFTE462 (unknown [107.122.81.248]) by epsmtip2.samsung.com
	(KnoxPortal) with ESMTPA id
	20240322112124epsmtip289e536244f68a967d0e4f3dc5ac1b555~-EkgxMauO1632316323epsmtip2T;
	Fri, 22 Mar 2024 11:21:24 +0000 (GMT)
From: "Shradha Todi" <shradha.t@samsung.com>
To: "'Manivannan Sadhasivam'" <manivannan.sadhasivam@linaro.org>, "'Jonathan
 Cameron'" <Jonathan.Cameron@Huawei.com>
Cc: <bp@alien8.de>, <tony.luck@intel.com>, <james.morse@arm.com>,
	<mchehab@kernel.org>, <rric@kernel.org>, <lpieralisi@kernel.org>,
	<kw@linux.com>, <robh@kernel.org>, <bhelgaas@google.com>,
	<jingoohan1@gmail.com>, <gustavo.pimentel@synopsys.com>,
	<josh@joshtriplett.org>, <lukas.bulwahn@gmail.com>, <hongxing.zhu@nxp.com>,
	<pankaj.dubey@samsung.com>, <linux-kernel@vger.kernel.org>,
	<linux-pci@vger.kernel.org>, <vidyas@nvidia.com>, <gost.dev@samsung.com>,
	<alim.akhtar@samsung.com>, <shiju.jose@huawei.com>, "'Terry	Bowman'"
	<Terry.Bowman@amd.com>
In-Reply-To: <20240322103935.GD3638@thinkpad>
Subject: RE: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
 controller
Date: Fri, 22 Mar 2024 16:51:16 +0530
Message-ID: <14ef01da7c4b$15dbaac0$41930040$@samsung.com>
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Outlook 16.0
Thread-Index: AQG/Q0WxGB9EWFeblm7N70OL8blxhQGR1/IBAmU4G1oB/2O7JgJFQ8VeAXfQWL0B/DJ/LQGGIYRVASmme0ECIZ7L6wMFIzwCsN3dMoA=
Content-Language: en-in
X-Brightmail-Tracker: H4sIAAAAAAAAA02Te0xTVxzHc25vby/Mmstj45QMYXWoKI+WRz0obCwguwluIyNxRFyw0LuW
	UdraFjfdsnVYJgg4JDpHB4jCcFbixmOsQFEEBIE5EYGpyHARBwx5hKLT8Fqh4Pjv8zvn+z3f
	3++cHJLlWMpxJZMUWkatEMv5hD1e0+y12efjlHlGUDVCogdFNQQqTZMhy88LBLrbWIuhuoEM
	DjLUFAI0ePk8hn6cyecg49k+Ai0WK5Eue5aNbtcVEOhGURuB9HN6HOmvHcXRgD6Tjcoq5zB0
	7pcZDlo0mzjoqrECQ5aeZoD6r99ko8ddf+Ko71duGKT/TT+O0+nd8wRdXlQO6FrDAIcurkyl
	9S3jbLrEPIrR98ZC6UpjJkHf7zMT9FDPaYzOOTJB0BUTJow+Xm0EdPUVC6AtlRuiqb3JITJG
	LGHUHowiUSlJUkhD+VEx8eHxQSKB0EcYjLbzPRTiFCaUH7E72icySW69Db7HQbE81boULdZo
	+H5vhKiVqVrGQ6bUaEP5jEoiVwWqfDXiFE2qQuqrYLQ7hAKBf5BVuD9ZVj5yD6hGEj7Na5vG
	dSDrnWPAjoRUIBzNKiaOAXvSkaoH8JmxmWUrpgEsrOjAXxT9phFi1XLmUTfbtlELYF7+1yuW
	EQArfhjGllQE5Q2HeuZYS+xMHYQnpseWHSyqGofGvzOXRXaUD+x83AmW2ImKgadPHcOXGKc8
	4URFDXuJuVQwTKsz4DZ2gO35Q8vMorbBsrNjLFtLHvD5ozL2alhZbith07jAa8+zl7uDVLcd
	zMmawm2GCFg/McmxsRP8p616hV2hZaJhZU4pvFD13UqAHD6tKsVs/CZs7CmwnkNaA7zgT3V+
	tmU3eKrjEmbLXQ9zZodW5FxoKlrljXBm3rzSAg8Wtd5m5wK+Yc1ohjWjGdaMYPg/rRjgRsBj
	VJoUKZMYpBIqmE9ePHmiMqUSLH+XrREmcOfMgm8TwEjQBCDJ4jtzTYtzjCNXIj50mFEr49Wp
	ckbTBIKs932C5fpyotL63xTaeGFgsCBQJBIFBgeIhHwX7lh6ocSRkoq1TDLDqBj1qg8j7Vx1
	WFzvFpeWScGzDH9eFLffpV59ZPj3rzxfDw7xz3MgdUzklNq+/9xvfe2dzt4L4vURm9wkGbNd
	U9+/794hGj+6u9e0LnfTnouFrTzuF5ZdpNNge1jD/sGnMbmvhDkcOHl4Q/HFtsgHV2v3frBN
	27hzXdc+bAt9F3iHy266X8rX/eE3/BEde3I6zi38iTSntiHroT5gu2PB8FiUZ1p2Z26advPo
	h2/Ftbz3mTbp0MYv75u/HcK68ZKQHeaHvgP+vCfXr7yrfqlTP6t7jYC9zqa/drWp9MzOb0q4
	dbegl5IcZd+Q7PG8FZYQe8f/cuKrOnf1eEKPKKBJNJUBRy8UvB3L+3zy/L4DfFwjEwu3stQa
	8X+/vgbotwQAAA==
X-Brightmail-Tracker: H4sIAAAAAAAAA+NgFupgleLIzCtJLcpLzFFi42LZdlhJXndn5t9Ug+bnwhYP5m1js1jSlGHx
	ecM/NoubB3YyWey628FuMWvbXEaL+/uWM1ms+DKT3WLVwmtsFv8X5Fs09Pxmtbi8aw6bxdl5
	x9ksWv60sFi0HG1nsbjb0slqsWzTHyaLRVu/sFv837OD3eLgqo1MFp+vHGa0uH3iPKvFmwv3
	WCyubed1kPD43trH4tF66S+bx5p5axg9ds66y+6xYFOpR8uRt6wei/e8ZPK49drWY9OqTjaP
	O9f2sHk8uTKdyaO3+R2bx8Z3O5g8+rasYvTYsv8zo8fnTXIBAlFcNimpOZllqUX6dglcGdOn
	L2Uu2JVY0XD4AGsD4wLvLkZODgkBE4n5Ty+xdjFycQgJbGeU2L3hCDNEQlLi88V1TBC2sMTK
	f8/ZIYqeMUqcn7SUESTBJqAj8eTKH7AGEYEyiWvHt7OAFDELnGOROPigAWrsA2aJC9f2gnVw
	CuhKnH5zGswWFgiU2LrxLdgKFgFViXcbt7GC2LwClhJNu2axQNiCEidnPgGzmQW0JXoftjLC
	2MsWvoY6VUHi59NlrDBXLJtwjA2iRlzi6M8e5gmMwrOQjJqFZNQsJKNmIWlZwMiyilE0taA4
	Nz03ucBQrzgxt7g0L10vOT93EyM4sWgF7WBctv6v3iFGJg7GQ4wSHMxKIrw7/v9JFeJNSays
	Si3Kjy8qzUktPsQozcGiJM6rnNOZIiSQnliSmp2aWpBaBJNl4uCUamAy2n21KeHhGuHHx0Iu
	+Nt23lb137115Yerb29Pt/Ir2fKpuWW2duzGU/4if3pDj6UHP09f0Rt1YsN/63dv3t49Z7VQ
	3eLDfqdZHzmMrCfEc8a8m/j9vfRduW+hlaxX+Z7MMQs8uefEhqePndf7NR07N7O0y/nMK+/v
	V5jbjRO2tthxaUw+tOnkU4PHk15Fpc3+Y2ulLcTssMntmCjnavZjJ/r0al1KZ/ZE5b7esHez
	0frg10sn/g7WZZ/hbzf16b+keg/rwu/31V6+uDHv4+pPzqXb2Xmdktq3X56Uf65c4d/3x3yf
	edx+eaZEtVS3uJ7y0pATVF77bt/dAw8m7FeruhqYcdSVhfvMsUjehezPqpRYijMSDbWYi4oT
	AYWR5+SbAwAA
X-CMS-MailID: 20240322112129epcas5p1b94af4317c52764b4129598734786fa0
X-Msg-Generator: CA
Content-Type: text/plain; charset="utf-8"
X-Sendblock-Type: REQ_APPROVE
CMS-TYPE: 105P
DLP-Filter: Pass
X-CFilter-Loop: Reflected
X-CMS-RootMailID: 20231130115055epcas5p4e29befa80877be45dbee308846edc0ba
References: <CGME20231130115055epcas5p4e29befa80877be45dbee308846edc0ba@epcas5p4.samsung.com>
	<20231130115044.53512-1-shradha.t@samsung.com>
	<20231130165514.GW3043@thinkpad>
	<000601da3e07$c39e5e00$4adb1a00$@samsung.com>
	<20240104055030.GA3031@thinkpad>
	<0df701da5ff0$df1165a0$9d3430e0$@samsung.com>
	<20240216134921.GH2559@thinkpad>
	<120d01da657e$66b9d3b0$342d7b10$@samsung.com>
	<20240319163315.GD3297@thinkpad> <20240320100144.0000056c@Huawei.com>
	<20240322103935.GD3638@thinkpad>



> -----Original Message-----
> From: 'Manivannan Sadhasivam' <manivannan.sadhasivam=40linaro.org>
> Sent: 22 March 2024 16:10
> To: Jonathan Cameron <Jonathan.Cameron=40Huawei.com>
> Cc: Shradha Todi <shradha.t=40samsung.com>; bp=40alien8.de;
> tony.luck=40intel.com; james.morse=40arm.com; mchehab=40kernel.org;
> rric=40kernel.org; lpieralisi=40kernel.org; kw=40linux.com; robh=40kernel=
.org;
> bhelgaas=40google.com; jingoohan1=40gmail.com;
> gustavo.pimentel=40synopsys.com; josh=40joshtriplett.org;
> lukas.bulwahn=40gmail.com; hongxing.zhu=40nxp.com;
> pankaj.dubey=40samsung.com; linux-kernel=40vger.kernel.org; linux-
> pci=40vger.kernel.org; vidyas=40nvidia.com; gost.dev=40samsung.com;
> alim.akhtar=40samsung.com; shiju.jose=40huawei.com; Terry Bowman
> <Terry.Bowman=40amd.com>
> Subject: Re: =5BPATCH v2 0/3=5D Add support for RAS DES feature in PCIe D=
W
> controller
>=20
> On Wed, Mar 20, 2024 at 10:01:44AM +0000, Jonathan Cameron wrote:
> > On Tue, 19 Mar 2024 22:03:15 +0530
> > 'Manivannan Sadhasivam' <manivannan.sadhasivam=40linaro.org> wrote:
> >
> > > On Thu, Feb 22, 2024 at 04:30:47PM +0530, Shradha Todi wrote:
> > > > + Borislav, Tony, James, Mauro, Robert
> > > >
> > > > Hi All,
> > > >
> > > > Synopsys DesignWare PCIe controllers have a vendor specific
> > > > capability (which means that this set of registers are only
> > > > present in DesignWare controllers) to perform debug operations call=
ed
> =22RASDES=22.
> > > > The functionalities provided by this extended capability are:
> > > >
> > > > 1. Debug: This has some debug related diagnostic features like
> > > > holding LTSSM in certain states, reading the status of lane
> > > > detection, checking if any PCIe lanes are broken (RX Valid) and so
> > > > on. It's a debug only feature used for diagnostic use-cases.
> > > >
> > > > 2. Error Injection: This is a way to inject certain errors in PCIe
> > > > like LCRC, ECRC, Bad TLPs and so on. Again, this is a debug
> > > > feature and generally not used in functional use-case.
> > > >
> > > > 3. Statistical counters: This has 3 parts
> > > >  - Error counters
> > > >  - Non error counters (covered as part of perf =5B1=5D)
> > > >  - Time based analysis counters (covered as part of perf =5B1=5D)
> > > >
> > > > Selective features of  the above functionality has been
> > > > implemented by vendor specific PCIe controller drivers
> > > > (pcie-tegra194.c) that use Synopsys DesignWare PCIe controllers.
> > > > In order to make it useful to all vendors using DWC controller, we
> > > > had proposed a common implementation in DWC PCIe controller
> > > > directory
> > > > (drivers/pci/controller/dwc/) and our original idea was based on
> > > > debugfs filesystem. v1 and v2 are mentioned in =5B2=5D and =5B3=5D.
> > > >
> > > > We got a suggestion to implement this as part of EDAC framework
> > > > =5B3=5D and we looked into the same. But as far as I understood, wh=
at
> > > > I am trying to implement is a very specific feature (only valid for=
 Synopsys
> DWC PCIe controllers).
> >
> > For error part there are (at least superficially) similar features in
> > the PCIe standard that we've started thinking about how to support.
> >
> > See Flit Logging Extended capablity (7.7.8 in PCIe Base Spec rev6.
> > That has the benefit that they are part of the standard so we can
> > support them directly in portdrv / EP drivers using some library code
> > in the PCI core.
> >
>=20
> Sounds good. But v6 is a relatively new version and the DWC RAS predates =
that.
> So we still need to support it somehow (either in EDAC or in
> drivers/pci/controller/dwc).
>=20

For all PCIe spec standard errors (All of those mentioned in 6.2 in PCIe Ba=
se Spec rev6 like AER,
FLIT logging, DPC, SR-IOV Baseline Error Handling), extending the EDAC / po=
rtdrv / EP drivers
seems like the best way. But this particular RAS-DES functionality exists o=
nly for Synopsys
DesignWare controller, hence I feel the *DWC controller driver* should exte=
nd this as it is a
controller specific feature. What would you suggest?
Unless there a plan to support vendor specific implementations through EDAC=
 or
portdrv callbacks? Because writing a new pci driver would cause 2 driver bi=
nding problem.

> > There are other interconnect and PCI PMU drivers that log retries etc
> > which are also basically error counts. At least some of that is done th=
rough perf
> today.
> >
>=20
> IMO all the RAS support should be exposed through EDAC, otherwise it defe=
ats
> the purpose of the subsystem.
>=20
> - Mani
>=20

Yes, I see that lot of non-error based counters like memory packet tx/rx re=
ceived,
nak dllp received, etc is done as a part of perf today. But I believe, the =
functionality I want to
implement has features like error injection which would not be suitable to =
be a part of perf.

> >
> > > > This doesn't seem to fit in very well with the EDAC framework and
> > > > we can hardly use any of the EDAC framework APIs. We tried
> > > > implementing a =22pci_driver=22 but since a function driver will
> > > > already be running on the EP and portdrv on the root-complex, we
> > > > will not be able to bind 2 drivers to a single PCI device
> > > > (root-complex or endpoint). Ultimately, what I will be doing is
> > > > writing a platform driver with debugfs entries which will be presen=
t in EDAC
> directory instead of DWC directory.
> >
> > The addition of this type of functionality to pordrv is a long running =
question.
> > Everyone wants a solution, I believe some people are looking at it
> > (+CC Terry)
> >
> > Terry, another case for your long list.
> >
> > For the EP end, this should be fired up by the EP driver, whilst it
> > might be infrastructure used on a bunch of devices,  it is a feature
> > of that particular EP - so you'd want to provide any functionality in
> > a form that could be used by both the EP driver and a nice shiny new po=
rtdrv
> replacement.
> >
> > > >
> > > > Can  you please help us out by going through this thread =5B3=5D an=
d
> > > > letting us know if our understanding is wrong at any point. If you
> > > > think it is a better idea to integrate this in the EDAC framework,
> > > > can you guide me as to how I can utilize the framework better?
> > > > Please let me know if you need any other information to conclude.
> > > >
> > > > =5B1=5D
> > > > https://lore.kernel.org/linux-pci/20231121013400.18367-1-xueshuai=
=40
> > > > linux.alibaba.com/ =5B2=5D
> > > > https://lore.kernel.org/all/20210518174618.42089-1-shradha.t=40sams=
u
> > > > ng.com/T/ =5B3=5D
> > > > https://lore.kernel.org/all/20231130115044.53512-1-shradha.t=40sams=
u
> > > > ng.com/
> > > >
> > >
> > > Gentle ping for the EDAC maintainers.
> > >
> > > - Mani
> > >
> > > > Thanks,
> > > > Shradha
> > > >
> > > > > -----Original Message-----
> > > > > From: 'Manivannan Sadhasivam' <manivannan.sadhasivam=40linaro.org=
>
> > > > > Sent: 16 February 2024 19:19
> > > > > To: Shradha Todi <shradha.t=40samsung.com>
> > > > > Cc: lpieralisi=40kernel.org; kw=40linux.com; robh=40kernel.org;
> > > > > bhelgaas=40google.com; jingoohan1=40gmail.com;
> > > > > gustavo.pimentel=40synopsys.com; josh=40joshtriplett.org;
> > > > > lukas.bulwahn=40gmail.com; hongxing.zhu=40nxp.com;
> > > > > pankaj.dubey=40samsung.com; linux-kernel=40vger.kernel.org; linux=
-
> > > > > pci=40vger.kernel.org; vidyas=40nvidia.com; gost.dev=40samsung.co=
m
> > > > > Subject: Re: =5BPATCH v2 0/3=5D Add support for RAS DES feature i=
n
> > > > > PCIe DW controller
> > > > >
> > > > > On Thu, Feb 15, 2024 at 02:55:06PM +0530, Shradha Todi wrote:
> > > > > >
> > > > > >
> > > > >
> > > > > =5B...=5D
> > > > >
> > > > > > > For the error injection and counters, we already have the
> > > > > > > EDAC framework. So adding them in the DWC driver doesn't make
> sense to me.
> > > > > > >
> > > > > >
> > > > > > Sorry for late response, was going through the EDAC framework
> > > > > > to understand
> > > > > better how we can fit RAS DES support in it. Below are some
> > > > > technical challenges found so far:
> > > > > > 1: This debugfs framework proposed =5B1=5D can run on both side=
 of
> > > > > > the link i.e. RC
> > > > > and EP as it will be a part of the link controller platform
> > > > > driver. Here for the EP side the assumption is that it has Linux
> > > > > running, which is primarily a use case for chip-to-chip
> > > > > communication.  After your suggestion to migrate to EDAC framewor=
k we
> studied and here are the findings:
> > > > > > - If we move to EDAC framework, we need to have RAS DES as a
> > > > > > pci_driver which will be binded based on vendor_id and
> > > > > > device_id. Our observation is that on EP side system we are
> > > > > > unable to bind two function driver (pci_driver), as
> > > > > > pci_endpoint_test function driver or some other chip-to-chip
> > > > > > function driver will already be bound. On the other hand, on
> > > > > > RC side we observed that if we have portdrv enabled in Linux
> > > > > > running on RC system, it gets bound to RC controller and then
> > > > > > it does not allow EDAC pci_driver to bind. So basically we see
> > > > > > a problem here, that we can't have two pci_driver binding to
> > > > > > same PCI device
> > > > > > 2: Another point is even though we use EDAC driver framework,
> > > > > > we may not be
> > > > > able to use any of EDAC framework APIs as they are mostly
> > > > > suitable for memory controller devices sitting on PCI BUS. We
> > > > > will end up using debugfs entries just via a pci_driver placed in=
side EDAC
> framework.
> > > > >
> > > > > Please wrap your replies to 80 characters.
> > > > >
> > > > > There is no need to bind the edac driver to VID:PID of the
> > > > > device. The edac driver can be a platform driver and you can
> > > > > instantiate the platform device from the DWC driver. This way,
> > > > > the PCI device can be assocaited with whatever driver, but still =
there can
> be a separate edac driver for handling errors.
> > > > >
> > > > > Regarding API limitation, you should ask the maintainer about
> > > > > the possibility of extending them.
> > > > >
> > > > > >
> > > > > > Please let me know if my understanding is wrong.
> > > > > >
> > > > > > > But first check with the perf driver author if they have any
> > > > > > > plans on adding the proposed functionality. If they do not
> > > > > > > have any plan or not working on it, then look into EDAC.
> > > > > > >
> > > > > > > - Mani
> > > > > > >
> > > > > >
> > > > > > Since we already worked and posted patches =5B1=5D, =5B2=5D, we=
 will
> > > > > > continue to work
> > > > > on this and based on consent from community we will adopt to
> > > > > most suitable framework.
> > > > > > We see many subsystems like ethernet, usb, gpu, cxl having
> > > > > > debugfs files that
> > > > > give information about the current status of the running system
> > > > > and as of now based on our findings, we still feel there is no
> > > > > harm in having debugfs entry based support in DesignWare controll=
er
> driver itself.
> > > > >
> > > > > There is no issue in exposing the debug information through
> > > > > debugfs, that's the sole purpose of the interface. But here, you
> > > > > are trying to add support for DWC RAS feature for which a dedicat=
ed
> framework already exists.
> > > > >
> > > > > And there will be more similar requests coming for vendor
> > > > > specific error protocols as well. So your investigation could ben=
efit
> everyone.
> > > > >
> > > > > From your above investigation, looks like there are some
> > > > > shortcomings of the EDAC framework. So let's get that clarified
> > > > > by writing to the EDAC maintainers (keep us in CC). If the EDAC
> > > > > maintainer suggests you to add support for this feature in DWC dr=
iver
> itself citing some reasons, then no issues with me.
> > > > >
> > > > > - Mani
> > > > >
> > > > > --
> > > > > =E0=AE=AE=E0=AE=A3=E0=AE=BF=E0=AE=B5=E0=AE=A3=E0=AF=8D=E0=AE=A3=
=E0=AE=A9=E0=AF=8D=20=E0=AE=9A=E0=AE=A4=E0=AE=BE=E0=AE=9A=E0=AE=BF=E0=AE=B5=
=E0=AE=AE=E0=AF=8D=0D=0A>=20>=20>=20>=0D=0A>=20>=20>=20>=0D=0A>=20>=20>=0D=
=0A>=20>=0D=0A>=20=0D=0A>=20--=0D=0A>=20=E0=AE=AE=E0=AE=A3=E0=AE=BF=E0=AE=
=B5=E0=AE=A3=E0=AF=8D=E0=AE=A3=E0=AE=A9=E0=AF=8D=20=E0=AE=9A=E0=AE=A4=E0=AE=
=BE=E0=AE=9A=E0=AE=BF=E0=AE=B5=E0=AE=AE=E0=AF=8D=0D=0A=0D=0A

From mboxrd@z Thu Jan  1 00:00:00 1970
Received: from frasgout.his.huawei.com (frasgout.his.huawei.com [185.176.79.56])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 68A7F446A0;
	Fri, 22 Mar 2024 12:58:21 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=185.176.79.56
ARC-Seal: i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1711112305; cv=none; b=eV/S2cr2nOyw/Z1/Prlht7ig9u8a+RLxeo7HPADcyRircibMX7cNa+hXQ1OPHwnzuF06mYJJj1GVVgyVj/L+dsUpJEAI2OXgoxJ6+/ZahAkYuhrki1sYWONHfZwU4jLq5MuLd/93J2gATbw0UEkCxmqUnBV48CpDns8WMxMgRuc=
ARC-Message-Signature: i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1711112305; c=relaxed/simple;
	bh=R8CEgZzdkISYvI1frNeDpEPHLFmDlh3VCwkh/8paHe4=;
	h=Date:From:To:CC:Subject:Message-ID:In-Reply-To:References:
	 MIME-Version:Content-Type; b=O9JUQ/du9KLoKN7JmLpMKQzS/8CkL5VPrElkl8c4qKCmZwcRERpY6zOEOAoiJv/iwe7S2PDGq92+nJEnWtxSvzhJhNstZe85TrmWwUQurGSwBRleYL1kH/9vfUd21gVZZNe485pmBbqtQ9Q6suKY26m1UXt4ZkLkscyKlOf+WMM=
ARC-Authentication-Results: i=1; smtp.subspace.kernel.org; dmarc=pass (p=quarantine dis=none) header.from=Huawei.com; spf=pass smtp.mailfrom=huawei.com; arc=none smtp.client-ip=185.176.79.56
Authentication-Results: smtp.subspace.kernel.org; dmarc=pass (p=quarantine dis=none) header.from=Huawei.com
Authentication-Results: smtp.subspace.kernel.org; spf=pass smtp.mailfrom=huawei.com
Received: from mail.maildlp.com (unknown [172.18.186.216])
	by frasgout.his.huawei.com (SkyGuard) with ESMTP id 4V1Mn01kzRz6K5sX;
	Fri, 22 Mar 2024 20:57:40 +0800 (CST)
Received: from lhrpeml500005.china.huawei.com (unknown [7.191.163.240])
	by mail.maildlp.com (Postfix) with ESMTPS id 92353140A90;
	Fri, 22 Mar 2024 20:58:18 +0800 (CST)
Received: from localhost (10.202.227.76) by lhrpeml500005.china.huawei.com
 (7.191.163.240) with Microsoft SMTP Server (version=TLS1_2,
 cipher=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384) id 15.1.2507.35; Fri, 22 Mar
 2024 12:58:17 +0000
Date: Fri, 22 Mar 2024 12:58:17 +0000
From: Jonathan Cameron <Jonathan.Cameron@Huawei.com>
To: 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org>
CC: Shradha Todi <shradha.t@samsung.com>, <bp@alien8.de>,
	<tony.luck@intel.com>, <james.morse@arm.com>, <mchehab@kernel.org>,
	<rric@kernel.org>, <lpieralisi@kernel.org>, <kw@linux.com>,
	<robh@kernel.org>, <bhelgaas@google.com>, <jingoohan1@gmail.com>,
	<gustavo.pimentel@synopsys.com>, <josh@joshtriplett.org>,
	<lukas.bulwahn@gmail.com>, <hongxing.zhu@nxp.com>,
	<pankaj.dubey@samsung.com>, <linux-kernel@vger.kernel.org>,
	<linux-pci@vger.kernel.org>, <vidyas@nvidia.com>, <gost.dev@samsung.com>,
	<alim.akhtar@samsung.com>, <shiju.jose@huawei.com>, "Terry Bowman"
	<Terry.Bowman@amd.com>, <linux-cxl@vger.kernel.org>
Subject: Re: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
 controller
Message-ID: <20240322125817.0000791f@Huawei.com>
In-Reply-To: <20240322103935.GD3638@thinkpad>
References: <CGME20231130115055epcas5p4e29befa80877be45dbee308846edc0ba@epcas5p4.samsung.com>
	<20231130115044.53512-1-shradha.t@samsung.com>
	<20231130165514.GW3043@thinkpad>
	<000601da3e07$c39e5e00$4adb1a00$@samsung.com>
	<20240104055030.GA3031@thinkpad>
	<0df701da5ff0$df1165a0$9d3430e0$@samsung.com>
	<20240216134921.GH2559@thinkpad>
	<120d01da657e$66b9d3b0$342d7b10$@samsung.com>
	<20240319163315.GD3297@thinkpad>
	<20240320100144.0000056c@Huawei.com>
	<20240322103935.GD3638@thinkpad>
Organization: Huawei Technologies Research and Development (UK) Ltd.
X-Mailer: Claws Mail 4.1.0 (GTK 3.24.33; x86_64-w64-mingw32)
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: quoted-printable
X-ClientProxiedBy: lhrpeml100002.china.huawei.com (7.191.160.241) To
 lhrpeml500005.china.huawei.com (7.191.163.240)

On Fri, 22 Mar 2024 16:09:35 +0530
'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org> wrote:

> On Wed, Mar 20, 2024 at 10:01:44AM +0000, Jonathan Cameron wrote:
> > On Tue, 19 Mar 2024 22:03:15 +0530
> > 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org> wrote:
> >  =20
> > > On Thu, Feb 22, 2024 at 04:30:47PM +0530, Shradha Todi wrote: =20
> > > > + Borislav, Tony, James, Mauro, Robert
> > > >=20
> > > > Hi All,
> > > >=20
> > > > Synopsys DesignWare PCIe controllers have a vendor specific capabil=
ity (which
> > > > means that this set of registers are only present in DesignWare con=
trollers)
> > > > to perform debug operations called "RASDES".
> > > > The functionalities provided by this extended capability are:
> > > >=20
> > > > 1. Debug: This has some debug related diagnostic features like hold=
ing LTSSM
> > > > in certain states, reading the status of lane detection, checking i=
f any PCIe
> > > > lanes are broken (RX Valid) and so on. It's a debug only feature us=
ed for diagnostic
> > > > use-cases.
> > > >=20
> > > > 2. Error Injection: This is a way to inject certain errors in PCIe =
like LCRC, ECRC,
> > > > Bad TLPs and so on. Again, this is a debug feature and generally no=
t used in
> > > > functional use-case.
> > > >=20
> > > > 3. Statistical counters: This has 3 parts
> > > >  - Error counters
> > > >  - Non error counters (covered as part of perf [1])
> > > >  - Time based analysis counters (covered as part of perf [1])
> > > >=20
> > > > Selective features of  the above functionality has been implemented
> > > > by vendor specific PCIe controller drivers (pcie-tegra194.c) that u=
se
> > > > Synopsys DesignWare PCIe controllers.
> > > > In order to make it useful to all vendors using DWC controller, we =
had
> > > > proposed a common implementation in DWC PCIe controller directory
> > > > (drivers/pci/controller/dwc/) and our original idea was based on de=
bugfs
> > > > filesystem. v1 and v2 are mentioned in [2] and [3].
> > > >=20
> > > > We got a suggestion to implement this as part of EDAC framework [3]=
 and
> > > > we looked into the same. But as far as I understood, what I am tryi=
ng to
> > > > implement is a very specific feature (only valid for Synopsys DWC P=
CIe controllers). =20
> >=20
> > For error part there are (at least superficially) similar features in t=
he PCIe
> > standard that we've started thinking about how to support.
> >=20
> > See Flit Logging Extended capablity (7.7.8 in PCIe Base Spec rev6.
> > That has the benefit that they are part of the standard so we can
> > support them directly in portdrv / EP drivers using some library code i=
n the
> > PCI core.
> >  =20
>=20
> Sounds good. But v6 is a relatively new version and the DWC RAS predates =
that.
> So we still need to support it somehow (either in EDAC or in
> drivers/pci/controller/dwc).
>=20
> > There are other interconnect and PCI PMU drivers that log retries etc w=
hich are also basically error
> > counts. At least some of that is done through perf today.=20
> >  =20
>=20
> IMO all the RAS support should be exposed through EDAC, otherwise it defe=
ats the
> purpose of the subsystem.

Some RAS flows go nowhere near EDAC today.  Individual drivers poke out
the tracepoints and userspace tooling deals with it. One example is
CXL but there are plenty of others.

Perhaps that should not be the case, but there is definitely
precedence for ignoring edac when considering error flows.

Jonathan

>=20
> - Mani
>=20
> >  =20
> > > > This doesn't seem to fit in very well with the EDAC framework and w=
e can=20
> > > > hardly use any of the EDAC framework APIs. We tried implementing a
> > > > "pci_driver" but since a function driver will already be running on=
 the EP and
> > > > portdrv on the root-complex, we will not be able to bind 2 drivers =
to a single
> > > > PCI device (root-complex or endpoint). Ultimately, what I will be d=
oing is
> > > > writing a platform driver with debugfs entries which will be presen=
t in EDAC
> > > > directory instead of DWC directory. =20
> >=20
> > The addition of this type of functionality to pordrv is a long running =
question.
> > Everyone wants a solution, I believe some people are looking at it (+CC=
 Terry)
> >=20
> > Terry, another case for your long list.
> >=20
> > For the EP end, this should be fired up by the EP driver, whilst it mig=
ht be
> > infrastructure used on a bunch of devices,  it is a feature of that par=
ticular
> > EP - so you'd want to provide any functionality in a form that could be=
 used
> > by both the EP driver and a nice shiny new portdrv replacement.
> >  =20
> > > >=20
> > > > Can  you please help us out by going through this thread [3] and le=
tting us
> > > > know if our understanding is wrong at any point. If you think it is=
 a better
> > > > idea to integrate this in the EDAC framework, can you guide me as
> > > > to how I can utilize the framework better?
> > > > Please let me know if you need any other information to conclude.
> > > >=20
> > > > [1] https://lore.kernel.org/linux-pci/20231121013400.18367-1-xueshu=
ai@linux.alibaba.com/
> > > > [2] https://lore.kernel.org/all/20210518174618.42089-1-shradha.t@sa=
msung.com/T/
> > > > [3] https://lore.kernel.org/all/20231130115044.53512-1-shradha.t@sa=
msung.com/
> > > >    =20
> > >=20
> > > Gentle ping for the EDAC maintainers.
> > >=20
> > > - Mani
> > >  =20
> > > > Thanks,
> > > > Shradha
> > > >    =20
> > > > > -----Original Message-----
> > > > > From: 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org>
> > > > > Sent: 16 February 2024 19:19
> > > > > To: Shradha Todi <shradha.t@samsung.com>
> > > > > Cc: lpieralisi@kernel.org; kw@linux.com; robh@kernel.org;
> > > > > bhelgaas@google.com; jingoohan1@gmail.com;
> > > > > gustavo.pimentel@synopsys.com; josh@joshtriplett.org;
> > > > > lukas.bulwahn@gmail.com; hongxing.zhu@nxp.com;
> > > > > pankaj.dubey@samsung.com; linux-kernel@vger.kernel.org; linux-
> > > > > pci@vger.kernel.org; vidyas@nvidia.com; gost.dev@samsung.com
> > > > > Subject: Re: [PATCH v2 0/3] Add support for RAS DES feature in PC=
Ie DW
> > > > > controller
> > > > >=20
> > > > > On Thu, Feb 15, 2024 at 02:55:06PM +0530, Shradha Todi wrote:   =
=20
> > > > > >
> > > > > >   =20
> > > > >=20
> > > > > [...]
> > > > >    =20
> > > > > > > For the error injection and counters, we already have the EDAC
> > > > > > > framework. So adding them in the DWC driver doesn't make sens=
e to me.
> > > > > > >   =20
> > > > > >
> > > > > > Sorry for late response, was going through the EDAC framework t=
o understand   =20
> > > > > better how we can fit RAS DES support in it. Below are some techn=
ical challenges
> > > > > found so far:   =20
> > > > > > 1: This debugfs framework proposed [1] can run on both side of =
the link i.e. RC   =20
> > > > > and EP as it will be a part of the link controller platform drive=
r. Here for the EP
> > > > > side the assumption is that it has Linux running, which is primar=
ily a use case for
> > > > > chip-to-chip communication.  After your suggestion to migrate to =
EDAC
> > > > > framework we studied and here are the findings:   =20
> > > > > > - If we move to EDAC framework, we need to have RAS DES as a
> > > > > > pci_driver which will be binded based on vendor_id and device_i=
d. Our
> > > > > > observation is that on EP side system we are unable to bind two
> > > > > > function driver (pci_driver), as pci_endpoint_test function dri=
ver or
> > > > > > some other chip-to-chip function driver will already be bound. =
On the
> > > > > > other hand, on RC side we observed that if we have portdrv enab=
led in
> > > > > > Linux running on RC system, it gets bound to RC controller and =
then it
> > > > > > does not allow EDAC pci_driver to bind. So basically we see a p=
roblem
> > > > > > here, that we can't have two pci_driver binding to same PCI dev=
ice
> > > > > > 2: Another point is even though we use EDAC driver framework, w=
e may not be   =20
> > > > > able to use any of EDAC framework APIs as they are mostly suitabl=
e for memory
> > > > > controller devices sitting on PCI BUS. We will end up using debug=
fs entries just via
> > > > > a pci_driver placed inside EDAC framework.
> > > > >=20
> > > > > Please wrap your replies to 80 characters.
> > > > >=20
> > > > > There is no need to bind the edac driver to VID:PID of the device=
. The edac driver
> > > > > can be a platform driver and you can instantiate the platform dev=
ice from the
> > > > > DWC driver. This way, the PCI device can be assocaited with whate=
ver driver, but
> > > > > still there can be a separate edac driver for handling errors.
> > > > >=20
> > > > > Regarding API limitation, you should ask the maintainer about the=
 possibility of
> > > > > extending them.
> > > > >    =20
> > > > > >
> > > > > > Please let me know if my understanding is wrong.
> > > > > >   =20
> > > > > > > But first check with the perf driver author if they have any =
plans
> > > > > > > on adding the proposed functionality. If they do not have any=
 plan
> > > > > > > or not working on it, then look into EDAC.
> > > > > > >
> > > > > > > - Mani
> > > > > > >   =20
> > > > > >
> > > > > > Since we already worked and posted patches [1], [2], we will co=
ntinue to work   =20
> > > > > on this and based on consent from community we will adopt to most=
 suitable
> > > > > framework.   =20
> > > > > > We see many subsystems like ethernet, usb, gpu, cxl having debu=
gfs files that   =20
> > > > > give information about the current status of the running system a=
nd as of now
> > > > > based on our findings, we still feel there is no harm in having d=
ebugfs entry based
> > > > > support in DesignWare controller driver itself.
> > > > >=20
> > > > > There is no issue in exposing the debug information through debug=
fs, that's the
> > > > > sole purpose of the interface. But here, you are trying to add su=
pport for DWC
> > > > > RAS feature for which a dedicated framework already exists.
> > > > >=20
> > > > > And there will be more similar requests coming for vendor specifi=
c error protocols
> > > > > as well. So your investigation could benefit everyone.
> > > > >=20
> > > > > From your above investigation, looks like there are some shortcom=
ings of the
> > > > > EDAC framework. So let's get that clarified by writing to the EDA=
C maintainers
> > > > > (keep us in CC). If the EDAC maintainer suggests you to add suppo=
rt for this
> > > > > feature in DWC driver itself citing some reasons, then no issues =
with me.
> > > > >=20
> > > > > - Mani
> > > > >=20
> > > > > --
> > > > > =E0=AE=AE=E0=AE=A3=E0=AE=BF=E0=AE=B5=E0=AE=A3=E0=AF=8D=E0=AE=A3=
=E0=AE=A9=E0=AF=8D =E0=AE=9A=E0=AE=A4=E0=AE=BE=E0=AE=9A=E0=AE=BF=E0=AE=B5=
=E0=AE=AE=E0=AF=8D   =20
> > > >=20
> > > >    =20
> > >  =20
> >  =20
>=20


From mboxrd@z Thu Jan  1 00:00:00 1970
Received: from mail-yb1-f177.google.com (mail-yb1-f177.google.com [209.85.219.177])
	(using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 2CE8A4CE13
	for <linux-kernel@vger.kernel.org>; Fri, 22 Mar 2024 15:31:17 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=209.85.219.177
ARC-Seal: i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1711121480; cv=none; b=sbvF19wTs+JUvx/npCsTsp5PkSXbTIPibKEDzuno89BG1PmpjP03ScRUS+tj1Ykq2Fx1Rj2do4v8yQ72dv08H5Nvimb3VUuvj/cPivaPMINa/P4Xh/PJcrU4Pbvbb/9LFWpMQjjBlenQaDTdahW3QMxS/eiH2yf3W5xZleKMkbw=
ARC-Message-Signature: i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1711121480; c=relaxed/simple;
	bh=Ox0mmPE49F9PP7cJKvrl5cvdsz9gdE/4hTLv1j41J24=;
	h=Date:From:To:Cc:Subject:Message-ID:References:MIME-Version:
	 Content-Type:Content-Disposition:In-Reply-To; b=kTG9gU6UUYo42IsfYgCE+ZQm+ciSm+gZu9/VL6F+AuUESG9N/AxrZVs1vRZOcf687iREC2EFcGrd8NmS9uXYMMmWaGdvXx2RakkLmACJNJeV4RHBU/Kf9VGh+GwB0Ha71FBHvJa4C6tO5NhfX46E6P9aIpbD/I8qQ9SJrDcNP7Q=
ARC-Authentication-Results: i=1; smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=linaro.org; spf=pass smtp.mailfrom=linaro.org; dkim=pass (2048-bit key) header.d=linaro.org header.i=@linaro.org header.b=mytTlfzW; arc=none smtp.client-ip=209.85.219.177
Authentication-Results: smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=linaro.org
Authentication-Results: smtp.subspace.kernel.org; spf=pass smtp.mailfrom=linaro.org
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (2048-bit key) header.d=linaro.org header.i=@linaro.org header.b="mytTlfzW"
Received: by mail-yb1-f177.google.com with SMTP id 3f1490d57ef6-dc6d8bd618eso2225034276.3
        for <linux-kernel@vger.kernel.org>; Fri, 22 Mar 2024 08:31:17 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=linaro.org; s=google; t=1711121477; x=1711726277; darn=vger.kernel.org;
        h=in-reply-to:content-transfer-encoding:content-disposition
         :mime-version:references:message-id:subject:cc:to:from:date:from:to
         :cc:subject:date:message-id:reply-to;
        bh=6+zpz/0s08etd86Xo6qnUCY3UQn1+EUOk94+hs8faa0=;
        b=mytTlfzWnsNU48/lbqAh7jW9ba08Up8PO3bB8dHxnotRpC0VL3F2IFZ5d4BZaUGUOl
         W5i1t5mnCcYh65acsl/Nh6JU9N7C7R+rgd0XkRva/MbtLG3jkO/u9RtR1OIM1N7grvra
         FV84gBHq/j19Xxtgh5r5r/GD5VQ4TIvTj3BDelCXoFMwzFK1N6I7/Q67XvZ2B7+cY8C3
         jKmJsNqNckMM0WbJZSegU5CPHahyuOe9OQ1HhqA8zfflTlxVC9F2HcHAawE8NMNaSxcU
         n3BbLMNeYZuqMcdSJDngAocK0IOIaiBD8Z58Z8etoTZxb6njh7mkCmbfmR58ypnzkFgc
         nAqQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1711121477; x=1711726277;
        h=in-reply-to:content-transfer-encoding:content-disposition
         :mime-version:references:message-id:subject:cc:to:from:date
         :x-gm-message-state:from:to:cc:subject:date:message-id:reply-to;
        bh=6+zpz/0s08etd86Xo6qnUCY3UQn1+EUOk94+hs8faa0=;
        b=uoIUARAA2hYHjBN2Q2sw7Uys2gtH2RBi0HeZ2nQyiAGfVwoGz2U3ufKJYKnUXMT1W6
         j7L4GsaxlaRuFnVlNZI16GCCaLNGk7YAiISfAU0U3dPqHS5qsWpzztBGdchkqtgKdrnJ
         SH88m4ptf6tgFBdYTC7y3VRksIHsS//GWnV8o1Jn4GVRwEHTGyX6ZMoiL9A5QKzHUzre
         QqslSrY2Eyqk8sCefo64D776IiK/9d5zkgQ67eheJvLZSQjK2SmLy6MIKFWRxAzve/dS
         UvMZ4B6BPVKiPzFuj7RoEA3dAgx1TSQb8WnZKGsX112ov3hhMEyihBEJ8luZc36ZtFJ9
         7zkw==
X-Forwarded-Encrypted: i=1; AJvYcCUNQtk1EoQhl2V2QsQT5xXa8qe2iec1mjZhGC3tnrdEIaXOtewFH7fJ98/BPQHYiUb9hA/uYetNLtMU0JXfW2E8HdSfyRP0ESkBGnqr
X-Gm-Message-State: AOJu0Yxulhtlt1/jKk3EszPLeEUGvpI2x0gT3m2r0yrxorbBBmhrky7T
	XvKr6Zr5PgO+/Fs22L0sptF2j630vCjDSLo4jSLTJTKdRvUzSfxI7zmnTu4tWDafPWN4UMYsA88
	=
X-Google-Smtp-Source: AGHT+IFLY16MKppu2zecs7h+7oSpQlxQY1HhhVYugeIoJr77FKmAzqKcxjisNQan7xnx2xfIGv6v+w==
X-Received: by 2002:a05:6a20:8f18:b0:1a3:6ee8:b84c with SMTP id b24-20020a056a208f1800b001a36ee8b84cmr3261446pzk.13.1711118510853;
        Fri, 22 Mar 2024 07:41:50 -0700 (PDT)
Received: from thinkpad ([103.28.246.103])
        by smtp.gmail.com with ESMTPSA id kt3-20020a056a004ba300b006ea8152b657sm1617896pfb.69.2024.03.22.07.41.43
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Fri, 22 Mar 2024 07:41:50 -0700 (PDT)
Date: Fri, 22 Mar 2024 20:11:41 +0530
From: 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org>
To: Jonathan Cameron <Jonathan.Cameron@Huawei.com>
Cc: Shradha Todi <shradha.t@samsung.com>, bp@alien8.de, tony.luck@intel.com,
	james.morse@arm.com, mchehab@kernel.org, rric@kernel.org,
	lpieralisi@kernel.org, kw@linux.com, robh@kernel.org,
	bhelgaas@google.com, jingoohan1@gmail.com,
	gustavo.pimentel@synopsys.com, josh@joshtriplett.org,
	lukas.bulwahn@gmail.com, hongxing.zhu@nxp.com,
	pankaj.dubey@samsung.com, linux-kernel@vger.kernel.org,
	linux-pci@vger.kernel.org, vidyas@nvidia.com, gost.dev@samsung.com,
	alim.akhtar@samsung.com, shiju.jose@huawei.com,
	Terry Bowman <Terry.Bowman@amd.com>, linux-cxl@vger.kernel.org
Subject: Re: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
 controller
Message-ID: <20240322144141.GC3333@thinkpad>
References: <20231130165514.GW3043@thinkpad>
 <000601da3e07$c39e5e00$4adb1a00$@samsung.com>
 <20240104055030.GA3031@thinkpad>
 <0df701da5ff0$df1165a0$9d3430e0$@samsung.com>
 <20240216134921.GH2559@thinkpad>
 <120d01da657e$66b9d3b0$342d7b10$@samsung.com>
 <20240319163315.GD3297@thinkpad>
 <20240320100144.0000056c@Huawei.com>
 <20240322103935.GD3638@thinkpad>
 <20240322125817.0000791f@Huawei.com>
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <20240322125817.0000791f@Huawei.com>

On Fri, Mar 22, 2024 at 12:58:17PM +0000, Jonathan Cameron wrote:
> On Fri, 22 Mar 2024 16:09:35 +0530
> 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org> wrote:
> 
> > On Wed, Mar 20, 2024 at 10:01:44AM +0000, Jonathan Cameron wrote:
> > > On Tue, 19 Mar 2024 22:03:15 +0530
> > > 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org> wrote:
> > >   
> > > > On Thu, Feb 22, 2024 at 04:30:47PM +0530, Shradha Todi wrote:  
> > > > > + Borislav, Tony, James, Mauro, Robert
> > > > > 
> > > > > Hi All,
> > > > > 
> > > > > Synopsys DesignWare PCIe controllers have a vendor specific capability (which
> > > > > means that this set of registers are only present in DesignWare controllers)
> > > > > to perform debug operations called "RASDES".
> > > > > The functionalities provided by this extended capability are:
> > > > > 
> > > > > 1. Debug: This has some debug related diagnostic features like holding LTSSM
> > > > > in certain states, reading the status of lane detection, checking if any PCIe
> > > > > lanes are broken (RX Valid) and so on. It's a debug only feature used for diagnostic
> > > > > use-cases.
> > > > > 
> > > > > 2. Error Injection: This is a way to inject certain errors in PCIe like LCRC, ECRC,
> > > > > Bad TLPs and so on. Again, this is a debug feature and generally not used in
> > > > > functional use-case.
> > > > > 
> > > > > 3. Statistical counters: This has 3 parts
> > > > >  - Error counters
> > > > >  - Non error counters (covered as part of perf [1])
> > > > >  - Time based analysis counters (covered as part of perf [1])
> > > > > 
> > > > > Selective features of  the above functionality has been implemented
> > > > > by vendor specific PCIe controller drivers (pcie-tegra194.c) that use
> > > > > Synopsys DesignWare PCIe controllers.
> > > > > In order to make it useful to all vendors using DWC controller, we had
> > > > > proposed a common implementation in DWC PCIe controller directory
> > > > > (drivers/pci/controller/dwc/) and our original idea was based on debugfs
> > > > > filesystem. v1 and v2 are mentioned in [2] and [3].
> > > > > 
> > > > > We got a suggestion to implement this as part of EDAC framework [3] and
> > > > > we looked into the same. But as far as I understood, what I am trying to
> > > > > implement is a very specific feature (only valid for Synopsys DWC PCIe controllers).  
> > > 
> > > For error part there are (at least superficially) similar features in the PCIe
> > > standard that we've started thinking about how to support.
> > > 
> > > See Flit Logging Extended capablity (7.7.8 in PCIe Base Spec rev6.
> > > That has the benefit that they are part of the standard so we can
> > > support them directly in portdrv / EP drivers using some library code in the
> > > PCI core.
> > >   
> > 
> > Sounds good. But v6 is a relatively new version and the DWC RAS predates that.
> > So we still need to support it somehow (either in EDAC or in
> > drivers/pci/controller/dwc).
> > 
> > > There are other interconnect and PCI PMU drivers that log retries etc which are also basically error
> > > counts. At least some of that is done through perf today. 
> > >   
> > 
> > IMO all the RAS support should be exposed through EDAC, otherwise it defeats the
> > purpose of the subsystem.
> 
> Some RAS flows go nowhere near EDAC today.  Individual drivers poke out
> the tracepoints and userspace tooling deals with it. One example is
> CXL but there are plenty of others.
> 

That's the problem. You'd end up with custom tooling for each individual
drivers leading to userspace fragmentation.

- Mani

> Perhaps that should not be the case, but there is definitely
> precedence for ignoring edac when considering error flows.
> 
> Jonathan
> 
> > 
> > - Mani
> > 
> > >   
> > > > > This doesn't seem to fit in very well with the EDAC framework and we can 
> > > > > hardly use any of the EDAC framework APIs. We tried implementing a
> > > > > "pci_driver" but since a function driver will already be running on the EP and
> > > > > portdrv on the root-complex, we will not be able to bind 2 drivers to a single
> > > > > PCI device (root-complex or endpoint). Ultimately, what I will be doing is
> > > > > writing a platform driver with debugfs entries which will be present in EDAC
> > > > > directory instead of DWC directory.  
> > > 
> > > The addition of this type of functionality to pordrv is a long running question.
> > > Everyone wants a solution, I believe some people are looking at it (+CC Terry)
> > > 
> > > Terry, another case for your long list.
> > > 
> > > For the EP end, this should be fired up by the EP driver, whilst it might be
> > > infrastructure used on a bunch of devices,  it is a feature of that particular
> > > EP - so you'd want to provide any functionality in a form that could be used
> > > by both the EP driver and a nice shiny new portdrv replacement.
> > >   
> > > > > 
> > > > > Can  you please help us out by going through this thread [3] and letting us
> > > > > know if our understanding is wrong at any point. If you think it is a better
> > > > > idea to integrate this in the EDAC framework, can you guide me as
> > > > > to how I can utilize the framework better?
> > > > > Please let me know if you need any other information to conclude.
> > > > > 
> > > > > [1] https://lore.kernel.org/linux-pci/20231121013400.18367-1-xueshuai@linux.alibaba.com/
> > > > > [2] https://lore.kernel.org/all/20210518174618.42089-1-shradha.t@samsung.com/T/
> > > > > [3] https://lore.kernel.org/all/20231130115044.53512-1-shradha.t@samsung.com/
> > > > >     
> > > > 
> > > > Gentle ping for the EDAC maintainers.
> > > > 
> > > > - Mani
> > > >   
> > > > > Thanks,
> > > > > Shradha
> > > > >     
> > > > > > -----Original Message-----
> > > > > > From: 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org>
> > > > > > Sent: 16 February 2024 19:19
> > > > > > To: Shradha Todi <shradha.t@samsung.com>
> > > > > > Cc: lpieralisi@kernel.org; kw@linux.com; robh@kernel.org;
> > > > > > bhelgaas@google.com; jingoohan1@gmail.com;
> > > > > > gustavo.pimentel@synopsys.com; josh@joshtriplett.org;
> > > > > > lukas.bulwahn@gmail.com; hongxing.zhu@nxp.com;
> > > > > > pankaj.dubey@samsung.com; linux-kernel@vger.kernel.org; linux-
> > > > > > pci@vger.kernel.org; vidyas@nvidia.com; gost.dev@samsung.com
> > > > > > Subject: Re: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
> > > > > > controller
> > > > > > 
> > > > > > On Thu, Feb 15, 2024 at 02:55:06PM +0530, Shradha Todi wrote:    
> > > > > > >
> > > > > > >    
> > > > > > 
> > > > > > [...]
> > > > > >     
> > > > > > > > For the error injection and counters, we already have the EDAC
> > > > > > > > framework. So adding them in the DWC driver doesn't make sense to me.
> > > > > > > >    
> > > > > > >
> > > > > > > Sorry for late response, was going through the EDAC framework to understand    
> > > > > > better how we can fit RAS DES support in it. Below are some technical challenges
> > > > > > found so far:    
> > > > > > > 1: This debugfs framework proposed [1] can run on both side of the link i.e. RC    
> > > > > > and EP as it will be a part of the link controller platform driver. Here for the EP
> > > > > > side the assumption is that it has Linux running, which is primarily a use case for
> > > > > > chip-to-chip communication.  After your suggestion to migrate to EDAC
> > > > > > framework we studied and here are the findings:    
> > > > > > > - If we move to EDAC framework, we need to have RAS DES as a
> > > > > > > pci_driver which will be binded based on vendor_id and device_id. Our
> > > > > > > observation is that on EP side system we are unable to bind two
> > > > > > > function driver (pci_driver), as pci_endpoint_test function driver or
> > > > > > > some other chip-to-chip function driver will already be bound. On the
> > > > > > > other hand, on RC side we observed that if we have portdrv enabled in
> > > > > > > Linux running on RC system, it gets bound to RC controller and then it
> > > > > > > does not allow EDAC pci_driver to bind. So basically we see a problem
> > > > > > > here, that we can't have two pci_driver binding to same PCI device
> > > > > > > 2: Another point is even though we use EDAC driver framework, we may not be    
> > > > > > able to use any of EDAC framework APIs as they are mostly suitable for memory
> > > > > > controller devices sitting on PCI BUS. We will end up using debugfs entries just via
> > > > > > a pci_driver placed inside EDAC framework.
> > > > > > 
> > > > > > Please wrap your replies to 80 characters.
> > > > > > 
> > > > > > There is no need to bind the edac driver to VID:PID of the device. The edac driver
> > > > > > can be a platform driver and you can instantiate the platform device from the
> > > > > > DWC driver. This way, the PCI device can be assocaited with whatever driver, but
> > > > > > still there can be a separate edac driver for handling errors.
> > > > > > 
> > > > > > Regarding API limitation, you should ask the maintainer about the possibility of
> > > > > > extending them.
> > > > > >     
> > > > > > >
> > > > > > > Please let me know if my understanding is wrong.
> > > > > > >    
> > > > > > > > But first check with the perf driver author if they have any plans
> > > > > > > > on adding the proposed functionality. If they do not have any plan
> > > > > > > > or not working on it, then look into EDAC.
> > > > > > > >
> > > > > > > > - Mani
> > > > > > > >    
> > > > > > >
> > > > > > > Since we already worked and posted patches [1], [2], we will continue to work    
> > > > > > on this and based on consent from community we will adopt to most suitable
> > > > > > framework.    
> > > > > > > We see many subsystems like ethernet, usb, gpu, cxl having debugfs files that    
> > > > > > give information about the current status of the running system and as of now
> > > > > > based on our findings, we still feel there is no harm in having debugfs entry based
> > > > > > support in DesignWare controller driver itself.
> > > > > > 
> > > > > > There is no issue in exposing the debug information through debugfs, that's the
> > > > > > sole purpose of the interface. But here, you are trying to add support for DWC
> > > > > > RAS feature for which a dedicated framework already exists.
> > > > > > 
> > > > > > And there will be more similar requests coming for vendor specific error protocols
> > > > > > as well. So your investigation could benefit everyone.
> > > > > > 
> > > > > > From your above investigation, looks like there are some shortcomings of the
> > > > > > EDAC framework. So let's get that clarified by writing to the EDAC maintainers
> > > > > > (keep us in CC). If the EDAC maintainer suggests you to add support for this
> > > > > > feature in DWC driver itself citing some reasons, then no issues with me.
> > > > > > 
> > > > > > - Mani
> > > > > > 
> > > > > > --
> > > > > > மணிவண்ணன் சதாசிவம்    
> > > > > 
> > > > >     
> > > >   
> > >   
> > 
> 

-- 
மணிவண்ணன் சதாசிவம்

From mboxrd@z Thu Jan  1 00:00:00 1970
Received: from mail-pg1-f181.google.com (mail-pg1-f181.google.com [209.85.215.181])
	(using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 440E515FA82
	for <linux-kernel@vger.kernel.org>; Wed, 24 Apr 2024 15:33:07 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=209.85.215.181
ARC-Seal: i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1713972789; cv=none; b=lktIpjVjlvqmIBOfuw2OrYIcrdU8sqG28SCPQib5wHA4JQVXaExJzW7/ijj/wFWMq67xJwFTEX5IJE1vexI6EkRuzpeZDiNeL7YiD8XVnQhYcnbA9KpaKQhMpxXjA62vXmpD0c2rlaqL7hadNAF93xmGSkHCfDvztCQ41KuGmO4=
ARC-Message-Signature: i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1713972789; c=relaxed/simple;
	bh=Sa2jolD7DuYxzvUq65yIMPq5BeIoPzrBy772nMd05UU=;
	h=Date:From:To:Cc:Subject:Message-ID:References:MIME-Version:
	 Content-Type:Content-Disposition:In-Reply-To; b=SPPWpsRARNZ3Z5H93EIzcyCAfGH6gKbr2ZKkk9Pf3ch+oMs3KUr9xLF/dGD1ppFlC3dpLdCahKhrO3M0g/TnAYLLl+FvG0GARtjTT/8/Yz+4hX6WXzPlSxUrcwi8y/Mov7mjLnEaVaAeb4aolVOU3PV8q7byZu0y0iY9a9CFmTc=
ARC-Authentication-Results: i=1; smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=linaro.org; spf=pass smtp.mailfrom=linaro.org; dkim=pass (2048-bit key) header.d=linaro.org header.i=@linaro.org header.b=rrueLUni; arc=none smtp.client-ip=209.85.215.181
Authentication-Results: smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=linaro.org
Authentication-Results: smtp.subspace.kernel.org; spf=pass smtp.mailfrom=linaro.org
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (2048-bit key) header.d=linaro.org header.i=@linaro.org header.b="rrueLUni"
Received: by mail-pg1-f181.google.com with SMTP id 41be03b00d2f7-5f415fd71f8so5238078a12.3
        for <linux-kernel@vger.kernel.org>; Wed, 24 Apr 2024 08:33:07 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=linaro.org; s=google; t=1713972786; x=1714577586; darn=vger.kernel.org;
        h=in-reply-to:content-transfer-encoding:content-disposition
         :mime-version:references:message-id:subject:cc:to:from:date:from:to
         :cc:subject:date:message-id:reply-to;
        bh=DJOm+lWo+hp1zepsogWn2+mB5g4PZtqtai6pqqXOLRo=;
        b=rrueLUni32kD+DHer4P4P1zDdnzpi2RWSRNVGlrBAYxFkMHWNHDUsxARjPazCNpNvQ
         cHSmZ+MOa4L3zhwMnTrd24S9w/10Wp2LgGipOCYd6NA0BWN+8DODiV/yr0k8wZGvUBz2
         VZ5a2ijMM7paTyC/fsh9kmnuJgT6o6pf/vFAQ+1cY2ebpnNz6CdHHNl50LE1TT0YNJCN
         RuaoNIZWW+hXh2+u30U+9m+PumF7z0CUeFng0tuiyYL7NhcOMnJ+2sMOd33txvaN1MM3
         iLE4ao5zicqCcYf08cyWWsEGZX65eeTlsEcfwCSMd3qstQnYyOfsL3cyoTiiCtEsr97m
         RerA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1713972786; x=1714577586;
        h=in-reply-to:content-transfer-encoding:content-disposition
         :mime-version:references:message-id:subject:cc:to:from:date
         :x-gm-message-state:from:to:cc:subject:date:message-id:reply-to;
        bh=DJOm+lWo+hp1zepsogWn2+mB5g4PZtqtai6pqqXOLRo=;
        b=e0/ssM5wlrkoVWxRvpyHMJmUQYnxs4bn8FudVymElrHcT8B0M5+qXeJCZyICInz8VG
         A1nSTPeqiAJDc17lOQQo2zDn6abpzX/kwzLHDTOjkMpg5bEiSpyZjUX3hmvwctWWbKrW
         ffqKZDQJcu6HQ/KtwySzvEyW+6RRTI36Upyztg7oi7L7w2IJieVXOY34J+p5/svRGjxE
         eXSjTnR2FkFXMBzuh6rZyXueJSR2Vb2zQEDobZ97qSLAL2pD3DDezJdUfveCL6ExlVyo
         6SzaS6ZDbJ3Pyo2FgrTRFPN7OiT2Jo4XzShTvBgj6boFRiiIX9FNMJSXmDVibmFGi6Ar
         BOFg==
X-Forwarded-Encrypted: i=1; AJvYcCW/kPQ5L0Okp3kjYnNfDf68dRB3zD165c5vKOXdmA6id4komejhtfPYD5YSsRoIRCswla63iyMKOPZ+oIX5L1ejMPFoFEBrkl/Gge/F
X-Gm-Message-State: AOJu0YxhjDFNREncs4Bfm9/a8l8JcCLPdqkpxjUJkovJvIDyCZw9M6oq
	kTGzK6m+mVRmy8I2RJHIWLzuiaCmZRk+aJvRvGghZwkQ63ZMHRvSO073CzbZSZpD82xc4xd813w
	=
X-Google-Smtp-Source: AGHT+IF/yDBR9aXI+gweXeu9pphLXlHTJLGWrb0UVPIkQOr3z11HlRqyg+FfZqFhOfn5DkwfZomqBw==
X-Received: by 2002:a17:90b:33cf:b0:2a4:752f:b7b7 with SMTP id lk15-20020a17090b33cf00b002a4752fb7b7mr2784956pjb.26.1713972786226;
        Wed, 24 Apr 2024 08:33:06 -0700 (PDT)
Received: from thinkpad ([120.60.135.200])
        by smtp.gmail.com with ESMTPSA id gn5-20020a17090ac78500b0029f349cc253sm13086303pjb.54.2024.04.24.08.33.00
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Wed, 24 Apr 2024 08:33:05 -0700 (PDT)
Date: Wed, 24 Apr 2024 21:02:53 +0530
From: 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org>
To: Shradha Todi <shradha.t@samsung.com>
Cc: bp@alien8.de, tony.luck@intel.com, james.morse@arm.com,
	mchehab@kernel.org, rric@kernel.org, lpieralisi@kernel.org,
	kw@linux.com, robh@kernel.org, bhelgaas@google.com,
	jingoohan1@gmail.com, gustavo.pimentel@synopsys.com,
	josh@joshtriplett.org, lukas.bulwahn@gmail.com,
	hongxing.zhu@nxp.com, pankaj.dubey@samsung.com,
	linux-kernel@vger.kernel.org, linux-pci@vger.kernel.org,
	vidyas@nvidia.com, gost.dev@samsung.com, alim.akhtar@samsung.com
Subject: Re: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
 controller
Message-ID: <20240424153253.GA12524@thinkpad>
References: <CGME20231130115055epcas5p4e29befa80877be45dbee308846edc0ba@epcas5p4.samsung.com>
 <20231130115044.53512-1-shradha.t@samsung.com>
 <20231130165514.GW3043@thinkpad>
 <000601da3e07$c39e5e00$4adb1a00$@samsung.com>
 <20240104055030.GA3031@thinkpad>
 <0df701da5ff0$df1165a0$9d3430e0$@samsung.com>
 <20240216134921.GH2559@thinkpad>
 <120d01da657e$66b9d3b0$342d7b10$@samsung.com>
 <20240319163315.GD3297@thinkpad>
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <20240319163315.GD3297@thinkpad>

On Tue, Mar 19, 2024 at 10:03:15PM +0530, 'Manivannan Sadhasivam' wrote:
> On Thu, Feb 22, 2024 at 04:30:47PM +0530, Shradha Todi wrote:
> > + Borislav, Tony, James, Mauro, Robert
> > 
> > Hi All,
> > 
> > Synopsys DesignWare PCIe controllers have a vendor specific capability (which
> > means that this set of registers are only present in DesignWare controllers)
> > to perform debug operations called "RASDES".
> > The functionalities provided by this extended capability are:
> > 
> > 1. Debug: This has some debug related diagnostic features like holding LTSSM
> > in certain states, reading the status of lane detection, checking if any PCIe
> > lanes are broken (RX Valid) and so on. It's a debug only feature used for diagnostic
> > use-cases.
> > 
> > 2. Error Injection: This is a way to inject certain errors in PCIe like LCRC, ECRC,
> > Bad TLPs and so on. Again, this is a debug feature and generally not used in
> > functional use-case.
> > 
> > 3. Statistical counters: This has 3 parts
> >  - Error counters
> >  - Non error counters (covered as part of perf [1])
> >  - Time based analysis counters (covered as part of perf [1])
> > 
> > Selective features of  the above functionality has been implemented
> > by vendor specific PCIe controller drivers (pcie-tegra194.c) that use
> > Synopsys DesignWare PCIe controllers.
> > In order to make it useful to all vendors using DWC controller, we had
> > proposed a common implementation in DWC PCIe controller directory
> > (drivers/pci/controller/dwc/) and our original idea was based on debugfs
> > filesystem. v1 and v2 are mentioned in [2] and [3].
> > 
> > We got a suggestion to implement this as part of EDAC framework [3] and
> > we looked into the same. But as far as I understood, what I am trying to
> > implement is a very specific feature (only valid for Synopsys DWC PCIe controllers).
> > This doesn't seem to fit in very well with the EDAC framework and we can 
> > hardly use any of the EDAC framework APIs. We tried implementing a
> > "pci_driver" but since a function driver will already be running on the EP and
> > portdrv on the root-complex, we will not be able to bind 2 drivers to a single
> > PCI device (root-complex or endpoint). Ultimately, what I will be doing is
> > writing a platform driver with debugfs entries which will be present in EDAC
> > directory instead of DWC directory.
> > 
> > Can  you please help us out by going through this thread [3] and letting us
> > know if our understanding is wrong at any point. If you think it is a better
> > idea to integrate this in the EDAC framework, can you guide me as
> > to how I can utilize the framework better?
> > Please let me know if you need any other information to conclude.
> > 
> > [1] https://lore.kernel.org/linux-pci/20231121013400.18367-1-xueshuai@linux.alibaba.com/
> > [2] https://lore.kernel.org/all/20210518174618.42089-1-shradha.t@samsung.com/T/
> > [3] https://lore.kernel.org/all/20231130115044.53512-1-shradha.t@samsung.com/
> > 
> 
> Gentle ping for the EDAC maintainers.
> 

Since there is no response from the EDAC maintainers for a while, I think we
should go ahead and add the RAS feature in the PCI DWC driver itself.

- Mani

> - Mani
> 
> > Thanks,
> > Shradha
> > 
> > > -----Original Message-----
> > > From: 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org>
> > > Sent: 16 February 2024 19:19
> > > To: Shradha Todi <shradha.t@samsung.com>
> > > Cc: lpieralisi@kernel.org; kw@linux.com; robh@kernel.org;
> > > bhelgaas@google.com; jingoohan1@gmail.com;
> > > gustavo.pimentel@synopsys.com; josh@joshtriplett.org;
> > > lukas.bulwahn@gmail.com; hongxing.zhu@nxp.com;
> > > pankaj.dubey@samsung.com; linux-kernel@vger.kernel.org; linux-
> > > pci@vger.kernel.org; vidyas@nvidia.com; gost.dev@samsung.com
> > > Subject: Re: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
> > > controller
> > > 
> > > On Thu, Feb 15, 2024 at 02:55:06PM +0530, Shradha Todi wrote:
> > > >
> > > >
> > > 
> > > [...]
> > > 
> > > > > For the error injection and counters, we already have the EDAC
> > > > > framework. So adding them in the DWC driver doesn't make sense to me.
> > > > >
> > > >
> > > > Sorry for late response, was going through the EDAC framework to understand
> > > better how we can fit RAS DES support in it. Below are some technical challenges
> > > found so far:
> > > > 1: This debugfs framework proposed [1] can run on both side of the link i.e. RC
> > > and EP as it will be a part of the link controller platform driver. Here for the EP
> > > side the assumption is that it has Linux running, which is primarily a use case for
> > > chip-to-chip communication.  After your suggestion to migrate to EDAC
> > > framework we studied and here are the findings:
> > > > - If we move to EDAC framework, we need to have RAS DES as a
> > > > pci_driver which will be binded based on vendor_id and device_id. Our
> > > > observation is that on EP side system we are unable to bind two
> > > > function driver (pci_driver), as pci_endpoint_test function driver or
> > > > some other chip-to-chip function driver will already be bound. On the
> > > > other hand, on RC side we observed that if we have portdrv enabled in
> > > > Linux running on RC system, it gets bound to RC controller and then it
> > > > does not allow EDAC pci_driver to bind. So basically we see a problem
> > > > here, that we can't have two pci_driver binding to same PCI device
> > > > 2: Another point is even though we use EDAC driver framework, we may not be
> > > able to use any of EDAC framework APIs as they are mostly suitable for memory
> > > controller devices sitting on PCI BUS. We will end up using debugfs entries just via
> > > a pci_driver placed inside EDAC framework.
> > > 
> > > Please wrap your replies to 80 characters.
> > > 
> > > There is no need to bind the edac driver to VID:PID of the device. The edac driver
> > > can be a platform driver and you can instantiate the platform device from the
> > > DWC driver. This way, the PCI device can be assocaited with whatever driver, but
> > > still there can be a separate edac driver for handling errors.
> > > 
> > > Regarding API limitation, you should ask the maintainer about the possibility of
> > > extending them.
> > > 
> > > >
> > > > Please let me know if my understanding is wrong.
> > > >
> > > > > But first check with the perf driver author if they have any plans
> > > > > on adding the proposed functionality. If they do not have any plan
> > > > > or not working on it, then look into EDAC.
> > > > >
> > > > > - Mani
> > > > >
> > > >
> > > > Since we already worked and posted patches [1], [2], we will continue to work
> > > on this and based on consent from community we will adopt to most suitable
> > > framework.
> > > > We see many subsystems like ethernet, usb, gpu, cxl having debugfs files that
> > > give information about the current status of the running system and as of now
> > > based on our findings, we still feel there is no harm in having debugfs entry based
> > > support in DesignWare controller driver itself.
> > > 
> > > There is no issue in exposing the debug information through debugfs, that's the
> > > sole purpose of the interface. But here, you are trying to add support for DWC
> > > RAS feature for which a dedicated framework already exists.
> > > 
> > > And there will be more similar requests coming for vendor specific error protocols
> > > as well. So your investigation could benefit everyone.
> > > 
> > > From your above investigation, looks like there are some shortcomings of the
> > > EDAC framework. So let's get that clarified by writing to the EDAC maintainers
> > > (keep us in CC). If the EDAC maintainer suggests you to add support for this
> > > feature in DWC driver itself citing some reasons, then no issues with me.
> > > 
> > > - Mani
> > > 
> > > --
> > > மணிவண்ணன் சதாசிவம்
> > 
> > 
> 
> -- 
> மணிவண்ணன் சதாசிவம்

-- 
மணிவண்ணன் சதாசிவம்

From mboxrd@z Thu Jan  1 00:00:00 1970
Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
	aws-us-west-2-korg-lkml-1.web.codeaurora.org
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by smtp.lore.kernel.org (Postfix) with ESMTP id 11475C4167B
	for <linux-kernel@archiver.kernel.org>; Thu, 30 Nov 2023 13:51:15 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1345708AbjK3NvG (ORCPT
        <rfc822;linux-kernel@archiver.kernel.org>);
        Thu, 30 Nov 2023 08:51:06 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:41780 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1345581AbjK3NvE (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Thu, 30 Nov 2023 08:51:04 -0500
Received: from mailout2.samsung.com (mailout2.samsung.com [203.254.224.25])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 374F8131
        for <linux-kernel@vger.kernel.org>; Thu, 30 Nov 2023 05:51:07 -0800 (PST)
Received: from epcas5p1.samsung.com (unknown [182.195.41.39])
        by mailout2.samsung.com (KnoxPortal) with ESMTP id 20231130135103epoutp02888478e6a7e5fd9840f463e171b98497~cat6igOrS1306813068epoutp02w
        for <linux-kernel@vger.kernel.org>; Thu, 30 Nov 2023 13:51:03 +0000 (GMT)
DKIM-Filter: OpenDKIM Filter v2.11.0 mailout2.samsung.com 20231130135103epoutp02888478e6a7e5fd9840f463e171b98497~cat6igOrS1306813068epoutp02w
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=samsung.com;
        s=mail20170921; t=1701352263;
        bh=AXEPALESso3IHEGnjNE8OOJAITFOwUrOekyzSLBnaRU=;
        h=From:To:Cc:Subject:Date:References:From;
        b=ioZJ/VfI4RzjktxFoBirM9FR0O23p3Z6nsNjWeoxbkLb61c7VwiRASRf/p+2+PD0M
         ZDaCGkSqvT5Rxj3yZIYeCz04LbtmRxDVNwMjeOUWqJSXGt3fjs75GsvJ3N8JKoI23r
         mZNVu6MRwp+lCKf2aUUKCqLX+Fy3PquGOGU3TUAc=
Received: from epsnrtp4.localdomain (unknown [182.195.42.165]) by
        epcas5p3.samsung.com (KnoxPortal) with ESMTP id
        20231130135102epcas5p3dc90e298d61549c962fd73a108e01383~cat5y5sGU0205102051epcas5p33;
        Thu, 30 Nov 2023 13:51:02 +0000 (GMT)
Received: from epsmges5p1new.samsung.com (unknown [182.195.38.179]) by
        epsnrtp4.localdomain (Postfix) with ESMTP id 4SgyJj5v3qz4x9Pv; Thu, 30 Nov
        2023 13:51:01 +0000 (GMT)
Received: from epcas5p3.samsung.com ( [182.195.41.41]) by
        epsmges5p1new.samsung.com (Symantec Messaging Gateway) with SMTP id
        2A.E7.09634.54398656; Thu, 30 Nov 2023 22:51:01 +0900 (KST)
Received: from epsmtrp1.samsung.com (unknown [182.195.40.13]) by
        epcas5p4.samsung.com (KnoxPortal) with ESMTPA id
        20231130115055epcas5p4e29befa80877be45dbee308846edc0ba~cZFBa0JFd0967209672epcas5p4Y;
        Thu, 30 Nov 2023 11:50:55 +0000 (GMT)
Received: from epsmgms1p2new.samsung.com (unknown [182.195.42.42]) by
        epsmtrp1.samsung.com (KnoxPortal) with ESMTP id
        20231130115055epsmtrp13238ef79585fb52257838b0a311c40f2~cZFBaDxs41720317203epsmtrp1q;
        Thu, 30 Nov 2023 11:50:55 +0000 (GMT)
X-AuditID: b6c32a49-159fd700000025a2-fc-65689345da6c
Received: from epsmtip1.samsung.com ( [182.195.34.30]) by
        epsmgms1p2new.samsung.com (Symantec Messaging Gateway) with SMTP id
        2A.BE.08817.F1778656; Thu, 30 Nov 2023 20:50:55 +0900 (KST)
Received: from cheetah.sa.corp.samsungelectronics.net (unknown
        [107.109.115.53]) by epsmtip1.samsung.com (KnoxPortal) with ESMTPA id
        20231130115053epsmtip1ddf7dc43938900250ee67d35bc227628~cZE-UPiZ81499114991epsmtip1R;
        Thu, 30 Nov 2023 11:50:53 +0000 (GMT)
From: Shradha Todi <shradha.t@samsung.com>
To: manivannan.sadhasivam@linaro.org, lpieralisi@kernel.org,
        kw@linux.com, robh@kernel.org, bhelgaas@google.com,
        jingoohan1@gmail.com, gustavo.pimentel@synopsys.com,
        josh@joshtriplett.org, lukas.bulwahn@gmail.com,
        hongxing.zhu@nxp.com, pankaj.dubey@samsung.com
Cc: linux-kernel@vger.kernel.org, linux-pci@vger.kernel.org,
        Shradha Todi <shradha.t@samsung.com>
Subject: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
 controller
Date: Thu, 30 Nov 2023 17:20:41 +0530
Message-Id: <20231130115044.53512-1-shradha.t@samsung.com>
X-Mailer: git-send-email 2.17.1
X-Brightmail-Tracker: H4sIAAAAAAAAA+NgFupik+LIzCtJLcpLzFFi42LZdlhTU9d1ckaqwb5V2hZLmjIsdt3tYLeY
        tW0uo8WKLzPZLf4vyLdo6PnNanF51xw2i7PzjrNZtPxpYbFoOdrOYnG3pZPVYtHWL0Ble3aw
        W/QernXg89g56y67x4JNpR63Xtt6bFrVyeZx59oeNo8nV6YzeWx8t4PJo2/LKkaPLfs/M3p8
        3iQXwBWVbZORmpiSWqSQmpecn5KZl26r5B0c7xxvamZgqGtoaWGupJCXmJtqq+TiE6DrlpkD
        dL2SQlliTilQKCCxuFhJ386mKL+0JFUhI7+4xFYptSAlp8CkQK84Mbe4NC9dLy+1xMrQwMDI
        FKgwITvj2Z9TTAWLBSv2v1zF0sDYz9fFyMkhIWAiMXf7bdYuRi4OIYHdjBKv7nUxgSSEBD4x
        Snz8Ug2R+MYo8eJXAxtMx6p7nYwQib2MEg8737JBOK1MEttftbOAVLEJaEk0fu1iBkmICHQx
        STxacZIdJMEskCwxr/8O2A5hAX+Ja03PwMayCKhKTOvvYwWxeQWsJJ6+mcEEsU5eYvWGA8wQ
        9l92iYsPeCFsF4mJHfdYIWxhiVfHt7BD2FISL/vboOx0iZWbZ0D15kh827wEaqa9xIErc4AO
        5QC6R1Ni/S59iLCsxNRT65ggzuST6P39BKqcV2LHPBhbWeLL3z0sELakxLxjl6FO8JBYue4T
        CyToYiVeHl3FOIFRdhbChgWMjKsYJVMLinPTU4tNCwzzUsvhEZWcn7uJEZwotTx3MN598EHv
        ECMTB+MhRgkOZiUR3utP01OFeFMSK6tSi/Lji0pzUosPMZoCg2wis5Rocj4wVeeVxBuaWBqY
        mJmZmVgamxkqifO+bp2bIiSQnliSmp2aWpBaBNPHxMEp1cDk1Hb5fVsP+7Un9Z1iPwP/z6y+
        asBx/uW1ZW6i10R0/3xtVf/eaNXTu9v1oNaigDy/EN3Ed4WiTuePV1r/WdhZ8NVsjcpayfkH
        U1XeRa7y1z/I9IH3f/Orx2unnU7Qu/vlMaP5tMyzS6/cWHAl+nqsknIOR3nA7xju+9OM4/gZ
        Nt5PV/yvqjPXv7WpUjjo3pfu7cbc5lsuPev302vtjbXKlhVex5rKK9j6sdjuyArbXUuft0wW
        aT3lp/nq/M7ggJgCS/336syrmC8dmjVzY/GcC7XnWOrkrFIS3x0Qk8+0y5tR2XwtPmHq9duP
        qhTdQhvfZcw7VMR0ctfH0px/S9XsH/K3OEoGJa2uOl7+d7kSS3FGoqEWc1FxIgD0xun0HQQA
        AA==
X-Brightmail-Tracker: H4sIAAAAAAAAA+NgFtrOLMWRmVeSWpSXmKPExsWy7bCSnK58eUaqwfGpkhZLmjIsdt3tYLeY
        tW0uo8WKLzPZLf4vyLdo6PnNanF51xw2i7PzjrNZtPxpYbFoOdrOYnG3pZPVYtHWL0Ble3aw
        W/QernXg89g56y67x4JNpR63Xtt6bFrVyeZx59oeNo8nV6YzeWx8t4PJo2/LKkaPLfs/M3p8
        3iQXwBXFZZOSmpNZllqkb5fAlfHszymmgsWCFftfrmJpYOzn62Lk5JAQMJFYda+TsYuRi0NI
        YDejxPnPK1khEpISny+uY4KwhSVW/nvODlHUzCTx7MYeNpAEm4CWROPXLmaQhIjADCaJlu77
        LCAJZoFUiduH54AVCQv4SjxdcQ7MZhFQlZjW3we2gVfASuLpmxlQG+QlVm84wDyBkWcBI8Mq
        RsnUguLc9NxiwwKjvNRyveLE3OLSvHS95PzcTYzgsNXS2sG4Z9UHvUOMTByMhxglOJiVRHiv
        P01PFeJNSaysSi3Kjy8qzUktPsQozcGiJM777XVvipBAemJJanZqakFqEUyWiYNTqoHp9EqP
        +VcX/pdPVtiy7upsr/akUoMzU49qb66+Y8zgtXK55Ebb8rmL3Q2idzAtL7u97DmvUmLT14Ku
        1w6Oz3xrf4jM1X7zsJmn96ydbMyeeYEfPt7q76vlXqa8hyWiRbbh5/nuhl+W5xV2bOw2UbV/
        afg7a+ty+0/ek8JCJT7mz135OaM1PLdzR/3n2XU8qxfrvgxv9GkLnGTysXm+ponok4hHBfwN
        HJ27T4tzX1wssVm2eNnzSMHnvzzb/H2jlpXnhrTOFF1fl/pF7uEKpT9xNhcFWmN0K1ef2uiQ
        Et2yKKnSVsrm+/3SKZsmpy1T1I4u+rfjjHHvqlenpr9sUpx3rUzmZONBd52zNczsl94qsRRn
        JBpqMRcVJwIA4+CEqsoCAAA=
X-CMS-MailID: 20231130115055epcas5p4e29befa80877be45dbee308846edc0ba
X-Msg-Generator: CA
Content-Type: text/plain; charset="utf-8"
X-Sendblock-Type: REQ_APPROVE
CMS-TYPE: 105P
DLP-Filter: Pass
X-CFilter-Loop: Reflected
X-CMS-RootMailID: 20231130115055epcas5p4e29befa80877be45dbee308846edc0ba
References: <CGME20231130115055epcas5p4e29befa80877be45dbee308846edc0ba@epcas5p4.samsung.com>
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

DesignWare controller provides a vendor specific extended capability
called RASDES as an IP feature. This extended capability  provides
hardware information like:
 - Debug registers to know the state of the link or controller. 
 - Error injection mechanisms to inject various PCIe errors including
   sequence number, CRC
 - Statistical counters to know how many times a particular event
   occurred

However, in Linux we do not have any generic or custom support to be
able to use this feature in an efficient manner. This is the reason we
are proposing this framework. Debug and bring up time of high-speed IPs
are highly dependent on costlier hardware analyzers and this solution
will in some ways help to reduce the HW analyzer usage.

The debugfs entries can be used to get information about underlying
hardware and can be shared with user space. Separate debugfs entries has
been created to cater to all the DES hooks provided by the controller.
The debugfs entries interacts with the RASDES registers in the required
sequence and provides the meaningful data to the user. This eases the
effort to understand and use the register information for debugging.

v1 version was posted long back and for some reasons I couldn't work on
it. I apologize for the long break. I'm restarting this activity and
have taken care of all previous review comments shared.
v1: https://lore.kernel.org/all/20210518174618.42089-1-shradha.t@samsung.com/T/

Shradha Todi (3):
  PCI: dwc: Add support for vendor specific capability search
  PCI: debugfs: Add support for RASDES framework in DWC
  PCI: dwc: Create debugfs files in DWC driver

 drivers/pci/controller/dwc/Kconfig            |   8 +
 drivers/pci/controller/dwc/Makefile           |   1 +
 .../controller/dwc/pcie-designware-debugfs.c  | 476 ++++++++++++++++++
 .../controller/dwc/pcie-designware-debugfs.h  |   0
 drivers/pci/controller/dwc/pcie-designware.c  |  20 +
 drivers/pci/controller/dwc/pcie-designware.h  |  18 +
 6 files changed, 523 insertions(+)
 create mode 100644 drivers/pci/controller/dwc/pcie-designware-debugfs.c
 create mode 100644 drivers/pci/controller/dwc/pcie-designware-debugfs.h

-- 
2.17.1


From mboxrd@z Thu Jan  1 00:00:00 1970
Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
	aws-us-west-2-korg-lkml-1.web.codeaurora.org
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by smtp.lore.kernel.org (Postfix) with ESMTP id 01C1AC4167B
	for <linux-kernel@archiver.kernel.org>; Thu, 30 Nov 2023 13:51:57 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1345724AbjK3Nvt (ORCPT
        <rfc822;linux-kernel@archiver.kernel.org>);
        Thu, 30 Nov 2023 08:51:49 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:53148 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1345699AbjK3Nvq (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Thu, 30 Nov 2023 08:51:46 -0500
Received: from mailout2.samsung.com (mailout2.samsung.com [203.254.224.25])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 6CC5810F1
        for <linux-kernel@vger.kernel.org>; Thu, 30 Nov 2023 05:51:52 -0800 (PST)
Received: from epcas5p2.samsung.com (unknown [182.195.41.40])
        by mailout2.samsung.com (KnoxPortal) with ESMTP id 20231130135150epoutp02b9ca86d2bdb1d5e94d683e9edfc14476~caumlsihE1306313063epoutp027
        for <linux-kernel@vger.kernel.org>; Thu, 30 Nov 2023 13:51:50 +0000 (GMT)
DKIM-Filter: OpenDKIM Filter v2.11.0 mailout2.samsung.com 20231130135150epoutp02b9ca86d2bdb1d5e94d683e9edfc14476~caumlsihE1306313063epoutp027
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=samsung.com;
        s=mail20170921; t=1701352311;
        bh=aP3ywc1rVK9Ng/6mlWNX7XCg5UIfUgmB09BoZ6JOK7s=;
        h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
        b=GC9o/zEqCXght619eFKKoeXO5ZOiy74xsL8yY1yd4ZptGs8hP+lQw1dYwuJObTefX
         LKjEaqBIHuIXfD8XuKXa0IL66/MBrjOsmgiLAgJHgG/0biybTk9nmb/pMtyxQQafFL
         apIotmD5r9TQeHamce+OQRM3R3EsmJ+xEeLoVQPM=
Received: from epsnrtp3.localdomain (unknown [182.195.42.164]) by
        epcas5p1.samsung.com (KnoxPortal) with ESMTP id
        20231130135150epcas5p14470ec61f9e8ab83449f30823863d641~caulsLVX51942519425epcas5p1E;
        Thu, 30 Nov 2023 13:51:50 +0000 (GMT)
Received: from epsmges5p2new.samsung.com (unknown [182.195.38.179]) by
        epsnrtp3.localdomain (Postfix) with ESMTP id 4SgyKc2F5Vz4x9Pr; Thu, 30 Nov
        2023 13:51:48 +0000 (GMT)
Received: from epcas5p3.samsung.com ( [182.195.41.41]) by
        epsmges5p2new.samsung.com (Symantec Messaging Gateway) with SMTP id
        5F.F6.10009.47398656; Thu, 30 Nov 2023 22:51:48 +0900 (KST)
Received: from epsmtrp2.samsung.com (unknown [182.195.40.14]) by
        epcas5p1.samsung.com (KnoxPortal) with ESMTPA id
        20231130115103epcas5p19a56bf80e3c7cb062dba9e60d7363039~cZFJKsTQa3047730477epcas5p1t;
        Thu, 30 Nov 2023 11:51:03 +0000 (GMT)
Received: from epsmgms1p1new.samsung.com (unknown [182.195.42.41]) by
        epsmtrp2.samsung.com (KnoxPortal) with ESMTP id
        20231130115103epsmtrp280fad264f85e09862a67fa59f2715f6b~cZFJJ17vo1512515125epsmtrp2s;
        Thu, 30 Nov 2023 11:51:03 +0000 (GMT)
X-AuditID: b6c32a4a-261fd70000002719-40-656893742661
Received: from epsmtip1.samsung.com ( [182.195.34.30]) by
        epsmgms1p1new.samsung.com (Symantec Messaging Gateway) with SMTP id
        79.A6.08755.72778656; Thu, 30 Nov 2023 20:51:03 +0900 (KST)
Received: from cheetah.sa.corp.samsungelectronics.net (unknown
        [107.109.115.53]) by epsmtip1.samsung.com (KnoxPortal) with ESMTPA id
        20231130115101epsmtip1a2fd41eec6508250484bdcbf17ed971a~cZFHOOs4e1251512515epsmtip1U;
        Thu, 30 Nov 2023 11:51:01 +0000 (GMT)
From: Shradha Todi <shradha.t@samsung.com>
To: manivannan.sadhasivam@linaro.org, lpieralisi@kernel.org,
        kw@linux.com, robh@kernel.org, bhelgaas@google.com,
        jingoohan1@gmail.com, gustavo.pimentel@synopsys.com,
        josh@joshtriplett.org, lukas.bulwahn@gmail.com,
        hongxing.zhu@nxp.com, pankaj.dubey@samsung.com
Cc: linux-kernel@vger.kernel.org, linux-pci@vger.kernel.org,
        Shradha Todi <shradha.t@samsung.com>
Subject: [PATCH v2 1/3] PCI: dwc: Add support for vendor specific capability
 search
Date: Thu, 30 Nov 2023 17:20:42 +0530
Message-Id: <20231130115044.53512-2-shradha.t@samsung.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20231130115044.53512-1-shradha.t@samsung.com>
X-Brightmail-Tracker: H4sIAAAAAAAAA+NgFprBJsWRmVeSWpSXmKPExsWy7bCmpm7J5IxUg6Ob+CyWNGVY7LrbwW4x
        a9tcRosVX2ayW/xfkG/R0POb1eLyrjlsFmfnHWezaPnTwmLRcrSdxeJuSyerxaKtX4DK9uxg
        t+g9XOvA57Fz1l12jwWbSj1uvbb12LSqk83jzrU9bB5Prkxn8tj4bgeTR9+WVYweW/Z/ZvT4
        vEkugCsq2yYjNTEltUghNS85PyUzL91WyTs43jne1MzAUNfQ0sJcSSEvMTfVVsnFJ0DXLTMH
        6HolhbLEnFKgUEBicbGSvp1NUX5pSapCRn5xia1SakFKToFJgV5xYm5xaV66Xl5qiZWhgYGR
        KVBhQnbGtSkTmAve8FVcX3GDrYHxFU8XIweHhICJxJ/X8V2MXBxCArsZJXY938IO4XxilPiz
        fyMThPMNyPn3kLWLkROs49rCHawQib2MEmc+fIJqaWWSeDBjFjNIFZuAlkTj1y5mkISIQBeT
        xKMVJ9lBEswCyRLz+u8wgdjCAqESbQuugNksAqoSi7ofgNm8AlYSK/f9hlonL7F6wwGwoZwC
        1hLPVl1hBBkqITCVQ2Jl8102iCIXicfPW1kgbGGJV8e3sEPYUhKf3+2FqkmXWLl5BjOEnSPx
        bfMSJgjbXuLAlTksoNBgFtCUWL9LHyIsKzH11DomiJv5JHp/P4Eq55XYMQ/GVpb48ncP1FpJ
        iXnHLkPd7CHx5dIzaNj1MUocen+XeQKj3CyEFQsYGVcxSqYWFOempxabFhjlpZbDoy05P3cT
        IziJanntYHz44IPeIUYmDsZDjBIczEoivNefpqcK8aYkVlalFuXHF5XmpBYfYjQFBuBEZinR
        5HxgGs8riTc0sTQwMTMzM7E0NjNUEud93To3RUggPbEkNTs1tSC1CKaPiYNTqoEpzslu02rV
        KYacJz+8m8o+u/bqvYy8NKu3C7clM2zZeXzntheNF332cy5/5H7xjRL3KdOy9XMOnqyMbKjs
        37LKdo7cBRYV28mSep3OxlenFH+J/H81deJTQZfauxNZNdWUl+X/evGpT72ba1t1ubll2NEr
        1+R1PkRKPQ0JuiDXlyMvyDNn36o3h5yXCBo1FXz/dinsYNNDrUkObGZfLYX2ly6ZX3mZ+9HU
        G497HLx2WIRlXFVZ993hHpuY2RPO7acFOJ5yXqr2XMy9b5/M3hvf58QJ35j0UvzD4pkfGNZN
        1dLeeMNAxbl2OrfUwTy2O6teqLNYcdvcvOOe+EWbx1NsomZF5+Sz4ZlrkjXWm6TqKrEUZyQa
        ajEXFScCAPOmaHMrBAAA
X-Brightmail-Tracker: H4sIAAAAAAAAA+NgFjrHLMWRmVeSWpSXmKPExsWy7bCSnK56eUaqwdb1uhZLmjIsdt3tYLeY
        tW0uo8WKLzPZLf4vyLdo6PnNanF51xw2i7PzjrNZtPxpYbFoOdrOYnG3pZPVYtHWL0Ble3aw
        W/QernXg89g56y67x4JNpR63Xtt6bFrVyeZx59oeNo8nV6YzeWx8t4PJo2/LKkaPLfs/M3p8
        3iQXwBXFZZOSmpNZllqkb5fAlXFtygTmgjd8FddX3GBrYHzF08XIySEhYCJxbeEOVhBbSGA3
        o0TjczaIuKTE54vrmCBsYYmV/56zdzFyAdU0M0kcPXeTBSTBJqAl0fi1ixkkISIwg0mipfs+
        WIJZIFXi9uE5YJOEBYIldnddZASxWQRUJRZ1PwCbyitgJbFy329WiA3yEqs3HGAGsTkFrCWe
        rbrCCHGRlcSiXz+YJzDyLWBkWMUomVpQnJueW2xYYJiXWq5XnJhbXJqXrpecn7uJERzkWpo7
        GLev+qB3iJGJg/EQowQHs5II7/Wn6alCvCmJlVWpRfnxRaU5qcWHGKU5WJTEecVf9KYICaQn
        lqRmp6YWpBbBZJk4OKUamExu5+59F6d83XNBwTe5zscvH19unht7P+eof5Y6Q/CyNNWN2gFR
        da9+8O6r+yx5+1WWO0f8A2XFo12VZkIn4jfWfA+c9ajdPYX3I1slv4//G+t4s0MHvp63MLDa
        8tbJYqtf+rc/Wh+PZ3x7t+tNi+P0jvO7lzdNDlR9VMyu6cfoaXY1O6rlNrvFKZ255gcFHt2t
        dzkn+VjjZfyu/1OvP9odvel6DAPDs4Rlyn0JPyXEE6dmv5ge0R2rKKr4LeHUabOlB12m9R+O
        9TxXt23O1dTS4AyfL9yFm83NhOTWcm1MV2AX2nq7Opdvq99V3/5Es92rJd+x7c9uuv1E3/5s
        eYRbbcSrmK61TqqV1y9nKrEUZyQaajEXFScCAEY3aIzhAgAA
X-CMS-MailID: 20231130115103epcas5p19a56bf80e3c7cb062dba9e60d7363039
X-Msg-Generator: CA
Content-Type: text/plain; charset="utf-8"
X-Sendblock-Type: REQ_APPROVE
CMS-TYPE: 105P
DLP-Filter: Pass
X-CFilter-Loop: Reflected
X-CMS-RootMailID: 20231130115103epcas5p19a56bf80e3c7cb062dba9e60d7363039
References: <20231130115044.53512-1-shradha.t@samsung.com>
        <CGME20231130115103epcas5p19a56bf80e3c7cb062dba9e60d7363039@epcas5p1.samsung.com>
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

Add vendor specific extended configuration space capability search API
using struct dw_pcie pointer for DW controllers.

Signed-off-by: Shradha Todi <shradha.t@samsung.com>
---
 drivers/pci/controller/dwc/pcie-designware.c | 16 ++++++++++++++++
 drivers/pci/controller/dwc/pcie-designware.h |  1 +
 2 files changed, 17 insertions(+)

diff --git a/drivers/pci/controller/dwc/pcie-designware.c b/drivers/pci/controller/dwc/pcie-designware.c
index 1c1c7348972b..064b4951afd8 100644
--- a/drivers/pci/controller/dwc/pcie-designware.c
+++ b/drivers/pci/controller/dwc/pcie-designware.c
@@ -275,6 +275,22 @@ static u16 dw_pcie_find_next_ext_capability(struct dw_pcie *pci, u16 start,
 	return 0;
 }
 
+u16 dw_pcie_find_vsec_capability(struct dw_pcie *pci, u8 vsec_cap)
+{
+	u16 vsec = 0;
+	u32 header;
+
+	while ((vsec = dw_pcie_find_next_ext_capability(pci, vsec,
+					PCI_EXT_CAP_ID_VNDR))) {
+		header = dw_pcie_readl_dbi(pci, vsec + PCI_VNDR_HEADER);
+		if (PCI_VNDR_HEADER_ID(header) == vsec_cap)
+			return vsec;
+	}
+
+	return 0;
+}
+EXPORT_SYMBOL_GPL(dw_pcie_find_vsec_capability);
+
 u16 dw_pcie_find_ext_capability(struct dw_pcie *pci, u8 cap)
 {
 	return dw_pcie_find_next_ext_capability(pci, 0, cap);
diff --git a/drivers/pci/controller/dwc/pcie-designware.h b/drivers/pci/controller/dwc/pcie-designware.h
index ef0b2efa9f93..b7ea1db14f6a 100644
--- a/drivers/pci/controller/dwc/pcie-designware.h
+++ b/drivers/pci/controller/dwc/pcie-designware.h
@@ -419,6 +419,7 @@ void dw_pcie_version_detect(struct dw_pcie *pci);
 
 u8 dw_pcie_find_capability(struct dw_pcie *pci, u8 cap);
 u16 dw_pcie_find_ext_capability(struct dw_pcie *pci, u8 cap);
+u16 dw_pcie_find_vsec_capability(struct dw_pcie *pci, u8 vsec_cap);
 
 int dw_pcie_read(void __iomem *addr, int size, u32 *val);
 int dw_pcie_write(void __iomem *addr, int size, u32 val);
-- 
2.17.1


From mboxrd@z Thu Jan  1 00:00:00 1970
Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
	aws-us-west-2-korg-lkml-1.web.codeaurora.org
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by smtp.lore.kernel.org (Postfix) with ESMTP id A07A2C4167B
	for <linux-kernel@archiver.kernel.org>; Thu, 30 Nov 2023 13:52:20 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1345731AbjK3NwM (ORCPT
        <rfc822;linux-kernel@archiver.kernel.org>);
        Thu, 30 Nov 2023 08:52:12 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:38226 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1345699AbjK3NwJ (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Thu, 30 Nov 2023 08:52:09 -0500
Received: from mailout1.samsung.com (mailout1.samsung.com [203.254.224.24])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id CA9D6DD
        for <linux-kernel@vger.kernel.org>; Thu, 30 Nov 2023 05:52:13 -0800 (PST)
Received: from epcas5p2.samsung.com (unknown [182.195.41.40])
        by mailout1.samsung.com (KnoxPortal) with ESMTP id 20231130135211epoutp01995a9edd631ae019c397b3d37592d8cc~cau6HNyiB2363223632epoutp01t
        for <linux-kernel@vger.kernel.org>; Thu, 30 Nov 2023 13:52:11 +0000 (GMT)
DKIM-Filter: OpenDKIM Filter v2.11.0 mailout1.samsung.com 20231130135211epoutp01995a9edd631ae019c397b3d37592d8cc~cau6HNyiB2363223632epoutp01t
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=samsung.com;
        s=mail20170921; t=1701352331;
        bh=el2EMF2pw9poBvudu5k2NHrrxT2CJUFD6UGrLP2gnFw=;
        h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
        b=tNywrz5CEcnYxIVJP8SCIj9doXeSHtgNq4LuaqIITTvQHdxy1pGTCnwQdbTee8mDG
         RtNpBz6OKyDucB3iNnaxvrPYOsXwN/Dx64Xeh9obf2lsuPZs71PU6zSoLlwJfRcU0V
         pGADB64roPXDB8sV+au2vRTFaxO3JwqAJ5qgF/Hw=
Received: from epsnrtp3.localdomain (unknown [182.195.42.164]) by
        epcas5p4.samsung.com (KnoxPortal) with ESMTP id
        20231130135211epcas5p4db69fa1ae2996a3ea71f22bdd45a51d8~cau5kHveo3224032240epcas5p4M;
        Thu, 30 Nov 2023 13:52:11 +0000 (GMT)
Received: from epsmgec5p1-new.samsung.com (unknown [182.195.38.174]) by
        epsnrtp3.localdomain (Postfix) with ESMTP id 4SgyL161Z4z4x9Pr; Thu, 30 Nov
        2023 13:52:09 +0000 (GMT)
Received: from epcas5p3.samsung.com ( [182.195.41.41]) by
        epsmgec5p1-new.samsung.com (Symantec Messaging Gateway) with SMTP id
        8C.79.19369.98398656; Thu, 30 Nov 2023 22:52:09 +0900 (KST)
Received: from epsmtrp2.samsung.com (unknown [182.195.40.14]) by
        epcas5p1.samsung.com (KnoxPortal) with ESMTPA id
        20231130115108epcas5p1b874d14bc1e306a0860c6671b149a35c~cZFN2qmrg0515605156epcas5p1F;
        Thu, 30 Nov 2023 11:51:08 +0000 (GMT)
Received: from epsmgmc1p1new.samsung.com (unknown [182.195.42.40]) by
        epsmtrp2.samsung.com (KnoxPortal) with ESMTP id
        20231130115108epsmtrp22ec59bcdb948287c6be7b84bc800251c~cZFN1z0ab1512415124epsmtrp20;
        Thu, 30 Nov 2023 11:51:08 +0000 (GMT)
X-AuditID: b6c32a50-c99ff70000004ba9-fd-65689389f44d
Received: from epsmtip1.samsung.com ( [182.195.34.30]) by
        epsmgmc1p1new.samsung.com (Symantec Messaging Gateway) with SMTP id
        85.51.07368.C2778656; Thu, 30 Nov 2023 20:51:08 +0900 (KST)
Received: from cheetah.sa.corp.samsungelectronics.net (unknown
        [107.109.115.53]) by epsmtip1.samsung.com (KnoxPortal) with ESMTPA id
        20231130115106epsmtip1e8bf73fc5b021d813fd5fc2c7c3a7050~cZFL1358T1476714767epsmtip1k;
        Thu, 30 Nov 2023 11:51:06 +0000 (GMT)
From: Shradha Todi <shradha.t@samsung.com>
To: manivannan.sadhasivam@linaro.org, lpieralisi@kernel.org,
        kw@linux.com, robh@kernel.org, bhelgaas@google.com,
        jingoohan1@gmail.com, gustavo.pimentel@synopsys.com,
        josh@joshtriplett.org, lukas.bulwahn@gmail.com,
        hongxing.zhu@nxp.com, pankaj.dubey@samsung.com
Cc: linux-kernel@vger.kernel.org, linux-pci@vger.kernel.org,
        Shradha Todi <shradha.t@samsung.com>
Subject: [PATCH v2 2/3] PCI: debugfs: Add support for RASDES framework in
 DWC
Date: Thu, 30 Nov 2023 17:20:43 +0530
Message-Id: <20231130115044.53512-3-shradha.t@samsung.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20231130115044.53512-1-shradha.t@samsung.com>
X-Brightmail-Tracker: H4sIAAAAAAAAA+NgFprFJsWRmVeSWpSXmKPExsWy7bCmpm7n5IxUg0n/NCyWNGVY7LrbwW4x
        a9tcRosVX2ayW/xfkG/R0POb1eLyrjlsFmfnHWezaPnTwmLRcrSdxeJuSyerxaKtX4DK9uxg
        t+g9XOvA57Fz1l12jwWbSj1uvbb12LSqk83jzrU9bB5Prkxn8tj4bgeTR9+WVYweW/Z/ZvT4
        vEkugCsq2yYjNTEltUghNS85PyUzL91WyTs43jne1MzAUNfQ0sJcSSEvMTfVVsnFJ0DXLTMH
        6HolhbLEnFKgUEBicbGSvp1NUX5pSapCRn5xia1SakFKToFJgV5xYm5xaV66Xl5qiZWhgYGR
        KVBhQnbG+pXnWAtWdTNWnOzvY2tgXFncxcjJISFgInHlSAc7iC0ksIdR4tF9jy5GLiD7E6NE
        /4JuVgjnG6PEvm1XGWE6vk7dB5XYyyjxZkUjC4TTyiQx9XgPC0gVm4CWROPXLmaQhIhAF5PE
        oxUnwZYwCyRLzOu/wwRiCwv4S8xeuZ0ZxGYRUJVo/fGcDcTmFbCSWD1jKzPEOnmJ1RsOgNmc
        AtYSz1ZdYQQZKiEwlUNiY/MpqCIXibYTt6FsYYlXx7ewQ9hSEp/f7WWDsNMlVm6eAVWTI/Ft
        8xImCNte4sCVOUBXcwAdpymxfpc+RFhWYuqpdUwQN/NJ9P5+AlXOK7FjHoytLPHl7x4WCFtS
        Yt6xy6wQtofE2btL2SCh0sco8eP3OrYJjHKzEFYsYGRcxSiVWlCcm56abFpgqJuXWg6PuOT8
        3E2M4ESqFbCDcfWGv3qHGJk4GA8xSnAwK4nwXn+anirEm5JYWZValB9fVJqTWnyI0RQYghOZ
        pUST84GpPK8k3tDE0sDEzMzMxNLYzFBJnPd169wUIYH0xJLU7NTUgtQimD4mDk6pBqaNH8t7
        hSVbbh52WFa2YNly7cbsttKK227Pw7adfZd8oKDj/rk586PVzX9scHbottBL+FC/J778sLlp
        iZGIyS6B3K9f/XZOcLQLkhUz1ue5rvVng6ybj77B1rJJKtK782Js60rPeMg7Zufk92xniHqZ
        IXPMzTnhSMuhM17c890+LQqeP0tUn/tsJv97r28zYkWYTFY9Dn3b7BxkueXAFk4/tt17OpKv
        v1Q7slXxpmGg2k+uz9OU9jWdVw5TLpFs/5GvFjA3cZ+5ePqTww8vnzw+g/nv9s/ac7oicozW
        C2g88dr6/vm2vA694/xHw//saWs+18m36sfzT4aOGnN0tJ43Rqj8tlzxckNZ7ON7LEosxRmJ
        hlrMRcWJAA+ii38tBAAA
X-Brightmail-Tracker: H4sIAAAAAAAAA+NgFrrALMWRmVeSWpSXmKPExsWy7bCSnK5OeUaqwaMTmhZLmjIsdt3tYLeY
        tW0uo8WKLzPZLf4vyLdo6PnNanF51xw2i7PzjrNZtPxpYbFoOdrOYnG3pZPVYtHWL0Ble3aw
        W/QernXg89g56y67x4JNpR63Xtt6bFrVyeZx59oeNo8nV6YzeWx8t4PJo2/LKkaPLfs/M3p8
        3iQXwBXFZZOSmpNZllqkb5fAlbF+5TnWglXdjBUn+/vYGhhXFncxcnJICJhIfJ26j7WLkYtD
        SGA3o8SFZR/YIRKSEp8vrmOCsIUlVv57zg5R1MwkceTXLTaQBJuAlkTj1y5mkISIwAwmiZbu
        +ywgCWaBVInbh+eAFQkL+ErMOPkZzGYRUJVo/fEczOYVsJJYPWMrM8QGeYnVGw6A2ZwC1hLP
        Vl1hBLGFgGoW/frBPIGRbwEjwypGydSC4tz03GTDAsO81HK94sTc4tK8dL3k/NxNjOBA19LY
        wXhv/j+9Q4xMHIyHGCU4mJVEeK8/TU8V4k1JrKxKLcqPLyrNSS0+xCjNwaIkzms4Y3aKkEB6
        YklqdmpqQWoRTJaJg1OqgSle+2Pv3NaQ7x8ChaJ+vfpqsOi79ap7H9OTJ3Uvurg8PD5x5b2j
        /S4PXk7tvRaXvqk5YP450ehFh9s7PUX3TI6eLLkuL2xehtxze2aNfXO0f82Le1651Cnuo9Fm
        jnP+YWl/PBXV31RPjmgI8ZI/tfqufetCpi8MNcZ3C63e7592Z33sprxZzmJCqtGXwvhtWJpy
        7vYLesvHHYpZvOSvlMPh+9/DP1uvNPn6unXJQwXmRB4e82s8Czgf75GP+iKtsyLI/nlCb4Zg
        R6H946uvP15N/qXVO8PwZeVj/U9FSh7J2Ue+LAz9xlX7v4zlqeOsNFe/pzHGVQ/6uw1PXGEr
        SmCbaW6SdKeddfeMs9ZnuZVYijMSDbWYi4oTAVTatVbjAgAA
X-CMS-MailID: 20231130115108epcas5p1b874d14bc1e306a0860c6671b149a35c
X-Msg-Generator: CA
Content-Type: text/plain; charset="utf-8"
X-Sendblock-Type: REQ_APPROVE
CMS-TYPE: 105P
DLP-Filter: Pass
X-CFilter-Loop: Reflected
X-CMS-RootMailID: 20231130115108epcas5p1b874d14bc1e306a0860c6671b149a35c
References: <20231130115044.53512-1-shradha.t@samsung.com>
        <CGME20231130115108epcas5p1b874d14bc1e306a0860c6671b149a35c@epcas5p1.samsung.com>
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

Add support to use the RASDES feature of DesignWare PCIe controller
using debugfs entries.

RASDES is a vendor specific extended PCIe capability which reads the
current hardware internal state of PCIe device. Following primary
features are provided to userspace via debugfs:
- Debug registers
- Error injection
- Statistical counters

Signed-off-by: Shradha Todi <shradha.t@samsung.com>
---
 drivers/pci/controller/dwc/Kconfig            |   8 +
 drivers/pci/controller/dwc/Makefile           |   1 +
 .../controller/dwc/pcie-designware-debugfs.c  | 476 ++++++++++++++++++
 .../controller/dwc/pcie-designware-debugfs.h  |   0
 drivers/pci/controller/dwc/pcie-designware.h  |  17 +
 5 files changed, 502 insertions(+)
 create mode 100644 drivers/pci/controller/dwc/pcie-designware-debugfs.c
 create mode 100644 drivers/pci/controller/dwc/pcie-designware-debugfs.h

diff --git a/drivers/pci/controller/dwc/Kconfig b/drivers/pci/controller/dwc/Kconfig
index ab96da43e0c2..fc84ba03b20e 100644
--- a/drivers/pci/controller/dwc/Kconfig
+++ b/drivers/pci/controller/dwc/Kconfig
@@ -6,6 +6,14 @@ menu "DesignWare-based PCIe controllers"
 config PCIE_DW
 	bool
 
+config PCIE_DW_DEBUGFS
+	bool "DWC PCIe debugfs entries"
+	help
+	  Enables debugfs entries for the DWC PCIe Controller.
+	  These entries make use of the RAS features in the DW
+	  controller to help in debug, error injection and statistical
+	  counters
+
 config PCIE_DW_HOST
 	bool
 	select PCIE_DW
diff --git a/drivers/pci/controller/dwc/Makefile b/drivers/pci/controller/dwc/Makefile
index bf5c311875a1..cbd1618b0b20 100644
--- a/drivers/pci/controller/dwc/Makefile
+++ b/drivers/pci/controller/dwc/Makefile
@@ -1,5 +1,6 @@
 # SPDX-License-Identifier: GPL-2.0
 obj-$(CONFIG_PCIE_DW) += pcie-designware.o
+obj-$(CONFIG_PCIE_DW_DEBUGFS) += pcie-designware-debugfs.o
 obj-$(CONFIG_PCIE_DW_HOST) += pcie-designware-host.o
 obj-$(CONFIG_PCIE_DW_EP) += pcie-designware-ep.o
 obj-$(CONFIG_PCIE_DW_PLAT) += pcie-designware-plat.o
diff --git a/drivers/pci/controller/dwc/pcie-designware-debugfs.c b/drivers/pci/controller/dwc/pcie-designware-debugfs.c
new file mode 100644
index 000000000000..46481650ed6b
--- /dev/null
+++ b/drivers/pci/controller/dwc/pcie-designware-debugfs.c
@@ -0,0 +1,476 @@
+// SPDX-License-Identifier: GPL-2.0
+/*
+ * Synopsys DesignWare PCIe controller debugfs driver
+ *
+ * Copyright (C) 2023 Samsung Electronics Co., Ltd.
+ *		http://www.samsung.com
+ *
+ * Author: Shradha Todi <shradha.t@samsung.com>
+ */
+
+#include <linux/debugfs.h>
+
+#include "pcie-designware.h"
+
+#define RAS_DES_EVENT_COUNTER_CTRL_REG	0x8
+#define RAS_DES_EVENT_COUNTER_DATA_REG	0xc
+#define SD_STATUS_L1LANE_REG		0xb0
+#define ERR_INJ_ENABLE_REG		0x30
+#define ERR_INJ0_OFF			0x34
+
+#define LANE_DETECT_SHIFT		17
+#define LANE_DETECT_MASK		0x1
+#define PIPE_RXVALID_SHIFT		18
+#define PIPE_RXVALID_MASK		0x1
+
+#define LANE_SELECT_SHIFT		8
+#define LANE_SELECT_MASK		0xf
+#define EVENT_COUNTER_STATUS_SHIFT	7
+#define EVENT_COUNTER_STATUS_MASK	0x1
+#define EVENT_COUNTER_ENABLE		(0x7 << 2)
+#define PER_EVENT_OFF			(0x1 << 2)
+#define PER_EVENT_ON			(0x3 << 2)
+
+#define EINJ_COUNT_MASK			0xff
+#define EINJ_TYPE_MASK			0xf
+#define EINJ_TYPE_SHIFT			8
+#define EINJ_INFO_MASK			0xfffff
+#define EINJ_INFO_SHIFT			12
+
+#define DWC_DEBUGFS_MAX			128
+
+struct rasdes_info {
+	/* to store rasdes capability offset */
+	u32 ras_cap;
+	struct mutex dbg_mutex;
+	struct dentry *rasdes;
+};
+
+struct rasdes_priv {
+	struct dw_pcie *pci;
+	int idx;
+};
+
+struct event_counter {
+	const char *name;
+	/* values can be between 0-15 */
+	u32 group_no;
+	/* values can be between 0-32 */
+	u32 event_no;
+};
+
+static const struct event_counter event_counters[] = {
+	{"ebuf_overflow", 0x0, 0x0},
+	{"ebuf_underrun", 0x0, 0x1},
+	{"decode_err", 0x0, 0x2},
+	{"running_disparity_err", 0x0, 0x3},
+	{"skp_os_parity_err", 0x0, 0x4},
+	{"sync_header_err", 0x0, 0x5},
+	{"detect_ei_infer", 0x1, 0x5},
+	{"receiver_err", 0x1, 0x6},
+	{"rx_recovery_req", 0x1, 0x7},
+	{"framing_err", 0x1, 0x9},
+	{"deskew_err", 0x1, 0xa},
+	{"bad_tlp", 0x2, 0x0},
+	{"lcrc_err", 0x2, 0x1},
+	{"bad_dllp", 0x2, 0x2},
+};
+
+struct err_inj {
+	const char *name;
+	/* values can be from group 0 - 6 */
+	u32 err_inj_group;
+	/* within each group there can be types */
+	u32 err_inj_type;
+	/* More details about the error */
+	u32 err_inj_12_31;
+};
+
+static const struct err_inj err_inj_list[] = {
+	{"tx_lcrc", 0x0, 0x0, 0x0},
+	{"tx_ecrc", 0x0, 0x3, 0x0},
+	{"rx_lcrc", 0x0, 0x8, 0x0},
+	{"rx_ecrc", 0x0, 0xb, 0x0},
+};
+
+static ssize_t dbg_lane_detect_read(struct file *file, char __user *buf,
+				    size_t count, loff_t *ppos)
+{
+	struct dw_pcie *pci = file->private_data;
+	struct rasdes_info *rinfo = pci->dump_info;
+	u32 val;
+	ssize_t off = 0;
+	char debugfs_buf[DWC_DEBUGFS_MAX];
+
+	val = dw_pcie_readl_dbi(pci, rinfo->ras_cap + SD_STATUS_L1LANE_REG);
+	val = (val >> LANE_DETECT_SHIFT) & LANE_DETECT_MASK;
+	if (val)
+		off += scnprintf(debugfs_buf, DWC_DEBUGFS_MAX - off,
+				 "Detected\n");
+	else
+		off += scnprintf(debugfs_buf, DWC_DEBUGFS_MAX - off,
+				 "Undetected\n");
+
+	return simple_read_from_buffer(buf, count, ppos, debugfs_buf, off);
+}
+
+static ssize_t dbg_lane_detect_write(struct file *file, const char __user *buf,
+				     size_t count, loff_t *ppos)
+{
+	struct dw_pcie *pci = file->private_data;
+	struct rasdes_info *rinfo = pci->dump_info;
+	u32 val;
+	u32 lane;
+
+	val = kstrtou32_from_user(buf, count, 0, &lane);
+	if (val)
+		return val;
+
+	if (lane > 15)
+		return -EINVAL;
+
+	val = dw_pcie_readl_dbi(pci, rinfo->ras_cap + SD_STATUS_L1LANE_REG);
+	val &= ~LANE_SELECT_MASK;
+	val |= lane;
+	dw_pcie_writel_dbi(pci, rinfo->ras_cap + SD_STATUS_L1LANE_REG, val);
+
+	return count;
+}
+
+static ssize_t dbg_rx_valid_read(struct file *file, char __user *buf,
+				 size_t count, loff_t *ppos)
+{
+	struct dw_pcie *pci = file->private_data;
+	struct rasdes_info *rinfo = pci->dump_info;
+	u32 val;
+	ssize_t off = 0;
+	char debugfs_buf[DWC_DEBUGFS_MAX];
+
+	val = dw_pcie_readl_dbi(pci, rinfo->ras_cap + SD_STATUS_L1LANE_REG);
+	val = (val >> PIPE_RXVALID_SHIFT) & PIPE_RXVALID_MASK;
+	if (val)
+		off += scnprintf(debugfs_buf, DWC_DEBUGFS_MAX - off,
+				 "Valid\n");
+	else
+		off += scnprintf(debugfs_buf, DWC_DEBUGFS_MAX - off,
+				 "Invalid\n");
+
+	return simple_read_from_buffer(buf, count, ppos, debugfs_buf, off);
+}
+
+static ssize_t dbg_rx_valid_write(struct file *file, const char __user *buf,
+				  size_t count, loff_t *ppos)
+{
+	return dbg_lane_detect_write(file, buf, count, ppos);
+}
+
+static void set_event_number(struct rasdes_priv *pdata, struct dw_pcie *pci,
+			     struct rasdes_info *rinfo)
+{
+	u32 val;
+
+	val = dw_pcie_readl_dbi(pci, rinfo->ras_cap +
+				RAS_DES_EVENT_COUNTER_CTRL_REG);
+	val &= ~EVENT_COUNTER_ENABLE;
+	val &= ~(0xFFF << 16);
+	val |= (event_counters[pdata->idx].group_no << 24);
+	val |= (event_counters[pdata->idx].event_no << 16);
+	dw_pcie_writel_dbi(pci, rinfo->ras_cap +
+			   RAS_DES_EVENT_COUNTER_CTRL_REG, val);
+}
+
+static ssize_t cnt_en_read(struct file *file, char __user *buf, size_t count,
+			   loff_t *ppos)
+{
+	struct rasdes_priv *pdata = file->private_data;
+	struct dw_pcie *pci = pdata->pci;
+	struct rasdes_info *rinfo = pci->dump_info;
+	u32 val;
+	ssize_t off = 0;
+	char debugfs_buf[DWC_DEBUGFS_MAX];
+
+	mutex_lock(&rinfo->dbg_mutex);
+	set_event_number(pdata, pci, rinfo);
+	val = dw_pcie_readl_dbi(pci, rinfo->ras_cap +
+				RAS_DES_EVENT_COUNTER_CTRL_REG);
+	mutex_unlock(&rinfo->dbg_mutex);
+	val = (val >> EVENT_COUNTER_STATUS_SHIFT) & EVENT_COUNTER_STATUS_MASK;
+	if (val)
+		off += scnprintf(debugfs_buf, DWC_DEBUGFS_MAX - off,
+				 "Enabled\n");
+	else
+		off += scnprintf(debugfs_buf, DWC_DEBUGFS_MAX - off,
+				 "Disabled\n");
+
+	return simple_read_from_buffer(buf, count, ppos, debugfs_buf, off);
+}
+
+static ssize_t cnt_en_write(struct file *file, const char __user *buf,
+			    size_t count, loff_t *ppos)
+{
+	struct rasdes_priv *pdata = file->private_data;
+	struct dw_pcie *pci = pdata->pci;
+	struct rasdes_info *rinfo = pci->dump_info;
+	u32 val;
+	u32 enable;
+
+	val = kstrtou32_from_user(buf, count, 0, &enable);
+	if (val)
+		return val;
+
+	mutex_lock(&rinfo->dbg_mutex);
+	set_event_number(pdata, pci, rinfo);
+	val = dw_pcie_readl_dbi(pci, rinfo->ras_cap +
+				RAS_DES_EVENT_COUNTER_CTRL_REG);
+	if (enable)
+		val |= PER_EVENT_ON;
+	else
+		val |= PER_EVENT_OFF;
+
+	dw_pcie_writel_dbi(pci, rinfo->ras_cap +
+			   RAS_DES_EVENT_COUNTER_CTRL_REG, val);
+	mutex_unlock(&rinfo->dbg_mutex);
+
+	return count;
+}
+
+static ssize_t cnt_lane_read(struct file *file, char __user *buf, size_t count,
+			     loff_t *ppos)
+{
+	struct rasdes_priv *pdata = file->private_data;
+	struct dw_pcie *pci = pdata->pci;
+	struct rasdes_info *rinfo = pci->dump_info;
+	u32 val;
+	ssize_t off = 0;
+	char debugfs_buf[DWC_DEBUGFS_MAX];
+
+	mutex_lock(&rinfo->dbg_mutex);
+	set_event_number(pdata, pci, rinfo);
+	val = dw_pcie_readl_dbi(pci, rinfo->ras_cap +
+				RAS_DES_EVENT_COUNTER_CTRL_REG);
+	mutex_unlock(&rinfo->dbg_mutex);
+	val = (val >> LANE_SELECT_SHIFT) & LANE_SELECT_MASK;
+	off += scnprintf(debugfs_buf, DWC_DEBUGFS_MAX - off,
+				 "Lane: %d\n", val);
+
+	return simple_read_from_buffer(buf, count, ppos, debugfs_buf, off);
+}
+
+static ssize_t cnt_lane_write(struct file *file, const char __user *buf,
+			      size_t count, loff_t *ppos)
+{
+	struct rasdes_priv *pdata = file->private_data;
+	struct dw_pcie *pci = pdata->pci;
+	struct rasdes_info *rinfo = pci->dump_info;
+	u32 val;
+	u32 lane;
+
+	val = kstrtou32_from_user(buf, count, 0, &lane);
+	if (val)
+		return val;
+
+	if (lane > 15)
+		return -EINVAL;
+
+	mutex_lock(&rinfo->dbg_mutex);
+	set_event_number(pdata, pci, rinfo);
+	val = dw_pcie_readl_dbi(pci, rinfo->ras_cap +
+				RAS_DES_EVENT_COUNTER_CTRL_REG);
+	val &= ~(LANE_SELECT_MASK << LANE_SELECT_SHIFT);
+	val |= (lane << LANE_SELECT_SHIFT);
+	dw_pcie_writel_dbi(pci, rinfo->ras_cap +
+			   RAS_DES_EVENT_COUNTER_CTRL_REG, val);
+	mutex_unlock(&rinfo->dbg_mutex);
+
+	return count;
+}
+
+static ssize_t cnt_val_read(struct file *file, char __user *buf, size_t count,
+			    loff_t *ppos)
+{
+	struct rasdes_priv *pdata = file->private_data;
+	struct dw_pcie *pci = pdata->pci;
+	struct rasdes_info *rinfo = pci->dump_info;
+	u32 val;
+	ssize_t off = 0;
+	char debugfs_buf[DWC_DEBUGFS_MAX];
+
+	mutex_lock(&rinfo->dbg_mutex);
+	set_event_number(pdata, pci, rinfo);
+	val = dw_pcie_readl_dbi(pci, rinfo->ras_cap +
+				RAS_DES_EVENT_COUNTER_DATA_REG);
+	mutex_unlock(&rinfo->dbg_mutex);
+	off += scnprintf(debugfs_buf, DWC_DEBUGFS_MAX - off,
+				 "Value: %d\n", val);
+
+	return simple_read_from_buffer(buf, count, ppos, debugfs_buf, off);
+}
+
+static ssize_t err_inj_read(struct file *file, char __user *buf,
+				  size_t count, loff_t *ppos)
+{
+	struct rasdes_priv *pdata = file->private_data;
+	struct dw_pcie *pci = pdata->pci;
+	struct rasdes_info *rinfo = pci->dump_info;
+	u32 val;
+	ssize_t off = 0;
+	char debugfs_buf[DWC_DEBUGFS_MAX];
+
+	val = dw_pcie_readl_dbi(pci, rinfo->ras_cap + ERR_INJ0_OFF +
+			(0x4 * err_inj_list[pdata->idx].err_inj_group));
+	val &= EINJ_COUNT_MASK;
+	off += scnprintf(debugfs_buf, DWC_DEBUGFS_MAX - off,
+				 "Count: %d\n", val);
+
+	return simple_read_from_buffer(buf, count, ppos, debugfs_buf, off);
+}
+
+static ssize_t err_inj_write(struct file *file, const char __user *buf,
+			     size_t count, loff_t *ppos)
+{
+	struct rasdes_priv *pdata = file->private_data;
+	struct dw_pcie *pci = pdata->pci;
+	struct rasdes_info *rinfo = pci->dump_info;
+	u32 val;
+	u32 counter;
+
+	val = kstrtou32_from_user(buf, count, 0, &counter);
+	if (val)
+		return val;
+
+	val = dw_pcie_readl_dbi(pci, rinfo->ras_cap + ERR_INJ0_OFF +
+			(0x4 * err_inj_list[pdata->idx].err_inj_group));
+	val &= ~(EINJ_TYPE_MASK << EINJ_TYPE_SHIFT);
+	val |= err_inj_list[pdata->idx].err_inj_type << EINJ_TYPE_SHIFT;
+	val &= ~(EINJ_INFO_MASK << EINJ_INFO_SHIFT);
+	val |= err_inj_list[pdata->idx].err_inj_12_31 << EINJ_INFO_SHIFT;
+	val &= ~EINJ_COUNT_MASK;
+	val |= counter;
+	dw_pcie_writel_dbi(pci, rinfo->ras_cap + ERR_INJ0_OFF +
+			(0x4 * err_inj_list[pdata->idx].err_inj_group), val);
+	dw_pcie_writel_dbi(pci, rinfo->ras_cap + ERR_INJ_ENABLE_REG,
+			   (0x1 << err_inj_list[pdata->idx].err_inj_group));
+
+	return count;
+}
+
+#define dwc_debugfs_create(name)			\
+debugfs_create_file(#name, 0644, rasdes_debug, pci,	\
+			&dbg_ ## name ## _fops)
+
+#define DWC_DEBUGFS_FOPS(name)					\
+static const struct file_operations dbg_ ## name ## _fops = {	\
+	.read = dbg_ ## name ## _read,				\
+	.write = dbg_ ## name ## _write				\
+}
+
+DWC_DEBUGFS_FOPS(lane_detect);
+DWC_DEBUGFS_FOPS(rx_valid);
+
+static const struct file_operations cnt_en_ops = {
+	.open = simple_open,
+	.read = cnt_en_read,
+	.write = cnt_en_write,
+};
+
+static const struct file_operations cnt_lane_ops = {
+	.open = simple_open,
+	.read = cnt_lane_read,
+	.write = cnt_lane_write,
+};
+
+static const struct file_operations cnt_val_ops = {
+	.open = simple_open,
+	.read = cnt_val_read,
+};
+
+static const struct file_operations err_inj_ops = {
+	.open = simple_open,
+	.read = err_inj_read,
+	.write = err_inj_write,
+};
+
+void dwc_pcie_rasdes_debugfs_deinit(struct dw_pcie *pci)
+{
+	struct rasdes_info *rinfo = pci->dump_info;
+
+	debugfs_remove_recursive(rinfo->rasdes);
+	mutex_destroy(&rinfo->dbg_mutex);
+}
+
+int dwc_pcie_rasdes_debugfs_init(struct dw_pcie *pci)
+{
+	struct device *dev = pci->dev;
+	int ras_cap;
+	struct rasdes_info *dump_info;
+	char dirname[DWC_DEBUGFS_MAX];
+	struct dentry *dir, *rasdes_debug, *rasdes_err_inj;
+	struct dentry *rasdes_event_counter, *rasdes_events;
+	int i;
+	struct rasdes_priv *priv_tmp;
+
+	ras_cap = dw_pcie_find_vsec_capability(pci, DW_PCIE_RAS_DES_CAP);
+	if (!ras_cap) {
+		dev_err(dev, "No RASDES capability available\n");
+		return -ENODEV;
+	}
+
+	dump_info = devm_kzalloc(dev, sizeof(*dump_info), GFP_KERNEL);
+	if (!dump_info)
+		return -ENOMEM;
+
+	/* Create main directory for each platform driver */
+	sprintf(dirname, "pcie_dwc_%s", dev_name(dev));
+	dir = debugfs_create_dir(dirname, NULL);
+
+	/* Create subdirectories for Debug, Error injection, Statistics */
+	rasdes_debug = debugfs_create_dir("rasdes_debug", dir);
+	rasdes_err_inj = debugfs_create_dir("rasdes_err_inj", dir);
+	rasdes_event_counter = debugfs_create_dir("rasdes_event_counter", dir);
+
+	mutex_init(&dump_info->dbg_mutex);
+	dump_info->ras_cap = ras_cap;
+	dump_info->rasdes = dir;
+	pci->dump_info = dump_info;
+
+	/* Create debugfs files for Debug subdirectory */
+	dwc_debugfs_create(lane_detect);
+	dwc_debugfs_create(rx_valid);
+
+	/* Create debugfs files for Error injection subdirectory */
+	for (i = 0; i < ARRAY_SIZE(err_inj_list); i++) {
+		priv_tmp = devm_kzalloc(dev, sizeof(*priv_tmp), GFP_KERNEL);
+		if (!priv_tmp)
+			goto err;
+
+		priv_tmp->idx = i;
+		priv_tmp->pci = pci;
+		debugfs_create_file(err_inj_list[i].name, 0644,
+				    rasdes_err_inj, priv_tmp, &err_inj_ops);
+	}
+
+	/* Create debugfs files for Statistical counter subdirectory */
+	for (i = 0; i < ARRAY_SIZE(event_counters); i++) {
+		priv_tmp = devm_kzalloc(dev, sizeof(*priv_tmp), GFP_KERNEL);
+		if (!priv_tmp)
+			goto err;
+
+		priv_tmp->idx = i;
+		priv_tmp->pci = pci;
+		rasdes_events = debugfs_create_dir(event_counters[i].name,
+						   rasdes_event_counter);
+		if (event_counters[i].group_no == 0) {
+			debugfs_create_file("lane_select", 0644, rasdes_events,
+					    priv_tmp, &cnt_lane_ops);
+		}
+		debugfs_create_file("counter_value", 0644, rasdes_events, priv_tmp,
+				    &cnt_val_ops);
+		debugfs_create_file("counter_enable", 0444, rasdes_events, priv_tmp,
+				    &cnt_en_ops);
+	}
+
+	return 0;
+err:
+	dwc_pcie_rasdes_debugfs_deinit(pci);
+	return -ENOMEM;
+}
diff --git a/drivers/pci/controller/dwc/pcie-designware-debugfs.h b/drivers/pci/controller/dwc/pcie-designware-debugfs.h
new file mode 100644
index 000000000000..e69de29bb2d1
diff --git a/drivers/pci/controller/dwc/pcie-designware.h b/drivers/pci/controller/dwc/pcie-designware.h
index b7ea1db14f6a..d3453db34c1f 100644
--- a/drivers/pci/controller/dwc/pcie-designware.h
+++ b/drivers/pci/controller/dwc/pcie-designware.h
@@ -222,6 +222,8 @@
 
 #define PCIE_RAS_DES_EVENT_COUNTER_DATA		0xc
 
+#define DW_PCIE_RAS_DES_CAP			0x2
+
 /*
  * The default address offset between dbi_base and atu_base. Root controller
  * drivers are not required to initialize atu_base if the offset matches this
@@ -406,6 +408,7 @@ struct dw_pcie {
 	struct reset_control_bulk_data	core_rsts[DW_PCIE_NUM_CORE_RSTS];
 	struct gpio_desc		*pe_rst;
 	bool			suspended;
+	void			*dump_info;
 };
 
 #define to_dw_pcie_from_pp(port) container_of((port), struct dw_pcie, pp)
@@ -643,4 +646,18 @@ dw_pcie_ep_get_func_from_ep(struct dw_pcie_ep *ep, u8 func_no)
 	return NULL;
 }
 #endif
+
+#ifdef CONFIG_PCIE_DW_DEBUGFS
+int dwc_pcie_rasdes_debugfs_init(struct dw_pcie *pci);
+void dwc_pcie_rasdes_debugfs_deinit(struct dw_pcie *pci);
+#else
+static inline int dwc_pcie_rasdes_debugfs_init(struct dw_pcie *pci)
+{
+	return 0;
+}
+static inline void dwc_pcie_rasdes_debugfs_deinit(struct dw_pcie *pci)
+{
+}
+#endif
+
 #endif /* _PCIE_DESIGNWARE_H */
-- 
2.17.1


From mboxrd@z Thu Jan  1 00:00:00 1970
Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
	aws-us-west-2-korg-lkml-1.web.codeaurora.org
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by smtp.lore.kernel.org (Postfix) with ESMTP id 12E91C4167B
	for <linux-kernel@archiver.kernel.org>; Thu, 30 Nov 2023 13:52:33 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1345732AbjK3NwY (ORCPT
        <rfc822;linux-kernel@archiver.kernel.org>);
        Thu, 30 Nov 2023 08:52:24 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:53516 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1345714AbjK3NwW (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Thu, 30 Nov 2023 08:52:22 -0500
Received: from mailout4.samsung.com (mailout4.samsung.com [203.254.224.34])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 22945C4
        for <linux-kernel@vger.kernel.org>; Thu, 30 Nov 2023 05:52:28 -0800 (PST)
Received: from epcas5p4.samsung.com (unknown [182.195.41.42])
        by mailout4.samsung.com (KnoxPortal) with ESMTP id 20231130135226epoutp048bd78eca74de5b89d6f338836836fd4d~cavH16Ia40047900479epoutp04b
        for <linux-kernel@vger.kernel.org>; Thu, 30 Nov 2023 13:52:26 +0000 (GMT)
DKIM-Filter: OpenDKIM Filter v2.11.0 mailout4.samsung.com 20231130135226epoutp048bd78eca74de5b89d6f338836836fd4d~cavH16Ia40047900479epoutp04b
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=samsung.com;
        s=mail20170921; t=1701352346;
        bh=Rb6ZYEMC2CZ1FlgIe8RrGVYfBR7ZO2OCDhKB4oyvqXw=;
        h=From:To:Cc:Subject:Date:In-Reply-To:References:From;
        b=t1yYNzadguXgU9y3JElAJc7xxwaPR1YPiniruWf+ewezNjVEm/Y1WiZuwKMYnyxCm
         wStMk1Yaf5TBibfLU5zTa0/7sLyZ3Wyx8ysT8B27RcAMCIcwEYy5UJxJX44akFpUth
         zB8dpBFg42tUEQ2G37eKaQgQX2wAu2+vy9dWCmNM=
Received: from epsnrtp4.localdomain (unknown [182.195.42.165]) by
        epcas5p3.samsung.com (KnoxPortal) with ESMTP id
        20231130135225epcas5p30d8e4dbae3799ca0fdf09b1341c6234d~cavHLq4Jr2082920829epcas5p3N;
        Thu, 30 Nov 2023 13:52:25 +0000 (GMT)
Received: from epsmges5p2new.samsung.com (unknown [182.195.38.179]) by
        epsnrtp4.localdomain (Postfix) with ESMTP id 4SgyLJ1fzNz4x9Pq; Thu, 30 Nov
        2023 13:52:24 +0000 (GMT)
Received: from epcas5p3.samsung.com ( [182.195.41.41]) by
        epsmges5p2new.samsung.com (Symantec Messaging Gateway) with SMTP id
        26.07.10009.89398656; Thu, 30 Nov 2023 22:52:24 +0900 (KST)
Received: from epsmtrp1.samsung.com (unknown [182.195.40.13]) by
        epcas5p4.samsung.com (KnoxPortal) with ESMTPA id
        20231130115113epcas5p4bcd4ffb2baac60a0be51d6a3cb15c2a6~cZFSHGlY42306823068epcas5p4M;
        Thu, 30 Nov 2023 11:51:13 +0000 (GMT)
Received: from epsmgmcp1.samsung.com (unknown [182.195.42.82]) by
        epsmtrp1.samsung.com (KnoxPortal) with ESMTP id
        20231130115113epsmtrp15dc97bfd502f53d71aad80eac517fdab~cZFSGAqKE1720317203epsmtrp1-;
        Thu, 30 Nov 2023 11:51:13 +0000 (GMT)
X-AuditID: b6c32a4a-ff1ff70000002719-87-656893989b87
Received: from epsmtip1.samsung.com ( [182.195.34.30]) by
        epsmgmcp1.samsung.com (Symantec Messaging Gateway) with SMTP id
        02.A1.18939.13778656; Thu, 30 Nov 2023 20:51:13 +0900 (KST)
Received: from cheetah.sa.corp.samsungelectronics.net (unknown
        [107.109.115.53]) by epsmtip1.samsung.com (KnoxPortal) with ESMTPA id
        20231130115111epsmtip1e774433553d715866892e41b465dc782~cZFQJB3Yi1251512515epsmtip1Y;
        Thu, 30 Nov 2023 11:51:11 +0000 (GMT)
From: Shradha Todi <shradha.t@samsung.com>
To: manivannan.sadhasivam@linaro.org, lpieralisi@kernel.org,
        kw@linux.com, robh@kernel.org, bhelgaas@google.com,
        jingoohan1@gmail.com, gustavo.pimentel@synopsys.com,
        josh@joshtriplett.org, lukas.bulwahn@gmail.com,
        hongxing.zhu@nxp.com, pankaj.dubey@samsung.com
Cc: linux-kernel@vger.kernel.org, linux-pci@vger.kernel.org,
        Shradha Todi <shradha.t@samsung.com>
Subject: [PATCH v2 3/3] PCI: dwc: Create debugfs files in DWC driver
Date: Thu, 30 Nov 2023 17:20:44 +0530
Message-Id: <20231130115044.53512-4-shradha.t@samsung.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20231130115044.53512-1-shradha.t@samsung.com>
X-Brightmail-Tracker: H4sIAAAAAAAAA+NgFprGJsWRmVeSWpSXmKPExsWy7bCmpu6MyRmpBk/2slssacqw2HW3g91i
        1ra5jBYrvsxkt/i/IN+ioec3q8XlXXPYLM7OO85m0fKnhcWi5Wg7i8Xdlk5Wi0VbvwCV7dnB
        btF7uNaBz2PnrLvsHgs2lXrcem3rsWlVJ5vHnWt72DyeXJnO5LHx3Q4mj74tqxg9tuz/zOjx
        eZNcAFdUtk1GamJKapFCal5yfkpmXrqtkndwvHO8qZmBoa6hpYW5kkJeYm6qrZKLT4CuW2YO
        0PVKCmWJOaVAoYDE4mIlfTubovzSklSFjPziElul1IKUnAKTAr3ixNzi0rx0vbzUEitDAwMj
        U6DChOyMP+u72AomsVccut3I3MDYydbFyMEhIWAicb3ZtYuRi0NIYDejxLm+LjYI5xOjxOnF
        m5jgnMbJ94EcTrCON9snsIHYQgI7GSU2rS+HKGplkrgw8RQLSIJNQEui8WsXM0hCRKCLSeLR
        ipPsIAlmgWSJef13mEB2Cwu4SKy9awwSZhFQlejcdAZsAa+AlcSexT/ZIJbJS6zecIAZxOYU
        sJZ4tuoKI8hMCYFeDonzu56wQxS5SPRufcsCYQtLvDq+BSouJfGyvw3KTpdYuXkGM4SdI/Ft
        8xKob+wlDlyZwwJyD7OApsT6XfoQYVmJqafWMUGczCfR+/sJVDmvxI55MLayxJe/e6DWSkrM
        O3aZFcL2kHiy/j005PoYJRbs3M04gVFuFsKKBYyMqxglUwuKc9NTi00LjPJSy+GRlpyfu4kR
        nEC1vHYwPnzwQe8QIxMH4yFGCQ5mJRHe60/TU4V4UxIrq1KL8uOLSnNSiw8xmgIDcCKzlGhy
        PjCF55XEG5pYGpiYmZmZWBqbGSqJ875unZsiJJCeWJKanZpakFoE08fEwSnVwFQXOMkg27v5
        yepL3QfjLm5Kq1A+dvPBv6x7M1TOcRvn37nieed31va750s75a8znbvxaIfmPZ9bp3nYm2z0
        u1inWP1N8tR8/6VEP1GwcumuiyJPHRp2cTROX/xOd9bM6089QtV3dVy6+anzjmjFD9ulKi+N
        9bIPhvpUXWhU6zaaqHGo0kfvguU7F/0FSQITWqZyXbnsdPhQ4rOPJnv1LNc6aRbHNO6o3yX+
        dXHqGu7c+k7vJpftXOfYog9c86svt15r/FNmvl2ywcvXE0NyH23cuMU7SfnKkycJ51wXSHyu
        SBH/lPO8/rdRxdfp29+ktlY9K157SC35eL+J9uMTMy4lH7q1TGGzyT92yUImlSQlluKMREMt
        5qLiRADiCo8TKQQAAA==
X-Brightmail-Tracker: H4sIAAAAAAAAA+NgFjrBLMWRmVeSWpSXmKPExsWy7bCSnK5heUaqwdoOMYslTRkWu+52sFvM
        2jaX0WLFl5nsFv8X5Fs09Pxmtbi8aw6bxdl5x9ksWv60sFi0HG1nsbjb0slqsWjrF6CyPTvY
        LXoP1zrweeycdZfdY8GmUo9br209Nq3qZPO4c20Pm8eTK9OZPDa+28Hk0bdlFaPHlv2fGT0+
        b5IL4IrisklJzcksSy3St0vgyvizvoutYBJ7xaHbjcwNjJ1sXYycHBICJhJvtk8As4UEtjNK
        LN8uBhGXlPh8cR0ThC0ssfLfc3aImmYmiXcvPEFsNgEticavXcxdjFwcIgIzmCRauu+zgCSY
        BVIlbh+eAzSUg0NYwEVi7V1jkDCLgKpE56YzYDN5Bawk9iz+CXWDvMTqDQeYQWxOAWuJZ6uu
        MELsspJY9OsH8wRGvgWMDKsYRVMLinPTc5MLDPWKE3OLS/PS9ZLzczcxggNbK2gH47L1f/UO
        MTJxMB5ilOBgVhLhvf40PVWINyWxsiq1KD++qDQntfgQozQHi5I4r3JOZ4qQQHpiSWp2ampB
        ahFMlomDU6qBqV12n9he159ys6eyTuRr5Eyp3hd6TVqkX9D7s81Wdq5LR6afmsefEHdkNbP4
        /+jc6ef+/vxXYefzIn97cLvWtLsaJ/pmPEs8J5t7WDF6UtOxCcxJtvLXp+tLvHFg1bKVdn63
        3f7UrGtpjjeq3iavqO43u1PzeQIvb7AJ20z7h9GvDir/33rkt2f3//OfH+3kWaJ8UF1d4u9s
        Xf38bdJi9rO3HE+9qLmff313/SeW8xkXNLovMn3JOmCnnllu9Zdx/a7DmyyX3EjRb/mXknmy
        /LSCvdqy1EnTPon8ujvzwPNd+UFBp+dfTxKf59ca6plclrE6ymC3C094mfLmmmlOde4FLUVc
        6Xcy1Vctfm5uocRSnJFoqMVcVJwIABe/IhXbAgAA
X-CMS-MailID: 20231130115113epcas5p4bcd4ffb2baac60a0be51d6a3cb15c2a6
X-Msg-Generator: CA
Content-Type: text/plain; charset="utf-8"
X-Sendblock-Type: REQ_APPROVE
CMS-TYPE: 105P
DLP-Filter: Pass
X-CFilter-Loop: Reflected
X-CMS-RootMailID: 20231130115113epcas5p4bcd4ffb2baac60a0be51d6a3cb15c2a6
References: <20231130115044.53512-1-shradha.t@samsung.com>
        <CGME20231130115113epcas5p4bcd4ffb2baac60a0be51d6a3cb15c2a6@epcas5p4.samsung.com>
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

Add call to initialize debugfs from DWC driver and create the RASDES
debugfs hierarchy for each platform driver. Since it can be used for
both DW HOST controller as well as DW EP controller, add it in the
common setup function.

Signed-off-by: Shradha Todi <shradha.t@samsung.com>
---
 drivers/pci/controller/dwc/pcie-designware.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/drivers/pci/controller/dwc/pcie-designware.c b/drivers/pci/controller/dwc/pcie-designware.c
index 064b4951afd8..16c9018c2ada 100644
--- a/drivers/pci/controller/dwc/pcie-designware.c
+++ b/drivers/pci/controller/dwc/pcie-designware.c
@@ -1074,4 +1074,8 @@ void dw_pcie_setup(struct dw_pcie *pci)
 		break;
 	}
 	dw_pcie_writel_dbi(pci, PCIE_LINK_WIDTH_SPEED_CONTROL, val);
+
+	val = dwc_pcie_rasdes_debugfs_init(pci);
+	if (val)
+		dev_err(pci->dev, "Couldn't create debugfs files\n");
 }
-- 
2.17.1


From mboxrd@z Thu Jan  1 00:00:00 1970
Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
	aws-us-west-2-korg-lkml-1.web.codeaurora.org
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by smtp.lore.kernel.org (Postfix) with ESMTP id 78149C07CA9
	for <linux-kernel@archiver.kernel.org>; Thu, 30 Nov 2023 16:55:29 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1345856AbjK3QzV (ORCPT
        <rfc822;linux-kernel@archiver.kernel.org>);
        Thu, 30 Nov 2023 11:55:21 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:47336 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1345840AbjK3QzS (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Thu, 30 Nov 2023 11:55:18 -0500
Received: from mail-oi1-x230.google.com (mail-oi1-x230.google.com [IPv6:2607:f8b0:4864:20::230])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 4B49610DB
        for <linux-kernel@vger.kernel.org>; Thu, 30 Nov 2023 08:55:24 -0800 (PST)
Received: by mail-oi1-x230.google.com with SMTP id 5614622812f47-3b5714439b3so652337b6e.3
        for <linux-kernel@vger.kernel.org>; Thu, 30 Nov 2023 08:55:24 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=linaro.org; s=google; t=1701363323; x=1701968123; darn=vger.kernel.org;
        h=in-reply-to:content-transfer-encoding:content-disposition
         :mime-version:references:message-id:subject:cc:to:from:date:from:to
         :cc:subject:date:message-id:reply-to;
        bh=rmxSAO3fdyrKwaTqGd3YSx6BBvFQHSOmyrJHBt/Yn5A=;
        b=U85gaENisn4eFT7aw9gz+s14lGbhRLN6aXvcAZloi7KdDsfEskyaGEnTN+ahxna+Z6
         8xbqcJrIhGQNi2cpSmfPm9y9ywjE0hIsoG3gMUazzaYgsbKt1FG1RJOlplF//SUXCoQA
         UNqFja6IPPmvxMu9LOAX3ql1Ftks7Ugw8NfvJxvlz508kL750tdPZzHPzaw5BGI9pDV4
         AfbQ3bETbM+zDK399sAhU71C9eqBCFJYzgy+NogHa7vTbAYpY1JcAJ2WbVD8T7U1IZMu
         mrqL5ePuX2Xwq+lofT6H31Ip8QvVi3WX36MTjGKJtloaqsHSMP97w24aC+ZUDatHNaPM
         H40Q==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1701363323; x=1701968123;
        h=in-reply-to:content-transfer-encoding:content-disposition
         :mime-version:references:message-id:subject:cc:to:from:date
         :x-gm-message-state:from:to:cc:subject:date:message-id:reply-to;
        bh=rmxSAO3fdyrKwaTqGd3YSx6BBvFQHSOmyrJHBt/Yn5A=;
        b=dlt1VJHAbht2PUk8Uyxkog5vh+A79n1ap8EIO3UmzudN1ixDuxoSluE8P0SB/1h0a0
         UXwhqbDg+qSjhHlFIEy8ZrcDm1IFPqXMsrPOvgs489duU16RQkVce5RSDT3a1c+NXsp6
         vfR/ieHY6DjP6XfPxrLsj9hQt6lNC6STIMcaLk1h3EXHHYenoPvxtaqgA+vlcDOuYa3m
         B3xuGXu3c1ZLUi3UDTi50PF1aNsPsQ4RnzuZEpSHBn9iMUuWMgcZfb3ma9LjUSUnTga7
         47ekREbYxqRvT1ONBJ+ktFErHLzUKHXCmjxm7DSdhy2oVufiJHvfiL4ix3fAsOJ7U3Ds
         0hWg==
X-Gm-Message-State: AOJu0YwhiZIzHtpQBXSmisFACW7cHHXRj7zou3kJqQD6j2NbKmWLpxPZ
        68Z2Ov9Pi4xTGhiiaaF67t5n
X-Google-Smtp-Source: AGHT+IEz7XuDUqXYdI4J/jG28y1tc/o5oyAeuhg85Lkt1tkDT7TzfRm7sgOObpymwMghWxY+ERa48Q==
X-Received: by 2002:a54:4389:0:b0:3b8:9bf6:66e8 with SMTP id u9-20020a544389000000b003b89bf666e8mr114366oiv.21.1701363323569;
        Thu, 30 Nov 2023 08:55:23 -0800 (PST)
Received: from thinkpad ([117.213.102.92])
        by smtp.gmail.com with ESMTPSA id bq42-20020a05620a46aa00b0077d6443ae82sm643960qkb.83.2023.11.30.08.55.18
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Thu, 30 Nov 2023 08:55:23 -0800 (PST)
Date: Thu, 30 Nov 2023 22:25:14 +0530
From: Manivannan Sadhasivam <manivannan.sadhasivam@linaro.org>
To: Shradha Todi <shradha.t@samsung.com>
Cc: lpieralisi@kernel.org, kw@linux.com, robh@kernel.org,
        bhelgaas@google.com, jingoohan1@gmail.com,
        gustavo.pimentel@synopsys.com, josh@joshtriplett.org,
        lukas.bulwahn@gmail.com, hongxing.zhu@nxp.com,
        pankaj.dubey@samsung.com, linux-kernel@vger.kernel.org,
        linux-pci@vger.kernel.org
Subject: Re: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
 controller
Message-ID: <20231130165514.GW3043@thinkpad>
References: <CGME20231130115055epcas5p4e29befa80877be45dbee308846edc0ba@epcas5p4.samsung.com>
 <20231130115044.53512-1-shradha.t@samsung.com>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <20231130115044.53512-1-shradha.t@samsung.com>
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org

On Thu, Nov 30, 2023 at 05:20:41PM +0530, Shradha Todi wrote:
> DesignWare controller provides a vendor specific extended capability
> called RASDES as an IP feature. This extended capability  provides
> hardware information like:
>  - Debug registers to know the state of the link or controller. 
>  - Error injection mechanisms to inject various PCIe errors including
>    sequence number, CRC
>  - Statistical counters to know how many times a particular event
>    occurred
> 
> However, in Linux we do not have any generic or custom support to be
> able to use this feature in an efficient manner. This is the reason we
> are proposing this framework. Debug and bring up time of high-speed IPs
> are highly dependent on costlier hardware analyzers and this solution
> will in some ways help to reduce the HW analyzer usage.
> 
> The debugfs entries can be used to get information about underlying
> hardware and can be shared with user space. Separate debugfs entries has
> been created to cater to all the DES hooks provided by the controller.
> The debugfs entries interacts with the RASDES registers in the required
> sequence and provides the meaningful data to the user. This eases the
> effort to understand and use the register information for debugging.
> 
> v1 version was posted long back and for some reasons I couldn't work on
> it. I apologize for the long break. I'm restarting this activity and
> have taken care of all previous review comments shared.
> v1: https://lore.kernel.org/all/20210518174618.42089-1-shradha.t@samsung.com/T/
> 

There is already a series floating to add similar functionality via perf
subsystem: https://lore.kernel.org/linux-pci/20231121013400.18367-1-xueshuai@linux.alibaba.com/

- Mani

> Shradha Todi (3):
>   PCI: dwc: Add support for vendor specific capability search
>   PCI: debugfs: Add support for RASDES framework in DWC
>   PCI: dwc: Create debugfs files in DWC driver
> 
>  drivers/pci/controller/dwc/Kconfig            |   8 +
>  drivers/pci/controller/dwc/Makefile           |   1 +
>  .../controller/dwc/pcie-designware-debugfs.c  | 476 ++++++++++++++++++
>  .../controller/dwc/pcie-designware-debugfs.h  |   0
>  drivers/pci/controller/dwc/pcie-designware.c  |  20 +
>  drivers/pci/controller/dwc/pcie-designware.h  |  18 +
>  6 files changed, 523 insertions(+)
>  create mode 100644 drivers/pci/controller/dwc/pcie-designware-debugfs.c
>  create mode 100644 drivers/pci/controller/dwc/pcie-designware-debugfs.h
> 
> -- 
> 2.17.1
> 

-- 
மணிவண்ணன் சதாசிவம்

From mboxrd@z Thu Jan  1 00:00:00 1970
Return-Path: <linux-kernel-owner@vger.kernel.org>
X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on
	aws-us-west-2-korg-lkml-1.web.codeaurora.org
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by smtp.lore.kernel.org (Postfix) with ESMTP id AE4D3C4167B
	for <linux-kernel@archiver.kernel.org>; Mon,  4 Dec 2023 09:07:50 +0000 (UTC)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S232615AbjLDJHm (ORCPT <rfc822;linux-kernel@archiver.kernel.org>);
        Mon, 4 Dec 2023 04:07:42 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:36538 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S229446AbjLDJHk (ORCPT
        <rfc822;linux-kernel@vger.kernel.org>);
        Mon, 4 Dec 2023 04:07:40 -0500
Received: from mailout1.samsung.com (mailout1.samsung.com [203.254.224.24])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 11A20A8
        for <linux-kernel@vger.kernel.org>; Mon,  4 Dec 2023 01:07:46 -0800 (PST)
Received: from epcas5p4.samsung.com (unknown [182.195.41.42])
        by mailout1.samsung.com (KnoxPortal) with ESMTP id 20231204090743epoutp01c842fea575eba5cfed312d5d8e406f3a~dlbqmhhxj1449914499epoutp01R
        for <linux-kernel@vger.kernel.org>; Mon,  4 Dec 2023 09:07:43 +0000 (GMT)
DKIM-Filter: OpenDKIM Filter v2.11.0 mailout1.samsung.com 20231204090743epoutp01c842fea575eba5cfed312d5d8e406f3a~dlbqmhhxj1449914499epoutp01R
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=samsung.com;
        s=mail20170921; t=1701680863;
        bh=vcYt1R54N2+/4tQmNYRaPFiz1z4tnQB4WN87TIBJZak=;
        h=From:To:Cc:In-Reply-To:Subject:Date:References:From;
        b=Vr93YOHiz277qB3ikTnJbJc3wtLkOmx2TEz0ScHWiO5SYlshvKMAOf5xScSXHd/el
         AMmo+vWXaoKxhsf2EMq0Kt4H3kcuWPsSIVMJsXP9SoJsEos5oktrIFeHjTYUJRNP9c
         +qH7IEIaIfXplNzr84VQNGRvh4JWj9soKJfwdpV0=
Received: from epsnrtp2.localdomain (unknown [182.195.42.163]) by
        epcas5p1.samsung.com (KnoxPortal) with ESMTP id
        20231204090742epcas5p14f3287fba4f6e6f13bcfdd50f19bfbd9~dlbqF6_cA0703007030epcas5p11;
        Mon,  4 Dec 2023 09:07:42 +0000 (GMT)
Received: from epsmges5p3new.samsung.com (unknown [182.195.38.183]) by
        epsnrtp2.localdomain (Postfix) with ESMTP id 4SkHqw69zkz4x9Q0; Mon,  4 Dec
        2023 09:07:40 +0000 (GMT)
Received: from epcas5p3.samsung.com ( [182.195.41.41]) by
        epsmges5p3new.samsung.com (Symantec Messaging Gateway) with SMTP id
        69.90.09672.CD69D656; Mon,  4 Dec 2023 18:07:40 +0900 (KST)
Received: from epsmtrp1.samsung.com (unknown [182.195.40.13]) by
        epcas5p2.samsung.com (KnoxPortal) with ESMTPA id
        20231204084016epcas5p24e21f003c76b82ad8907fa182f150eb7~dlDs7ZB0O1129011290epcas5p2c;
        Mon,  4 Dec 2023 08:40:16 +0000 (GMT)
Received: from epsmgms1p2new.samsung.com (unknown [182.195.42.42]) by
        epsmtrp1.samsung.com (KnoxPortal) with ESMTP id
        20231204084016epsmtrp17451a4f40ea7029593c957e077bc8adb~dlDs6DULo1653516535epsmtrp1-;
        Mon,  4 Dec 2023 08:40:16 +0000 (GMT)
X-AuditID: b6c32a4b-60bfd700000025c8-26-656d96dcb64d
Received: from epsmtip1.samsung.com ( [182.195.34.30]) by
        epsmgms1p2new.samsung.com (Symantec Messaging Gateway) with SMTP id
        A8.66.08817.0709D656; Mon,  4 Dec 2023 17:40:16 +0900 (KST)
Received: from FDSFTE462 (unknown [107.122.81.248]) by epsmtip1.samsung.com
        (KnoxPortal) with ESMTPA id
        20231204084014epsmtip10473e532106c4e53cbf96f371a2e5391~dlDrF8zG52464424644epsmtip1T;
        Mon,  4 Dec 2023 08:40:14 +0000 (GMT)
From: "Shradha Todi" <shradha.t@samsung.com>
To: "'Manivannan Sadhasivam'" <manivannan.sadhasivam@linaro.org>
Cc: <lpieralisi@kernel.org>, <kw@linux.com>, <robh@kernel.org>,
        <bhelgaas@google.com>, <jingoohan1@gmail.com>,
        <gustavo.pimentel@synopsys.com>, <josh@joshtriplett.org>,
        <lukas.bulwahn@gmail.com>, <hongxing.zhu@nxp.com>,
        <pankaj.dubey@samsung.com>, <linux-kernel@vger.kernel.org>,
        <linux-pci@vger.kernel.org>
In-Reply-To: <20231130165514.GW3043@thinkpad>
Subject: RE: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
 controller
Date: Mon, 4 Dec 2023 14:10:06 +0530
Message-ID: <000001da268d$81210500$83630f00$@samsung.com>
MIME-Version: 1.0
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Outlook 16.0
Thread-Index: AQG/Q0WxGB9EWFeblm7N70OL8blxhQGR1/IBAmU4G1qwrtlAgA==
Content-Language: en-in
X-Brightmail-Tracker: H4sIAAAAAAAAA+NgFjrLJsWRmVeSWpSXmKPExsWy7bCmpu6dabmpBnuWaFssacqw2HW3g91i
        1ra5jBYrvsxkt/i/IN+ioec3q8XlXXPYLM7OO85m0fKnhcWi5Wg7i8Xdlk5Wi0VbvwCV7dnB
        7sDrsXPWXXaPBZtKPW69tvXYtKqTzePOtT1sHk+uTGfy2PhuB5NH35ZVjB5b9n9m9Pi8SS6A
        KyrbJiM1MSW1SCE1Lzk/JTMv3VbJOzjeOd7UzMBQ19DSwlxJIS8xN9VWycUnQNctMwfociWF
        ssScUqBQQGJxsZK+nU1RfmlJqkJGfnGJrVJqQUpOgUmBXnFibnFpXrpeXmqJlaGBgZEpUGFC
        dsaeZdvZCq4qVvzp4Ghg3C3dxcjJISFgInGk6z8jiC0ksJtRonkjcxcjF5D9iVGita2bFcL5
        xijx98I9NpiOa9MbmSASexkl7jW/YYNwXjBKLN28hwmkik1AR+LJlT/MILaIgINE+9tPLCBF
        zAJ7mSS2vtrNCpLgFNCVWDjzK1iDsECwxPSpXSwgNouAisTMeWeApnJw8ApYSkw7WQAS5hUQ
        lDg58wlYCbOAtsSyha+ZIS5SkPj5dBkrxC4nidYf15ghasQljv7sAftHQuABh8TljdvZIRpc
        JBqOnYZ6R1ji1fEtUHEpiZf9bVB2usTKzTOgFuRIfNu8hAnCtpc4cGUOC8htzAKaEut36UOE
        ZSWmnlrHBLGXT6L39xOocl6JHfNgbGWJL3/3sEDYkhLzjl1mncCoNAvJa7OQvDYLyQuzELYt
        YGRZxSiZWlCcm55abFpgnJdaDo/v5PzcTYzgdK3lvYPx0YMPeocYmTgYDzFKcDArifDOu5Wd
        KsSbklhZlVqUH19UmpNafIjRFBjcE5mlRJPzgRkjryTe0MTSwMTMzMzE0tjMUEmc93Xr3BQh
        gfTEktTs1NSC1CKYPiYOTqkGpp6kDBelI7tst0m47nrruzfn9VWRp06vcreml2Tffv/jg1uy
        f+P5w182hrv9ePdd2LGXQzsosvBvltpzt+S9EYL8Se3ntW6t2fe//ehz77fWk4xu3pQ7u2l5
        1mexdWFp57h8pA//nXl7/YSOEgcLw8frE1U3qzCuVuP55J/e8nj9wtLCiEcbK/yFXPb091Ud
        rpyg+IOhxdUlRFZn1X7FmAaDf8snfmHdlKG8zItb5ih7hdapK90e8Yf/shsvnvHS7cZ7zgOL
        uH+2PbDcrh3+uWVy2ZJfhX69Cuv339y18vIXr8vs/TbvHXRXzLy/+tN1o/++BvwtskZC8aY5
        vl/qdT7a5ex4HJ52W2Zn+dSpKkosxRmJhlrMRcWJAHzFY+pgBAAA
X-Brightmail-Tracker: H4sIAAAAAAAAA+NgFtrOIsWRmVeSWpSXmKPExsWy7bCSnG7BhNxUg/NT+CyWNGVY7LrbwW4x
        a9tcRosVX2ayW/xfkG/R0POb1eLyrjlsFmfnHWezaPnTwmLRcrSdxeJuSyerxaKtX4DK9uxg
        d+D12DnrLrvHgk2lHrde23psWtXJ5nHn2h42jydXpjN5bHy3g8mjb8sqRo8t+z8zenzeJBfA
        FcVlk5Kak1mWWqRvl8CVcbj1K2PBPMWKF7t+sTYw/pbqYuTkkBAwkbg2vZGpi5GLQ0hgN6PE
        2wVHmCESkhKfL65jgrCFJVb+e84OUfSMUWJX1wFGkASbgI7Ekyt/wBpEBBwk2t9+YgEpYhY4
        ySSx7cZhZoiOtYwSvXemglVxCuhKLJz5FWyssECgxNaNb8FsFgEViZnzzrB1MXJw8ApYSkw7
        WQAS5hUQlDg58wkLiM0soC3x9OZTOHvZwtdQlypI/Hy6jBXiCCeJ1h/XmCFqxCWO/uxhnsAo
        PAvJqFlIRs1CMmoWkpYFjCyrGCVTC4pz03OLDQuM8lLL9YoTc4tL89L1kvNzNzGC41ZLawfj
        nlUf9A4xMnEwHmKU4GBWEuGddys7VYg3JbGyKrUoP76oNCe1+BCjNAeLkjjvt9e9KUIC6Ykl
        qdmpqQWpRTBZJg5OqQYmbUn5m61Tzq+ZdZ1ns/JkVe874odLrSZX9pZr1Zjsalxc4fn62laR
        gL93DioWKHSl/Sxs9Sq+v1xMTCw02WeakbNfw9vgGVMc3tf0rryWlWU+Jev5kXsXXjk/OlLx
        yGPVa3GuKRr7pXV6jnkUTPzFfN/zbzzzlU2bb2xgjSn70r4w+bSBzu0b9/32Vh54/0St4kT0
        notNMTcuRPlYrJff/H2+v7p4ZzPH8j08J/5z8RdL/dcV5eLjXRsWdG1e7/Edz7+07NW4IHZs
        pp+Y35z6FNHfS/865b70OmXPtvvEt8g1yqZq7ccMY5PmXEyYvkiJOaj+57VngqIyb46buykG
        NZf9Y9H49+pHup3WerXnSizFGYmGWsxFxYkAlsqWlUoDAAA=
X-CMS-MailID: 20231204084016epcas5p24e21f003c76b82ad8907fa182f150eb7
X-Msg-Generator: CA
Content-Type: text/plain; charset="utf-8"
X-Sendblock-Type: REQ_APPROVE
CMS-TYPE: 105P
DLP-Filter: Pass
X-CFilter-Loop: Reflected
X-CMS-RootMailID: 20231130115055epcas5p4e29befa80877be45dbee308846edc0ba
References: <CGME20231130115055epcas5p4e29befa80877be45dbee308846edc0ba@epcas5p4.samsung.com>
        <20231130115044.53512-1-shradha.t@samsung.com>
        <20231130165514.GW3043@thinkpad>
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org



> -----Original Message-----
> From: Manivannan Sadhasivam =5Bmailto:manivannan.sadhasivam=40linaro.org=
=5D
> Sent: 30 November 2023 22:25
> To: Shradha Todi <shradha.t=40samsung.com>
> Cc: lpieralisi=40kernel.org; kw=40linux.com; robh=40kernel.org;
> bhelgaas=40google.com; jingoohan1=40gmail.com;
> gustavo.pimentel=40synopsys.com; josh=40joshtriplett.org;
> lukas.bulwahn=40gmail.com; hongxing.zhu=40nxp.com;
> pankaj.dubey=40samsung.com; linux-kernel=40vger.kernel.org; linux-
> pci=40vger.kernel.org
> Subject: Re: =5BPATCH v2 0/3=5D Add support for RAS DES feature in PCIe D=
W
> controller
>=20
> On Thu, Nov 30, 2023 at 05:20:41PM +0530, Shradha Todi wrote:
> > DesignWare controller provides a vendor specific extended capability
> > called RASDES as an IP feature. This extended capability  provides
> > hardware information like:
> >  - Debug registers to know the state of the link or controller.
> >  - Error injection mechanisms to inject various PCIe errors including
> >    sequence number, CRC
> >  - Statistical counters to know how many times a particular event
> >    occurred
> >
> > However, in Linux we do not have any generic or custom support to be
> > able to use this feature in an efficient manner. This is the reason we
> > are proposing this framework. Debug and bring up time of high-speed
> > IPs are highly dependent on costlier hardware analyzers and this
> > solution will in some ways help to reduce the HW analyzer usage.
> >
> > The debugfs entries can be used to get information about underlying
> > hardware and can be shared with user space. Separate debugfs entries
> > has been created to cater to all the DES hooks provided by the controll=
er.
> > The debugfs entries interacts with the RASDES registers in the
> > required sequence and provides the meaningful data to the user. This
> > eases the effort to understand and use the register information for
> debugging.
> >
> > v1 version was posted long back and for some reasons I couldn't work
> > on it. I apologize for the long break. I'm restarting this activity
> > and have taken care of all previous review comments shared.
> > v1:
> > https://lore.kernel.org/all/20210518174618.42089-1-shradha.t=40samsung.=
c
> > om/T/
> >
>=20
> There is already a series floating to add similar functionality via perf
> subsystem: https://lore.kernel.org/linux-pci/20231121013400.18367-1-
> xueshuai=40linux.alibaba.com/
>=20
> - Mani
>=20

Hi Mani,

The series proposed in perf includes only time based-analysis and event cou=
nters which will monitor performance (Group 6 and 7). The patch or framewor=
k that we have proposed includes debug information, error injection facilit=
y and error counters (Group 0 - 5) which are not included as part of the fu=
nctionality implemented via perf. In my opinion, these functionalities don'=
t count as performance monitoring or counters but rather as debug counters.=
 How about we take this up as a debugfs framework as proposed in my patch?=
=20
Or if others feel it can be taken via perf driver then I am happy to extend=
 the perf driver if authors do not have objection. Let me know what you thi=
nk of this? Meanwhile I will review the perf patches and share my feedback.

> > Shradha Todi (3):
> >   PCI: dwc: Add support for vendor specific capability search
> >   PCI: debugfs: Add support for RASDES framework in DWC
> >   PCI: dwc: Create debugfs files in DWC driver
> >
> >  drivers/pci/controller/dwc/Kconfig            =7C   8 +
> >  drivers/pci/controller/dwc/Makefile           =7C   1 +
> >  .../controller/dwc/pcie-designware-debugfs.c  =7C 476
> ++++++++++++++++++
> >  .../controller/dwc/pcie-designware-debugfs.h  =7C   0
> >  drivers/pci/controller/dwc/pcie-designware.c  =7C  20 +
> > drivers/pci/controller/dwc/pcie-designware.h  =7C  18 +
> >  6 files changed, 523 insertions(+)
> >  create mode 100644
> > drivers/pci/controller/dwc/pcie-designware-debugfs.c
> >  create mode 100644
> > drivers/pci/controller/dwc/pcie-designware-debugfs.h
> >
> > --
> > 2.17.1
> >
>=20
> --
> =E0=AE=AE=E0=AE=A3=E0=AE=BF=E0=AE=B5=E0=AE=A3=E0=AF=8D=E0=AE=A3=E0=AE=A9=
=E0=AF=8D=20=E0=AE=9A=E0=AE=A4=E0=AE=BE=E0=AE=9A=E0=AE=BF=E0=AE=B5=E0=AE=AE=
=E0=AF=8D=0D=0A=0D=0A

From mboxrd@z Thu Jan  1 00:00:00 1970
Received: from mailout3.samsung.com (mailout3.samsung.com [203.254.224.33])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 060A44C8E
	for <linux-kernel@vger.kernel.org>; Thu,  4 Jan 2024 02:55:25 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=samsung.com
Authentication-Results: smtp.subspace.kernel.org; spf=pass smtp.mailfrom=samsung.com
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (1024-bit key) header.d=samsung.com header.i=@samsung.com header.b="Gy+qwlJ/"
Received: from epcas5p2.samsung.com (unknown [182.195.41.40])
	by mailout3.samsung.com (KnoxPortal) with ESMTP id 20240104025523epoutp03dfadf259fea22b003c0b0c3ed486827b~nBWb2X3Sp2987729877epoutp03Y
	for <linux-kernel@vger.kernel.org>; Thu,  4 Jan 2024 02:55:23 +0000 (GMT)
DKIM-Filter: OpenDKIM Filter v2.11.0 mailout3.samsung.com 20240104025523epoutp03dfadf259fea22b003c0b0c3ed486827b~nBWb2X3Sp2987729877epoutp03Y
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=samsung.com;
	s=mail20170921; t=1704336923;
	bh=OiF6tUgd+ueRws57hnQ7jHdR9ExFm1BoqeA7YyNenFM=;
	h=From:To:Cc:In-Reply-To:Subject:Date:References:From;
	b=Gy+qwlJ/MGOJblbEV652VnWfOoXXZ8eAIE3yalowInA1+bfGifISG8p7c0CpnSIHh
	 bZTRuxswVgwoWrMkVEnNyrP9JmSgGSUWfrLyje9DNAiFLpcFVNNwhEqDZ25JFkbkFj
	 Ywv21jYCIJZrvHg0hNk0UwNA6wIjFurikp6eL/J4=
Received: from epsnrtp4.localdomain (unknown [182.195.42.165]) by
	epcas5p2.samsung.com (KnoxPortal) with ESMTP id
	20240104025522epcas5p24b9230be2421bb0d20030464e92d4560~nBWa45Cfa1864018640epcas5p2u;
	Thu,  4 Jan 2024 02:55:22 +0000 (GMT)
Received: from epsmges5p2new.samsung.com (unknown [182.195.38.176]) by
	epsnrtp4.localdomain (Postfix) with ESMTP id 4T5B604NNFz4x9Q2; Thu,  4 Jan
	2024 02:55:20 +0000 (GMT)
Received: from epcas5p2.samsung.com ( [182.195.41.40]) by
	epsmges5p2new.samsung.com (Symantec Messaging Gateway) with SMTP id
	4A.F3.10009.81E16956; Thu,  4 Jan 2024 11:55:20 +0900 (KST)
Received: from epsmtrp2.samsung.com (unknown [182.195.40.14]) by
	epcas5p1.samsung.com (KnoxPortal) with ESMTPA id
	20240103054323epcas5p1c66603ad92fc4af4efda6a4999fbec2e~mv-0ullNs1533915339epcas5p1O;
	Wed,  3 Jan 2024 05:43:23 +0000 (GMT)
Received: from epsmgms1p1new.samsung.com (unknown [182.195.42.41]) by
	epsmtrp2.samsung.com (KnoxPortal) with ESMTP id
	20240103054323epsmtrp23ed95c1b41e03c2abe461efbe81c2d57~mv-0ttVE40670206702epsmtrp2A;
	Wed,  3 Jan 2024 05:43:23 +0000 (GMT)
X-AuditID: b6c32a4a-ff1ff70000002719-2a-65961e18e9d2
Received: from epsmtip2.samsung.com ( [182.195.34.31]) by
	epsmgms1p1new.samsung.com (Symantec Messaging Gateway) with SMTP id
	40.CA.08755.AF3F4956; Wed,  3 Jan 2024 14:43:22 +0900 (KST)
Received: from FDSFTE462 (unknown [107.122.81.248]) by epsmtip2.samsung.com
	(KnoxPortal) with ESMTPA id
	20240103054321epsmtip2b82d46e8f2e04dbc7774751e17704108~mv-y3kFen0960509605epsmtip25;
	Wed,  3 Jan 2024 05:43:21 +0000 (GMT)
From: "Shradha Todi" <shradha.t@samsung.com>
To: "'Manivannan Sadhasivam'" <manivannan.sadhasivam@linaro.org>
Cc: <lpieralisi@kernel.org>, <kw@linux.com>, <robh@kernel.org>,
	<bhelgaas@google.com>, <jingoohan1@gmail.com>,
	<gustavo.pimentel@synopsys.com>, <josh@joshtriplett.org>,
	<lukas.bulwahn@gmail.com>, <hongxing.zhu@nxp.com>,
	<pankaj.dubey@samsung.com>, <linux-kernel@vger.kernel.org>,
	<linux-pci@vger.kernel.org>
In-Reply-To: 
Subject: RE: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
 controller
Date: Wed, 3 Jan 2024 11:13:20 +0530
Message-ID: <000601da3e07$c39e5e00$4adb1a00$@samsung.com>
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Outlook 16.0
Thread-Index: AQG/Q0WxGB9EWFeblm7N70OL8blxhQGR1/IBAmU4G1qwrtlAgIAu9wGg
Content-Language: en-in
X-Brightmail-Tracker: H4sIAAAAAAAAA+NgFjrPJsWRmVeSWpSXmKPExsWy7bCmhq6E3LRUg83TFC2WNGVY7LrbwW4x
	a9tcRosVX2ayW/xfkG/R0POb1eLyrjlsFmfnHWezaPnTwmLRcrSdxeJuSyerxaKtX4DK9uxg
	d+D12DnrLrvHgk2lHrde23psWtXJ5nHn2h42jydXpjN5bHy3g8mjb8sqRo8t+z8zenzeJBfA
	FZVtk5GamJJapJCal5yfkpmXbqvkHRzvHG9qZmCoa2hpYa6kkJeYm2qr5OIToOuWmQN0uZJC
	WWJOKVAoILG4WEnfzqYov7QkVSEjv7jEVim1ICWnwKRArzgxt7g0L10vL7XEytDAwMgUqDAh
	O6Px03TWgk79io7/v9gbGHepdTFyckgImEgs397H2MXIxSEksJtRYsf6B6wQzidGiRUHzkM5
	3xgljh3qZYFpWX95HwtEYi+jxKWzn5khnBeMEq8ermYCqWIT0JF4cuUPM4gtIuAg0f72E1gH
	s8BeJomtr3YDzeXg4BTglZjwzxqkRlggWGL61C6wDSwCKhInV71hBbF5BSwlvm9ayA5hC0qc
	nPkErIZZQFti2cLXzBAXKUj8fLqMFWKXm8SljcuZIWrEJY7+7AE7TkLgDofE0n8XWCEaXCSa
	5h2AekdY4tXxLewQtpTE53d72SDsdImVm2dALciR+LZ5CROEbS9x4MocFpD7mQU0Jdbv0ocI
	y0pMPbWOCWIvn0Tv7ydQ5bwSO+bB2MoSX/7ugVorKTHv2GXWCYxKs5C8NgvJa7OQvDALYdsC
	RpZVjJKpBcW56anFpgVGeanl8BhPzs/dxAhO2VpeOxgfPvigd4iRiYPxEKMEB7OSCO/6dZNT
	hXhTEiurUovy44tKc1KLDzGaAsN7IrOUaHI+MGvklcQbmlgamJiZmZlYGpsZKonzvm6dmyIk
	kJ5YkpqdmlqQWgTTx8TBKdXAlH/s0T6fgNBUzTa3LrEOxfIWJ9eff26f3CQl8ma+teLJfyH/
	lEr+Lbs7Teb47fVlTdN2bwu0PcfF8ut8UtmKcJ59mz5q5zI9clobLxFs9ZtfNGeJuYHXP7uV
	WX65E73COJ9vM9n9x2at+PTQPS+n/l3mdNDrwYz/VhsCVqfPU7lkqcFwfy07a0VJyHLPHSu0
	7zR9iL2dzpffUnG0ytBXeY7vFx6zqAlveO9Ozyty/OTVG1i6ad00qSN73pz9wLV7bWFQwJWO
	sN8nXRK3/flrE+tfsGn2jc3Pb7i/nu75b3VFw4yzjmtLtJv3O5qmGbhxmF6WEshSehi689vx
	Wavl505+d3zqU0/+xAPJTktFwpVYijMSDbWYi4oTAYu51pViBAAA
X-Brightmail-Tracker: H4sIAAAAAAAAA+NgFtrCIsWRmVeSWpSXmKPExsWy7bCSvO7vz1NSDSZKWSxpyrDYdbeD3WLW
	trmMFiu+zGS3+L8g36Kh5zerxeVdc9gszs47zmbR8qeFxaLlaDuLxd2WTlaLRVu/AJXt2cHu
	wOuxc9Zddo8Fm0o9br229di0qpPN4861PWweT65MZ/LY+G4Hk0ffllWMHlv2f2b0+LxJLoAr
	issmJTUnsyy1SN8ugSvj5TaLgq16FSfnvGNqYDyt2sXIySEhYCKx/vI+li5GLg4hgd2MEk+/
	3WSBSEhKfL64jgnCFpZY+e85O0TRM0aJef2/wIrYBHQknlz5wwxiiwg4SLS//QQ2iVngJJPE
	thuHwRJCAusYJVq3RHYxcnBwCvBKTPhnDRIWFgiU2LrxLdgCFgEViZOr3rCC2LwClhLfNy1k
	h7AFJU7OfAK2i1lAW+Lpzadw9rKFr5khjlOQ+Pl0GSvEDW4SlzYuZ4aoEZc4+rOHeQKj8Cwk
	o2YhGTULyahZSFoWMLKsYpRMLSjOTc8tNiwwzEst1ytOzC0uzUvXS87P3cQIjlgtzR2M21d9
	0DvEyMTBeIhRgoNZSYR3/brJqUK8KYmVValF+fFFpTmpxYcYpTlYlMR5xV/0pggJpCeWpGan
	phakFsFkmTg4pRqYlCsbvOXlPCunBTi+YJDq+3A1xe8wv0ow/3qbBs5E7lv3dGvvOvKGfnVe
	nuCrZRm8wk3dwjo4wXOfzL5CV/uTiz8KCc8K6+X+/Du8w3Jpu5++JMuVyRNljO8rvPdllWyW
	nuIba/NEydZ/ev32Mwyavyate6rH2xHAIBzZaMJd5btBx/Z83nHusPjSR+y/H9/bO0/h11aP
	jXErlK3zhW3X27NEF996slVf0Kygi/nNO/mJG2Zc6GN+ZbZS8MnpB+85io2mi7FOLpIVeeb1
	0STgSkf6c2b7h6cZSzTW7Foc9Phn93LB1Szf/mc6vt64cnsEy3Pml0eeH3zsemZfOVPV4eBp
	6Teq1abuvzOTY7ESS3FGoqEWc1FxIgAnUgVIRwMAAA==
X-CMS-MailID: 20240103054323epcas5p1c66603ad92fc4af4efda6a4999fbec2e
X-Msg-Generator: CA
Content-Type: text/plain; charset="utf-8"
X-Sendblock-Type: REQ_APPROVE
CMS-TYPE: 105P
DLP-Filter: Pass
X-CFilter-Loop: Reflected
X-CMS-RootMailID: 20231130115055epcas5p4e29befa80877be45dbee308846edc0ba
References: <CGME20231130115055epcas5p4e29befa80877be45dbee308846edc0ba@epcas5p4.samsung.com>
	<20231130115044.53512-1-shradha.t@samsung.com>
	<20231130165514.GW3043@thinkpad> 



> -----Original Message-----
> From: Shradha Todi <shradha.t=40samsung.com>
> Sent: 04 December 2023 14:10
> To: 'Manivannan Sadhasivam' <manivannan.sadhasivam=40linaro.org>
> Cc: 'lpieralisi=40kernel.org' <lpieralisi=40kernel.org>; 'kw=40linux.com'
> <kw=40linux.com>; 'robh=40kernel.org' <robh=40kernel.org>;
> 'bhelgaas=40google.com' <bhelgaas=40google.com>; 'jingoohan1=40gmail.com'
> <jingoohan1=40gmail.com>; 'gustavo.pimentel=40synopsys.com'
> <gustavo.pimentel=40synopsys.com>; 'josh=40joshtriplett.org'
> <josh=40joshtriplett.org>; 'lukas.bulwahn=40gmail.com'
> <lukas.bulwahn=40gmail.com>; 'hongxing.zhu=40nxp.com'
> <hongxing.zhu=40nxp.com>; 'pankaj.dubey=40samsung.com'
> <pankaj.dubey=40samsung.com>; 'linux-kernel=40vger.kernel.org' <linux-
> kernel=40vger.kernel.org>; 'linux-pci=40vger.kernel.org' <linux-
> pci=40vger.kernel.org>
> Subject: RE: =5BPATCH v2 0/3=5D Add support for RAS DES feature in PCIe D=
W
> controller
>=20
>=20
>=20
> > -----Original Message-----
> > From: Manivannan Sadhasivam =5Bmailto:manivannan.sadhasivam=40linaro.or=
g=5D
> > Sent: 30 November 2023 22:25
> > To: Shradha Todi <shradha.t=40samsung.com>
> > Cc: lpieralisi=40kernel.org; kw=40linux.com; robh=40kernel.org;
> > bhelgaas=40google.com; jingoohan1=40gmail.com;
> > gustavo.pimentel=40synopsys.com; josh=40joshtriplett.org;
> > lukas.bulwahn=40gmail.com; hongxing.zhu=40nxp.com;
> > pankaj.dubey=40samsung.com; linux-kernel=40vger.kernel.org; linux-
> > pci=40vger.kernel.org
> > Subject: Re: =5BPATCH v2 0/3=5D Add support for RAS DES feature in PCIe=
 DW
> > controller
> >
> > On Thu, Nov 30, 2023 at 05:20:41PM +0530, Shradha Todi wrote:
> > > DesignWare controller provides a vendor specific extended capability
> > > called RASDES as an IP feature. This extended capability  provides
> > > hardware information like:
> > >  - Debug registers to know the state of the link or controller.
> > >  - Error injection mechanisms to inject various PCIe errors including
> > >    sequence number, CRC
> > >  - Statistical counters to know how many times a particular event
> > >    occurred
> > >
> > > However, in Linux we do not have any generic or custom support to be
> > > able to use this feature in an efficient manner. This is the reason
> > > we are proposing this framework. Debug and bring up time of
> > > high-speed IPs are highly dependent on costlier hardware analyzers
> > > and this solution will in some ways help to reduce the HW analyzer us=
age.
> > >
> > > The debugfs entries can be used to get information about underlying
> > > hardware and can be shared with user space. Separate debugfs entries
> > > has been created to cater to all the DES hooks provided by the contro=
ller.
> > > The debugfs entries interacts with the RASDES registers in the
> > > required sequence and provides the meaningful data to the user. This
> > > eases the effort to understand and use the register information for
> > debugging.
> > >
> > > v1 version was posted long back and for some reasons I couldn't work
> > > on it. I apologize for the long break. I'm restarting this activity
> > > and have taken care of all previous review comments shared.
> > > v1:
> > > https://lore.kernel.org/all/20210518174618.42089-1-shradha.t=40samsun=
g
> > > .c
> > > om/T/
> > >
> >
> > There is already a series floating to add similar functionality via
> > perf
> > subsystem: https://lore.kernel.org/linux-pci/20231121013400.18367-1-
> > xueshuai=40linux.alibaba.com/
> >
> > - Mani
> >
>=20
> Hi Mani,
>=20
> The series proposed in perf includes only time based-analysis and event c=
ounters
> which will monitor performance (Group 6 and 7). The patch or framework th=
at we
> have proposed includes debug information, error injection facility and er=
ror
> counters (Group 0 - 5) which are not included as part of the functionalit=
y
> implemented via perf. In my opinion, these functionalities don't count as
> performance monitoring or counters but rather as debug counters. How abou=
t
> we take this up as a debugfs framework as proposed in my patch?
> Or if others feel it can be taken via perf driver then I am happy to exte=
nd the perf
> driver if authors do not have objection. Let me know what you think of th=
is?
> Meanwhile I will review the perf patches and share my feedback.
>=20

Hello Mani,
Any update on the above comment? IMO, even though the perf patches and this
patchset are both part of the DWC vendor specific capability - RASDES,  the=
y
cover different features. The perf file includes performance based paramete=
rs
like time-based analysis and event counters for count of packets whereas th=
is
patchset includes debugging fields, error injection and event counters for =
count
of errors. I think having a separate debugfs file fits more but would you s=
uggest
we extend the perf file itself?=20

Shradha

> > > Shradha Todi (3):
> > >   PCI: dwc: Add support for vendor specific capability search
> > >   PCI: debugfs: Add support for RASDES framework in DWC
> > >   PCI: dwc: Create debugfs files in DWC driver
> > >
> > >  drivers/pci/controller/dwc/Kconfig            =7C   8 +
> > >  drivers/pci/controller/dwc/Makefile           =7C   1 +
> > >  .../controller/dwc/pcie-designware-debugfs.c  =7C 476
> > ++++++++++++++++++
> > >  .../controller/dwc/pcie-designware-debugfs.h  =7C   0
> > >  drivers/pci/controller/dwc/pcie-designware.c  =7C  20 +
> > > drivers/pci/controller/dwc/pcie-designware.h  =7C  18 +
> > >  6 files changed, 523 insertions(+)
> > >  create mode 100644
> > > drivers/pci/controller/dwc/pcie-designware-debugfs.c
> > >  create mode 100644
> > > drivers/pci/controller/dwc/pcie-designware-debugfs.h
> > >
> > > --
> > > 2.17.1
> > >
> >
> > --
> > =E0=AE=AE=E0=AE=A3=E0=AE=BF=E0=AE=B5=E0=AE=A3=E0=AF=8D=E0=AE=A3=E0=AE=
=A9=E0=AF=8D=20=E0=AE=9A=E0=AE=A4=E0=AE=BE=E0=AE=9A=E0=AE=BF=E0=AE=B5=E0=AE=
=AE=E0=AF=8D=0D=0A=0D=0A

From mboxrd@z Thu Jan  1 00:00:00 1970
Received: from mail-pf1-f170.google.com (mail-pf1-f170.google.com [209.85.210.170])
	(using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 7E9B21A710
	for <linux-kernel@vger.kernel.org>; Thu,  4 Jan 2024 05:50:36 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=linaro.org
Authentication-Results: smtp.subspace.kernel.org; spf=pass smtp.mailfrom=linaro.org
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (2048-bit key) header.d=linaro.org header.i=@linaro.org header.b="XEAWvMiy"
Received: by mail-pf1-f170.google.com with SMTP id d2e1a72fcca58-6d9af1f52bcso72361b3a.3
        for <linux-kernel@vger.kernel.org>; Wed, 03 Jan 2024 21:50:36 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=linaro.org; s=google; t=1704347436; x=1704952236; darn=vger.kernel.org;
        h=in-reply-to:content-transfer-encoding:content-disposition
         :mime-version:references:message-id:subject:cc:to:from:date:from:to
         :cc:subject:date:message-id:reply-to;
        bh=Uf9xX6NGzjv1ISMlid2UcA3oN+qjOMTFEKHCEil84EA=;
        b=XEAWvMiyIvCSukO3FitDAFBdKhzLDI/tvLdqP20JJiSKYV0RUgF9RY4QOGwf2vcmOg
         B6xCMPebYroO3TAJOzXRNnMDXPiL1PncmhuM9r/a2+JcUgLIuOGoRsGMzzHCPKMCjOQ5
         eWrPuDkibkQGauMZhr0/sL3E006QsJboJ7LmdULTglMX9Kon/k5xM011qjeO+k/hwQNh
         Gr5nTFlsuvhuZOEbFiIkoq6FTHzg2eGeBTDOoM3/c66AWC2HztFweJpA3mMop1VJaTlH
         +X163fQX7Bajk39NDTQ5Qiz6agrfGOINFR5bMmckHoyGto6UvTqCaWXoQuYNwATOOBqO
         zIRg==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1704347436; x=1704952236;
        h=in-reply-to:content-transfer-encoding:content-disposition
         :mime-version:references:message-id:subject:cc:to:from:date
         :x-gm-message-state:from:to:cc:subject:date:message-id:reply-to;
        bh=Uf9xX6NGzjv1ISMlid2UcA3oN+qjOMTFEKHCEil84EA=;
        b=OnId4NijarHeRV4Y/9CCM7T0E9D68zOv9Qyi2o64Pw0CQ/gUPHP/zBoIuPmqphdLw3
         tVVPe/teBRlJWdfYIlnpq47d6PXHCwBdqNlXU6sbq9xFTz773cxxxiGqAY4t+amhMWih
         Q7PNCwH3I/S1yB6v6idITGeb563DWYxvAU4A/Y63LNCvGZOSi2l5jPYcPMMZxHmWvAiX
         wzo5WaE6ew2zsbQ1rg/4i7DN71rSJiYunBzoANVeqNrc75iTu2xyscKIyD7n8iHmnelO
         kQ4L/b6Dx3IAiJMUy22ARJ043xVdJw0W1NCrRkfifGfW/u7pa5aj7oteLn0/4uNymyi+
         DKhA==
X-Gm-Message-State: AOJu0YyoWSwKtUvqKgFwCjlTWywIJevfsk6OSR3Ty7tFcC+8u8LWg3d4
	HsGI4DPbisjncvikI7noJNHxZo0RY+Oz
X-Google-Smtp-Source: AGHT+IH+YmP6TkldqOBQ8q7LpIRUpnAuB55Y4aNLVXHxOcIszacbpKTctAPDRpPE0LlZCjBp4X2MWA==
X-Received: by 2002:a05:6a00:2e81:b0:6d9:8d50:55d with SMTP id fd1-20020a056a002e8100b006d98d50055dmr157139pfb.47.1704347435731;
        Wed, 03 Jan 2024 21:50:35 -0800 (PST)
Received: from thinkpad ([220.158.159.72])
        by smtp.gmail.com with ESMTPSA id f22-20020aa78b16000000b006d0d90edd2csm23793210pfd.42.2024.01.03.21.50.31
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Wed, 03 Jan 2024 21:50:35 -0800 (PST)
Date: Thu, 4 Jan 2024 11:20:30 +0530
From: 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org>
To: Shradha Todi <shradha.t@samsung.com>
Cc: lpieralisi@kernel.org, kw@linux.com, robh@kernel.org,
	bhelgaas@google.com, jingoohan1@gmail.com,
	gustavo.pimentel@synopsys.com, josh@joshtriplett.org,
	lukas.bulwahn@gmail.com, hongxing.zhu@nxp.com,
	pankaj.dubey@samsung.com, linux-kernel@vger.kernel.org,
	linux-pci@vger.kernel.org
Subject: Re: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
 controller
Message-ID: <20240104055030.GA3031@thinkpad>
References: <CGME20231130115055epcas5p4e29befa80877be45dbee308846edc0ba@epcas5p4.samsung.com>
 <20231130115044.53512-1-shradha.t@samsung.com>
 <20231130165514.GW3043@thinkpad>
 <000601da3e07$c39e5e00$4adb1a00$@samsung.com>
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <000601da3e07$c39e5e00$4adb1a00$@samsung.com>

On Wed, Jan 03, 2024 at 11:13:20AM +0530, Shradha Todi wrote:
> 
> 
> > -----Original Message-----
> > From: Shradha Todi <shradha.t@samsung.com>
> > Sent: 04 December 2023 14:10
> > To: 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org>
> > Cc: 'lpieralisi@kernel.org' <lpieralisi@kernel.org>; 'kw@linux.com'
> > <kw@linux.com>; 'robh@kernel.org' <robh@kernel.org>;
> > 'bhelgaas@google.com' <bhelgaas@google.com>; 'jingoohan1@gmail.com'
> > <jingoohan1@gmail.com>; 'gustavo.pimentel@synopsys.com'
> > <gustavo.pimentel@synopsys.com>; 'josh@joshtriplett.org'
> > <josh@joshtriplett.org>; 'lukas.bulwahn@gmail.com'
> > <lukas.bulwahn@gmail.com>; 'hongxing.zhu@nxp.com'
> > <hongxing.zhu@nxp.com>; 'pankaj.dubey@samsung.com'
> > <pankaj.dubey@samsung.com>; 'linux-kernel@vger.kernel.org' <linux-
> > kernel@vger.kernel.org>; 'linux-pci@vger.kernel.org' <linux-
> > pci@vger.kernel.org>
> > Subject: RE: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
> > controller
> > 
> > 
> > 
> > > -----Original Message-----
> > > From: Manivannan Sadhasivam [mailto:manivannan.sadhasivam@linaro.org]
> > > Sent: 30 November 2023 22:25
> > > To: Shradha Todi <shradha.t@samsung.com>
> > > Cc: lpieralisi@kernel.org; kw@linux.com; robh@kernel.org;
> > > bhelgaas@google.com; jingoohan1@gmail.com;
> > > gustavo.pimentel@synopsys.com; josh@joshtriplett.org;
> > > lukas.bulwahn@gmail.com; hongxing.zhu@nxp.com;
> > > pankaj.dubey@samsung.com; linux-kernel@vger.kernel.org; linux-
> > > pci@vger.kernel.org
> > > Subject: Re: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
> > > controller
> > >
> > > On Thu, Nov 30, 2023 at 05:20:41PM +0530, Shradha Todi wrote:
> > > > DesignWare controller provides a vendor specific extended capability
> > > > called RASDES as an IP feature. This extended capability  provides
> > > > hardware information like:
> > > >  - Debug registers to know the state of the link or controller.
> > > >  - Error injection mechanisms to inject various PCIe errors including
> > > >    sequence number, CRC
> > > >  - Statistical counters to know how many times a particular event
> > > >    occurred
> > > >
> > > > However, in Linux we do not have any generic or custom support to be
> > > > able to use this feature in an efficient manner. This is the reason
> > > > we are proposing this framework. Debug and bring up time of
> > > > high-speed IPs are highly dependent on costlier hardware analyzers
> > > > and this solution will in some ways help to reduce the HW analyzer usage.
> > > >
> > > > The debugfs entries can be used to get information about underlying
> > > > hardware and can be shared with user space. Separate debugfs entries
> > > > has been created to cater to all the DES hooks provided by the controller.
> > > > The debugfs entries interacts with the RASDES registers in the
> > > > required sequence and provides the meaningful data to the user. This
> > > > eases the effort to understand and use the register information for
> > > debugging.
> > > >
> > > > v1 version was posted long back and for some reasons I couldn't work
> > > > on it. I apologize for the long break. I'm restarting this activity
> > > > and have taken care of all previous review comments shared.
> > > > v1:
> > > > https://lore.kernel.org/all/20210518174618.42089-1-shradha.t@samsung
> > > > .c
> > > > om/T/
> > > >
> > >
> > > There is already a series floating to add similar functionality via
> > > perf
> > > subsystem: https://lore.kernel.org/linux-pci/20231121013400.18367-1-
> > > xueshuai@linux.alibaba.com/
> > >
> > > - Mani
> > >
> > 
> > Hi Mani,
> > 
> > The series proposed in perf includes only time based-analysis and event counters
> > which will monitor performance (Group 6 and 7). The patch or framework that we
> > have proposed includes debug information, error injection facility and error
> > counters (Group 0 - 5) which are not included as part of the functionality
> > implemented via perf. In my opinion, these functionalities don't count as
> > performance monitoring or counters but rather as debug counters. How about
> > we take this up as a debugfs framework as proposed in my patch?
> > Or if others feel it can be taken via perf driver then I am happy to extend the perf
> > driver if authors do not have objection. Let me know what you think of this?
> > Meanwhile I will review the perf patches and share my feedback.
> > 
> 
> Hello Mani,
> Any update on the above comment? IMO, even though the perf patches and this
> patchset are both part of the DWC vendor specific capability - RASDES,  they
> cover different features. The perf file includes performance based parameters
> like time-based analysis and event counters for count of packets whereas this
> patchset includes debugging fields, error injection and event counters for count
> of errors. I think having a separate debugfs file fits more but would you suggest
> we extend the perf file itself? 
> 

For the error injection and counters, we already have the EDAC framework. So
adding them in the DWC driver doesn't make sense to me.

But first check with the perf driver author if they have any plans on adding the
proposed functionality. If they do not have any plan or not working on it, then
look into EDAC.

- Mani

> Shradha
> 
> > > > Shradha Todi (3):
> > > >   PCI: dwc: Add support for vendor specific capability search
> > > >   PCI: debugfs: Add support for RASDES framework in DWC
> > > >   PCI: dwc: Create debugfs files in DWC driver
> > > >
> > > >  drivers/pci/controller/dwc/Kconfig            |   8 +
> > > >  drivers/pci/controller/dwc/Makefile           |   1 +
> > > >  .../controller/dwc/pcie-designware-debugfs.c  | 476
> > > ++++++++++++++++++
> > > >  .../controller/dwc/pcie-designware-debugfs.h  |   0
> > > >  drivers/pci/controller/dwc/pcie-designware.c  |  20 +
> > > > drivers/pci/controller/dwc/pcie-designware.h  |  18 +
> > > >  6 files changed, 523 insertions(+)
> > > >  create mode 100644
> > > > drivers/pci/controller/dwc/pcie-designware-debugfs.c
> > > >  create mode 100644
> > > > drivers/pci/controller/dwc/pcie-designware-debugfs.h
> > > >
> > > > --
> > > > 2.17.1
> > > >
> > >
> > > --
> > > மணிவண்ணன் சதாசிவம்
> 
> 

-- 
மணிவண்ணன் சதாசிவம்

From mboxrd@z Thu Jan  1 00:00:00 1970
Received: from mailout1.samsung.com (mailout1.samsung.com [203.254.224.24])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 84E17626A2
	for <linux-kernel@vger.kernel.org>; Thu, 15 Feb 2024 09:58:23 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=203.254.224.24
ARC-Seal: i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1707991106; cv=none; b=SYnaBUcC1cbdG+GgLTjfCFl6dyz36zHfxZ5PhSAqvLeaNl0RBEFzPes95l4k7RUXyz1cvESzJAMbgPC86t7331Io4ZxNxFxUia/bEGb73pT/lSN0wbH9DEMFPXEDSQkBiDyo//8irGi8jlzAPgKxR4ZQGMxmY8rfDYR2u+OFdl4=
ARC-Message-Signature: i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1707991106; c=relaxed/simple;
	bh=e5vEoZfalQ7ETsoq8w3fcWgduZ0bVqf8JRJGtHVYDXE=;
	h=From:To:Cc:In-Reply-To:Subject:Date:Message-ID:MIME-Version:
	 Content-Type:References; b=hSR13wkSxbNtITjGcag1NGIKJjdmMrWA3TA7+YV0vFRTAOPhGN8Nm66nm98XK9efKG1i2V890SKzwXQSE/L+yVSfZ6NXugwam6o99HZkMo1YmsUSXBqMSgrdHTg5LVUK9e52XHoSMo6Ry/AL664nloAcmiR2DdGy3KKQJIr2Op0=
ARC-Authentication-Results: i=1; smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=samsung.com; spf=pass smtp.mailfrom=samsung.com; dkim=pass (1024-bit key) header.d=samsung.com header.i=@samsung.com header.b=BV1gElW/; arc=none smtp.client-ip=203.254.224.24
Authentication-Results: smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=samsung.com
Authentication-Results: smtp.subspace.kernel.org; spf=pass smtp.mailfrom=samsung.com
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (1024-bit key) header.d=samsung.com header.i=@samsung.com header.b="BV1gElW/"
Received: from epcas5p1.samsung.com (unknown [182.195.41.39])
	by mailout1.samsung.com (KnoxPortal) with ESMTP id 20240215095816epoutp011006d6908cf317963b994ef267a4db1e~0ANpWGr5a1065210652epoutp01P
	for <linux-kernel@vger.kernel.org>; Thu, 15 Feb 2024 09:58:16 +0000 (GMT)
DKIM-Filter: OpenDKIM Filter v2.11.0 mailout1.samsung.com 20240215095816epoutp011006d6908cf317963b994ef267a4db1e~0ANpWGr5a1065210652epoutp01P
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=samsung.com;
	s=mail20170921; t=1707991096;
	bh=ZcRCX4KBMk+YzH589sh1YuW8w7G6ITYKVlq6z2Xqxv4=;
	h=From:To:Cc:In-Reply-To:Subject:Date:References:From;
	b=BV1gElW/siM1FvfUiwfA5nXApynTNvwbw6yV1fI/TBph34aJqPh0ogkPMyScaT67H
	 j52TKvI097vMOIZlWjXYtwHBu6JkjVskMS2HyBnJEWrUWkBjEabUNp7T3x1fWC7xp0
	 2vHXg0WuWsYlesWimTM5SFEdVB/CEzUkor4bqSiQ=
Received: from epsnrtp3.localdomain (unknown [182.195.42.164]) by
	epcas5p3.samsung.com (KnoxPortal) with ESMTP id
	20240215095815epcas5p3736e6b4bf9539b8f7549bc3775f8e09e~0ANon2xWW3195431954epcas5p3N;
	Thu, 15 Feb 2024 09:58:15 +0000 (GMT)
Received: from epsmgec5p1-new.samsung.com (unknown [182.195.38.178]) by
	epsnrtp3.localdomain (Postfix) with ESMTP id 4Tb9VY6T1Zz4x9Pr; Thu, 15 Feb
	2024 09:58:13 +0000 (GMT)
Received: from epcas5p1.samsung.com ( [182.195.41.39]) by
	epsmgec5p1-new.samsung.com (Symantec Messaging Gateway) with SMTP id
	DD.BE.19369.530EDC56; Thu, 15 Feb 2024 18:58:13 +0900 (KST)
Received: from epsmtrp2.samsung.com (unknown [182.195.40.14]) by
	epcas5p1.samsung.com (KnoxPortal) with ESMTPA id
	20240215092510epcas5p1933a0e8f88899a0efa7ee15e89561769~z-wv9TjTA1192011920epcas5p1U;
	Thu, 15 Feb 2024 09:25:10 +0000 (GMT)
Received: from epsmgms1p1new.samsung.com (unknown [182.195.42.41]) by
	epsmtrp2.samsung.com (KnoxPortal) with ESMTP id
	20240215092510epsmtrp24eb6474cb2f7807ba64dcf19d2c9f93a~z-wv71Kw22416124161epsmtrp24;
	Thu, 15 Feb 2024 09:25:10 +0000 (GMT)
X-AuditID: b6c32a50-9e1ff70000004ba9-f5-65cde0356a5b
Received: from epsmtip1.samsung.com ( [182.195.34.30]) by
	epsmgms1p1new.samsung.com (Symantec Messaging Gateway) with SMTP id
	AD.49.08755.678DDC56; Thu, 15 Feb 2024 18:25:10 +0900 (KST)
Received: from FDSFTE462 (unknown [107.122.81.248]) by epsmtip1.samsung.com
	(KnoxPortal) with ESMTPA id
	20240215092508epsmtip1c8d596affb39998795f1a15f13ad8a51~z-wtx9UmN2876028760epsmtip1_;
	Thu, 15 Feb 2024 09:25:08 +0000 (GMT)
From: "Shradha Todi" <shradha.t@samsung.com>
To: "'Manivannan Sadhasivam'" <manivannan.sadhasivam@linaro.org>
Cc: <lpieralisi@kernel.org>, <kw@linux.com>, <robh@kernel.org>,
	<bhelgaas@google.com>, <jingoohan1@gmail.com>,
	<gustavo.pimentel@synopsys.com>, <josh@joshtriplett.org>,
	<lukas.bulwahn@gmail.com>, <hongxing.zhu@nxp.com>,
	<pankaj.dubey@samsung.com>, <linux-kernel@vger.kernel.org>,
	<linux-pci@vger.kernel.org>, <vidyas@nvidia.com>, <gost.dev@samsung.com>
In-Reply-To: <20240104055030.GA3031@thinkpad>
Subject: RE: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
 controller
Date: Thu, 15 Feb 2024 14:55:06 +0530
Message-ID: <0df701da5ff0$df1165a0$9d3430e0$@samsung.com>
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Outlook 16.0
Thread-Index: AQG/Q0WxGB9EWFeblm7N70OL8blxhQGR1/IBAmU4G1oB/2O7JgJFQ8VesP9yRcA=
Content-Language: en-in
X-Brightmail-Tracker: H4sIAAAAAAAAA01TfUwbZRzOe1euBe24FRjvqi7NbU632dJKy45vwoi56GYat2SZ0WFtL5RQ
	rk2vxYkmgmtlMEBmZIPKWN0aHDBFyjcBhp24oEOJEGR8jA3BOZhkAqkbg2DLdcp/z/O8zy/P
	77l7XwEqmsDEgkzGQpsZjYHAQnit1/a8IFXdHqDls7eiSdfHevJmbwdCdk6e4pOO1vOAvLxc
	ySfXnUYyr/hxEDnUWYWRA9XXMdK2auORtr4CHjlpKwwiL7Ys+2xd7XxypE2YEkp1OCb5lNNt
	pcbmEyl3XSFGTYx0YdTM8DmEKjm5gFGNC+0IVdpcB6jmq0uAWnLvUD/1ZlaCntboaLOEZrRG
	XSaTkUi8djj9QLoqRq6QKmLJ/YSE0WTTiUTaQbX0lUyDrwchydEYrD5JrWFZIiopwWy0WmiJ
	3shaEgnapDOYlCYZq8lmrUyGjKEtcQq5/GWVz/hOlt52pgI1jRw68evYAJYHapOKQLAA4kpY
	NnGBVwRCBCK8C8B7jrOAI4sA/u18GCBeAB8O+gk3MvVpA5876AawsP87lCN/Ath234X6XRj+
	EpwZXt3A4XgKLPhr0RciEKD4HALrZX45GJfC++4LiB+H4YfhufIinh/z8Ofh+NDPmN8uxGPh
	tTu5flmIb4X9lTMbFhTfB2u+nEe5fSTw0WxNEJf0Opz9rRxwnkjY96h4YzWILwtgw4MCHjeQ
	Bu0X5wJlwuDc9WY+h8VwaaEb43AGrG2qCAQYoLfJhXA4GfYOVwWq7IENnVGc/Bws//EbhMvd
	AksezwTsQthe/QTvhMtrXYEVtsPqH4aCygDh2FTNsamaY1MFx/9pTsCrA2LaxGZn0FqVSSFl
	6Pf+++FaY7YbbFzzvep2UP/tmswDEAHwAChAiXDhZyU3aJFQp3k/lzYb081WA816gMr3vc+g
	4git0fdOGEu6QhkrV8bExChjo2MURKRw3n5eJ8IzNBY6i6ZNtPnJHCIIFuch6X8c/So1v35A
	+1N+yAH7RA7fo8BDVuqfZRJuVaaat+dV7H7a6ik7lu+9ceXIyAnXWBLaI++6HJTQnHOps3BX
	SLx2/8z0B9PeUqnkSGl4RG3v6EdUn15+dTf83iO6w8pUb5uSIzvico+6Pgx9JsoxOjWtTA5d
	O42crLw3eGXqCzzndyszpM5GGkMbip1w9dXxFUlPS9PAuvaXFm30imOr5FLPabvea6GhPfL4
	i60pSfu+bnxr/MGps07t7buxowrm8/jVle5g0FNTJcnpVhcNNoN3F4dq+g9V7oxbj3pDerfn
	WId0LSy+O9WlYnWDn2zbcfMfR9pxWdu2LaIIeyufJXisXqPYi5pZzb+E9FFSbwQAAA==
X-Brightmail-Tracker: H4sIAAAAAAAAA+NgFjrKIsWRmVeSWpSXmKPExsWy7bCSnG7ZjbOpBotnyFssacqwuHlgJ5PF
	rrsd7Bazts1ltFjxZSa7xf8F+RYNPb9ZLS7vmsNmcXbecTaLlj8tLBYtR9tZLO62dLJaLNr6
	Bahszw52i2vbeR34PXbOusvusWBTqcet17Yem1Z1snncubaHzePJlelMHr3N79g8Nr7bweTR
	t2UVo8eW/Z8ZPT5vkgvgjuKySUnNySxLLdK3S+DKmHyyi71gs0/F7AlNLA2Mt2y6GDk5JARM
	JO73r2fvYuTiEBLYzShxa34fI0RCUuLzxXVMELawxMp/z6GKnjFK7P88nQUkwSagI/Hkyh9m
	EFtEwEGi/e0nFpAiZoFfTBITOj6wQnT8YZR4vvoEK0gVp4CuxJtN88HGCgsESmzd+BbMZhFQ
	lbh9+RxbFyMHB6+ApcThh1UgYV4BQYmTM5+ALWMW0JZ4evMpnL1s4WtmiOsUJH4+XcYKcYSf
	xNPrUxkhasQljv7sYZ7AKDwLyahZSEbNQjJqFpKWBYwsqxglUwuKc9Nziw0LDPNSy/WKE3OL
	S/PS9ZLzczcxgmNaS3MH4/ZVH/QOMTJxMB5ilOBgVhLhndR7JlWINyWxsiq1KD++qDQntfgQ
	ozQHi5I4r/iL3hQhgfTEktTs1NSC1CKYLBMHp1QD07TDi2+o+ihdfpjwP7t55+vpUhHGHW7f
	DDT2/3l+rjdw4sGedu5p72LXGLjucTDNWsDMNfmR6G2z3hJxQc8dz3vKt6v7tkgc9H3ddKd/
	T4xAvxjH7YLLZ+eZqD148L5DZ/bb3oaHSpLc9tce9Lx6YG0ha1sm/fSXpFb0ov0zOK83yDmG
	KlwLlX+/Zlr2tS2liQ9Yrm//LzMvOG3+q6sWDy2Fw6dInWiry/05p8c5JudkGEfzpPMV3hG+
	bIxTFT45BX/atfSE+hXltXFZZhlLz0rEXcq8a+aj+HWjfkH8pQvG23vEFneHuvucNg1xuc8f
	fsNi+esgqa27wnhcA88d63n/0/NUteuFmU0LXdXXK7EUZyQaajEXFScCAPM9wCJYAwAA
X-CMS-MailID: 20240215092510epcas5p1933a0e8f88899a0efa7ee15e89561769
X-Msg-Generator: CA
Content-Type: text/plain; charset="utf-8"
X-Sendblock-Type: REQ_APPROVE
CMS-TYPE: 105P
DLP-Filter: Pass
X-CFilter-Loop: Reflected
X-CMS-RootMailID: 20231130115055epcas5p4e29befa80877be45dbee308846edc0ba
References: <CGME20231130115055epcas5p4e29befa80877be45dbee308846edc0ba@epcas5p4.samsung.com>
	<20231130115044.53512-1-shradha.t@samsung.com>
	<20231130165514.GW3043@thinkpad>
	<000601da3e07$c39e5e00$4adb1a00$@samsung.com>
	<20240104055030.GA3031@thinkpad>



> -----Original Message-----
> From: 'Manivannan Sadhasivam' <manivannan.sadhasivam=40linaro.org>
> Sent: 04 January 2024 11:21
> To: Shradha Todi <shradha.t=40samsung.com>
> Cc: lpieralisi=40kernel.org; kw=40linux.com; robh=40kernel.org;
> bhelgaas=40google.com; jingoohan1=40gmail.com;
> gustavo.pimentel=40synopsys.com; josh=40joshtriplett.org;
> lukas.bulwahn=40gmail.com; hongxing.zhu=40nxp.com;
> pankaj.dubey=40samsung.com; linux-kernel=40vger.kernel.org; linux-
> pci=40vger.kernel.org
> Subject: Re: =5BPATCH v2 0/3=5D Add support for RAS DES feature in PCIe D=
W
> controller
>=20
> On Wed, Jan 03, 2024 at 11:13:20AM +0530, Shradha Todi wrote:
> >
> >
> > > -----Original Message-----
> > > From: Shradha Todi <shradha.t=40samsung.com>
> > > Sent: 04 December 2023 14:10
> > > To: 'Manivannan Sadhasivam' <manivannan.sadhasivam=40linaro.org>
> > > Cc: 'lpieralisi=40kernel.org' <lpieralisi=40kernel.org>; 'kw=40linux.=
com'
> > > <kw=40linux.com>; 'robh=40kernel.org' <robh=40kernel.org>;
> > > 'bhelgaas=40google.com' <bhelgaas=40google.com>; 'jingoohan1=40gmail.=
com'
> > > <jingoohan1=40gmail.com>; 'gustavo.pimentel=40synopsys.com'
> > > <gustavo.pimentel=40synopsys.com>; 'josh=40joshtriplett.org'
> > > <josh=40joshtriplett.org>; 'lukas.bulwahn=40gmail.com'
> > > <lukas.bulwahn=40gmail.com>; 'hongxing.zhu=40nxp.com'
> > > <hongxing.zhu=40nxp.com>; 'pankaj.dubey=40samsung.com'
> > > <pankaj.dubey=40samsung.com>; 'linux-kernel=40vger.kernel.org' <linux=
-
> > > kernel=40vger.kernel.org>; 'linux-pci=40vger.kernel.org' <linux-
> > > pci=40vger.kernel.org>
> > > Subject: RE: =5BPATCH v2 0/3=5D Add support for RAS DES feature in PC=
Ie
> > > DW controller
> > >
> > >
> > >
> > > > -----Original Message-----
> > > > From: Manivannan Sadhasivam
> > > > =5Bmailto:manivannan.sadhasivam=40linaro.org=5D
> > > > Sent: 30 November 2023 22:25
> > > > To: Shradha Todi <shradha.t=40samsung.com>
> > > > Cc: lpieralisi=40kernel.org; kw=40linux.com; robh=40kernel.org;
> > > > bhelgaas=40google.com; jingoohan1=40gmail.com;
> > > > gustavo.pimentel=40synopsys.com; josh=40joshtriplett.org;
> > > > lukas.bulwahn=40gmail.com; hongxing.zhu=40nxp.com;
> > > > pankaj.dubey=40samsung.com; linux-kernel=40vger.kernel.org; linux-
> > > > pci=40vger.kernel.org
> > > > Subject: Re: =5BPATCH v2 0/3=5D Add support for RAS DES feature in
> > > > PCIe DW controller
> > > >
> > > > On Thu, Nov 30, 2023 at 05:20:41PM +0530, Shradha Todi wrote:
> > > > > DesignWare controller provides a vendor specific extended
> > > > > capability called RASDES as an IP feature. This extended
> > > > > capability  provides hardware information like:
> > > > >  - Debug registers to know the state of the link or controller.
> > > > >  - Error injection mechanisms to inject various PCIe errors inclu=
ding
> > > > >    sequence number, CRC
> > > > >  - Statistical counters to know how many times a particular event
> > > > >    occurred
> > > > >
> > > > > However, in Linux we do not have any generic or custom support
> > > > > to be able to use this feature in an efficient manner. This is
> > > > > the reason we are proposing this framework. Debug and bring up
> > > > > time of high-speed IPs are highly dependent on costlier hardware
> > > > > analyzers and this solution will in some ways help to reduce the =
HW
> analyzer usage.
> > > > >
> > > > > The debugfs entries can be used to get information about
> > > > > underlying hardware and can be shared with user space. Separate
> > > > > debugfs entries has been created to cater to all the DES hooks pr=
ovided
> by the controller.
> > > > > The debugfs entries interacts with the RASDES registers in the
> > > > > required sequence and provides the meaningful data to the user.
> > > > > This eases the effort to understand and use the register
> > > > > information for
> > > > debugging.
> > > > >
> > > > > v1 version was posted long back and for some reasons I couldn't
> > > > > work on it. I apologize for the long break. I'm restarting this
> > > > > activity and have taken care of all previous review comments shar=
ed.
> > > > > v1:
> > > > > https://lore.kernel.org/all/20210518174618.42089-1-shradha.t=40sa=
m
> > > > > sung
> > > > > .c
> > > > > om/T/
> > > > >
> > > >
> > > > There is already a series floating to add similar functionality
> > > > via perf
> > > > subsystem:
> > > > https://lore.kernel.org/linux-pci/20231121013400.18367-1-
> > > > xueshuai=40linux.alibaba.com/
> > > >
> > > > - Mani
> > > >
> > >
> > > Hi Mani,
> > >
> > > The series proposed in perf includes only time based-analysis and
> > > event counters which will monitor performance (Group 6 and 7). The
> > > patch or framework that we have proposed includes debug information,
> > > error injection facility and error counters (Group 0 - 5) which are
> > > not included as part of the functionality implemented via perf. In
> > > my opinion, these functionalities don't count as performance
> > > monitoring or counters but rather as debug counters. How about we tak=
e this
> up as a debugfs framework as proposed in my patch?
> > > Or if others feel it can be taken via perf driver then I am happy to
> > > extend the perf driver if authors do not have objection. Let me know =
what
> you think of this?
> > > Meanwhile I will review the perf patches and share my feedback.
> > >
> >
> > Hello Mani,
> > Any update on the above comment? IMO, even though the perf patches and
> > this patchset are both part of the DWC vendor specific capability -
> > RASDES,  they cover different features. The perf file includes
> > performance based parameters like time-based analysis and event
> > counters for count of packets whereas this patchset includes debugging
> > fields, error injection and event counters for count of errors. I
> > think having a separate debugfs file fits more but would you suggest we=
 extend
> the perf file itself?
> >
>=20
> For the error injection and counters, we already have the EDAC framework.=
 So
> adding them in the DWC driver doesn't make sense to me.
>=20

Sorry for late response, was going through the EDAC framework to understand=
 better how we can fit RAS DES support in it. Below are some technical chal=
lenges found so far:
1: This debugfs framework proposed =5B1=5D can run on both side of the link=
 i.e. RC and EP as it will be a part of the link controller platform driver=
. Here for the EP side the assumption is that it has Linux running, which i=
s primarily a use case for chip-to-chip communication.  After your suggesti=
on to migrate to EDAC framework we studied and here are the findings:
- If we move to EDAC framework, we need to have RAS DES as a pci_driver whi=
ch will be binded based on vendor_id and device_id. Our observation is that=
 on EP side system we are unable to bind two function driver (pci_driver), =
as pci_endpoint_test function driver or some other chip-to-chip function dr=
iver will already be bound. On the other hand, on RC side we observed that =
if we have portdrv enabled in Linux running on RC system, it gets bound to =
RC controller and then it does not allow EDAC pci_driver to bind. So basica=
lly we see a problem here, that we can't have two pci_driver binding to sam=
e PCI device
2: Another point is even though we use EDAC driver framework, we may not be=
 able to use any of EDAC framework APIs as they are mostly suitable for mem=
ory controller devices sitting on PCI BUS. We will end up using debugfs ent=
ries just via a pci_driver placed inside EDAC framework.

Please let me know if my understanding is wrong.

> But first check with the perf driver author if they have any plans on add=
ing the
> proposed functionality. If they do not have any plan or not working on it=
, then
> look into EDAC.
>=20
> - Mani
>=20

Since we already worked and posted patches =5B1=5D, =5B2=5D, we will contin=
ue to work on this and based on consent from community we will adopt to mos=
t suitable framework.
We see many subsystems like ethernet, usb, gpu, cxl having debugfs files th=
at give information about the current status of the running system and as o=
f now based on our findings, we still feel there is no harm in having debug=
fs entry based support in DesignWare controller driver itself.=20
Others any opinion please?

=5B1=5D: https://lkml.org/lkml/2021/5/18/1371
=5B2=5D: https://lkml.org/lkml/2023/11/30/574

> > Shradha
> >
> > > > > Shradha Todi (3):
> > > > >   PCI: dwc: Add support for vendor specific capability search
> > > > >   PCI: debugfs: Add support for RASDES framework in DWC
> > > > >   PCI: dwc: Create debugfs files in DWC driver
> > > > >
> > > > >  drivers/pci/controller/dwc/Kconfig            =7C   8 +
> > > > >  drivers/pci/controller/dwc/Makefile           =7C   1 +
> > > > >  .../controller/dwc/pcie-designware-debugfs.c  =7C 476
> > > > ++++++++++++++++++
> > > > >  .../controller/dwc/pcie-designware-debugfs.h  =7C   0
> > > > >  drivers/pci/controller/dwc/pcie-designware.c  =7C  20 +
> > > > > drivers/pci/controller/dwc/pcie-designware.h  =7C  18 +
> > > > >  6 files changed, 523 insertions(+)  create mode 100644
> > > > > drivers/pci/controller/dwc/pcie-designware-debugfs.c
> > > > >  create mode 100644
> > > > > drivers/pci/controller/dwc/pcie-designware-debugfs.h
> > > > >
> > > > > --
> > > > > 2.17.1
> > > > >
> > > >
> > > > --
> > > > =E0=AE=AE=E0=AE=A3=E0=AE=BF=E0=AE=B5=E0=AE=A3=E0=AF=8D=E0=AE=A3=E0=
=AE=A9=E0=AF=8D=20=E0=AE=9A=E0=AE=A4=E0=AE=BE=E0=AE=9A=E0=AE=BF=E0=AE=B5=E0=
=AE=AE=E0=AF=8D=0D=0A>=20>=0D=0A>=20>=0D=0A>=20=0D=0A>=20--=0D=0A>=20=E0=AE=
=AE=E0=AE=A3=E0=AE=BF=E0=AE=B5=E0=AE=A3=E0=AF=8D=E0=AE=A3=E0=AE=A9=E0=AF=8D=
=20=E0=AE=9A=E0=AE=A4=E0=AE=BE=E0=AE=9A=E0=AE=BF=E0=AE=B5=E0=AE=AE=E0=AF=8D=
=0D=0A=0D=0A

From mboxrd@z Thu Jan  1 00:00:00 1970
Received: from mail-pf1-f178.google.com (mail-pf1-f178.google.com [209.85.210.178])
	(using TLSv1.2 with cipher ECDHE-RSA-AES128-GCM-SHA256 (128/128 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 2451612C522
	for <linux-kernel@vger.kernel.org>; Fri, 16 Feb 2024 13:49:27 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=209.85.210.178
ARC-Seal: i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1708091369; cv=none; b=uQ/M16porTOA6AbhK0zApXTZRSSH01nkwZBfHGkGwHiiKl0R54lI936nEgW++E2gJHX7lrnff5Ej9y3WinG2GXgcVSI3BVQgpkVLeB9XjvZhy7DOjaJYSduJjF00D/a0BEaZVLt2zYPsbvER4t2CWyWbmx68ES7PMR5VDXtAREI=
ARC-Message-Signature: i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1708091369; c=relaxed/simple;
	bh=9kLgFo3LkOE/31wGty0YH5P7LInCNnttJL4VqlmV8qk=;
	h=Date:From:To:Cc:Subject:Message-ID:References:MIME-Version:
	 Content-Type:Content-Disposition:In-Reply-To; b=lEn2oxbtFv0LZVs8GqGe5qQvLjFdtQ42ZWgjmNHlkHBvFOQqfOTLiin9InNwvmRfp8nIzhIR5qsPpLJGD5wYrBCr4jThTTol0JX8lbJxzbcBMcZmenWlF9BnqwoXKILoQISAO6hXFO4hC8XSKy25E+arA4A6UckXg3QdU274qMA=
ARC-Authentication-Results: i=1; smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=linaro.org; spf=pass smtp.mailfrom=linaro.org; dkim=pass (2048-bit key) header.d=linaro.org header.i=@linaro.org header.b=vD9yhFqJ; arc=none smtp.client-ip=209.85.210.178
Authentication-Results: smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=linaro.org
Authentication-Results: smtp.subspace.kernel.org; spf=pass smtp.mailfrom=linaro.org
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (2048-bit key) header.d=linaro.org header.i=@linaro.org header.b="vD9yhFqJ"
Received: by mail-pf1-f178.google.com with SMTP id d2e1a72fcca58-6e08dd0fa0bso1712284b3a.1
        for <linux-kernel@vger.kernel.org>; Fri, 16 Feb 2024 05:49:27 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=linaro.org; s=google; t=1708091367; x=1708696167; darn=vger.kernel.org;
        h=in-reply-to:content-transfer-encoding:content-disposition
         :mime-version:references:message-id:subject:cc:to:from:date:from:to
         :cc:subject:date:message-id:reply-to;
        bh=rrwIR8b1kDEUZvsSWjQUx/isqJeNcHHG7T0kO10bJRg=;
        b=vD9yhFqJHRFt3etyuMYXsydWEG/mmYqPELIrFa/O2RCYBnJLU2a/pkJoPygdtNhOtk
         L+VSaGo0lwgu8jGGoebhTdbz5qyMZ3xQBhOJZmX26kQI9/Uf3V7m6QevANLKsVjwfS8c
         LXLDyNCaPu5SB3L8VbVVAZKj6m+X82nxbu9RAlsTOWpFAzX3rvyrnlW4vGPdUhg7/LXG
         fF2DYyf2SxFDgCvwMi/i+kxhTz7YBiAfhH+z4iek+0BrAuwhBU41OK+JeJbU+Jo1y7g+
         anS+VcfGO92JzAFNHTsI392qtEda7H1FLBz8JaQYwrP1gHgBk3qGysp/SiKvgrB6n/5s
         ULCA==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20230601; t=1708091367; x=1708696167;
        h=in-reply-to:content-transfer-encoding:content-disposition
         :mime-version:references:message-id:subject:cc:to:from:date
         :x-gm-message-state:from:to:cc:subject:date:message-id:reply-to;
        bh=rrwIR8b1kDEUZvsSWjQUx/isqJeNcHHG7T0kO10bJRg=;
        b=CnL4KJlFWO9ZEMndnj1mXaWNahJHxS7JznHT12edCRya6fCZBW5dsPaZaESKz75LoA
         1yTZaF+k4hAjtpon2LNjTnL4ay/I02p1HeQv3wZCqUfd3Oix9CKnCGnGraFodJIg7wew
         dZL46/QaM1bXLhqq/auHKZSuEmybyXUlPEzuyS//pKoAoJzGpOnCVN7/yWHoJ9Iv7A7G
         nPDWFlgJoxtwGd+NCaVLQlNmRQTuduhMA9ujACbwtiq4c8wUZJkSnyB5e7tjZlaGButq
         nzsujFVYZtooOdrR8yhaHl0mrLr3rfqyXNFL/xFTQjmKpENRelonavCuOKr6EIFFfVS/
         7CFg==
X-Forwarded-Encrypted: i=1; AJvYcCUxupp0RO+5M1CVCPZedwq0B+08TSpLwMlqGqEQhVnIYRcn9hvZju0nD7NcYZQryeN2j0nJTKqIHwuZs+Q7drpp6eCOdJsn0HQg/LRm
X-Gm-Message-State: AOJu0Yyi7QSNPiijT7DrJ3upBAv6M/dnFWeA26g32sg+wx4k85Pvx1OV
	RG/seX6lUfb07oQLLmji/4ELcxIKyMBWEcqiQ+Uf/kXh9ez8u2E7mDE4aEdrCw==
X-Google-Smtp-Source: AGHT+IEEbU+1ADdQDuvVbndmm/EodG2xGil0iXo6JADPsUeC3QjB0e52iItjpm7MRlaMW839PV6uTQ==
X-Received: by 2002:a05:6a00:2daa:b0:6e0:4030:ef77 with SMTP id fb42-20020a056a002daa00b006e04030ef77mr11166464pfb.16.1708091367308;
        Fri, 16 Feb 2024 05:49:27 -0800 (PST)
Received: from thinkpad ([120.138.12.48])
        by smtp.gmail.com with ESMTPSA id lb14-20020a056a004f0e00b006e0436e08edsm3204053pfb.11.2024.02.16.05.49.23
        (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
        Fri, 16 Feb 2024 05:49:26 -0800 (PST)
Date: Fri, 16 Feb 2024 19:19:21 +0530
From: 'Manivannan Sadhasivam' <manivannan.sadhasivam@linaro.org>
To: Shradha Todi <shradha.t@samsung.com>
Cc: lpieralisi@kernel.org, kw@linux.com, robh@kernel.org,
	bhelgaas@google.com, jingoohan1@gmail.com,
	gustavo.pimentel@synopsys.com, josh@joshtriplett.org,
	lukas.bulwahn@gmail.com, hongxing.zhu@nxp.com,
	pankaj.dubey@samsung.com, linux-kernel@vger.kernel.org,
	linux-pci@vger.kernel.org, vidyas@nvidia.com, gost.dev@samsung.com
Subject: Re: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
 controller
Message-ID: <20240216134921.GH2559@thinkpad>
References: <CGME20231130115055epcas5p4e29befa80877be45dbee308846edc0ba@epcas5p4.samsung.com>
 <20231130115044.53512-1-shradha.t@samsung.com>
 <20231130165514.GW3043@thinkpad>
 <000601da3e07$c39e5e00$4adb1a00$@samsung.com>
 <20240104055030.GA3031@thinkpad>
 <0df701da5ff0$df1165a0$9d3430e0$@samsung.com>
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
Content-Transfer-Encoding: 8bit
In-Reply-To: <0df701da5ff0$df1165a0$9d3430e0$@samsung.com>

On Thu, Feb 15, 2024 at 02:55:06PM +0530, Shradha Todi wrote:
> 
> 

[...]

> > For the error injection and counters, we already have the EDAC framework. So
> > adding them in the DWC driver doesn't make sense to me.
> > 
> 
> Sorry for late response, was going through the EDAC framework to understand better how we can fit RAS DES support in it. Below are some technical challenges found so far:
> 1: This debugfs framework proposed [1] can run on both side of the link i.e. RC and EP as it will be a part of the link controller platform driver. Here for the EP side the assumption is that it has Linux running, which is primarily a use case for chip-to-chip communication.  After your suggestion to migrate to EDAC framework we studied and here are the findings:
> - If we move to EDAC framework, we need to have RAS DES as a pci_driver which will be binded based on vendor_id and device_id. Our observation is that on EP side system we are unable to bind two function driver (pci_driver), as pci_endpoint_test function driver or some other chip-to-chip function driver will already be bound. On the other hand, on RC side we observed that if we have portdrv enabled in Linux running on RC system, it gets bound to RC controller and then it does not allow EDAC pci_driver to bind. So basically we see a problem here, that we can't have two pci_driver binding to same PCI device
> 2: Another point is even though we use EDAC driver framework, we may not be able to use any of EDAC framework APIs as they are mostly suitable for memory controller devices sitting on PCI BUS. We will end up using debugfs entries just via a pci_driver placed inside EDAC framework.

Please wrap your replies to 80 characters.

There is no need to bind the edac driver to VID:PID of the device. The edac
driver can be a platform driver and you can instantiate the platform device
from the DWC driver. This way, the PCI device can be assocaited with whatever
driver, but still there can be a separate edac driver for handling errors.

Regarding API limitation, you should ask the maintainer about the possibility of
extending them.

> 
> Please let me know if my understanding is wrong.
> 
> > But first check with the perf driver author if they have any plans on adding the
> > proposed functionality. If they do not have any plan or not working on it, then
> > look into EDAC.
> > 
> > - Mani
> > 
> 
> Since we already worked and posted patches [1], [2], we will continue to work on this and based on consent from community we will adopt to most suitable framework.
> We see many subsystems like ethernet, usb, gpu, cxl having debugfs files that give information about the current status of the running system and as of now based on our findings, we still feel there is no harm in having debugfs entry based support in DesignWare controller driver itself. 

There is no issue in exposing the debug information through debugfs, that's the
sole purpose of the interface. But here, you are trying to add support for DWC
RAS feature for which a dedicated framework already exists.

And there will be more similar requests coming for vendor specific error
protocols as well. So your investigation could benefit everyone.

>From your above investigation, looks like there are some shortcomings of the
EDAC framework. So let's get that clarified by writing to the EDAC maintainers
(keep us in CC). If the EDAC maintainer suggests you to add support for this
feature in DWC driver itself citing some reasons, then no issues with me.

- Mani

-- 
மணிவண்ணன் சதாசிவம்

From mboxrd@z Thu Jan  1 00:00:00 1970
Received: from mailout2.samsung.com (mailout2.samsung.com [203.254.224.25])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 40506374CF
	for <linux-kernel@vger.kernel.org>; Thu, 22 Feb 2024 11:02:50 +0000 (UTC)
Authentication-Results: smtp.subspace.kernel.org; arc=none smtp.client-ip=203.254.224.25
ARC-Seal: i=1; a=rsa-sha256; d=subspace.kernel.org; s=arc-20240116;
	t=1708599772; cv=none; b=gYG4zNsYIb9JP7BJlwZNZQ/ZPlX4lrj71g7pQTka7mOeQ0HzcbcFmexcU17+olfOV08Zj3mFdjKDRCeka/Iai/iORxQk8780jFZyPGtIhhjwY79g+KOyBLexjdrLhijRz8zQMRClWK5Qkl+hbfIQSd4YUSJy+ZmzqIdnvt8b2dA=
ARC-Message-Signature: i=1; a=rsa-sha256; d=subspace.kernel.org;
	s=arc-20240116; t=1708599772; c=relaxed/simple;
	bh=gVNODxT+fq8xEtd0ZpI9uufjY4ghRe6rz4gfD7pnSAQ=;
	h=From:To:Cc:In-Reply-To:Subject:Date:Message-ID:MIME-Version:
	 Content-Type:References; b=cJ+pUxVOHBJqvqDjnYKtZDDhMt5z4gDUmAa+dy/6yBUYhwRh2tp0OpykI4q4MC5C46tAXbkOC+XGIRuPP5qfEC8yHyNWDb4oePKoPfOgq8lWFfA83zGisGtKfOSP0EuqYp49/2VWfreXqNOG6hXKAyScMeuj5y0bpU4tsydyn6g=
ARC-Authentication-Results: i=1; smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=samsung.com; spf=pass smtp.mailfrom=samsung.com; dkim=pass (1024-bit key) header.d=samsung.com header.i=@samsung.com header.b=bPkTZJ1B; arc=none smtp.client-ip=203.254.224.25
Authentication-Results: smtp.subspace.kernel.org; dmarc=pass (p=none dis=none) header.from=samsung.com
Authentication-Results: smtp.subspace.kernel.org; spf=pass smtp.mailfrom=samsung.com
Authentication-Results: smtp.subspace.kernel.org;
	dkim=pass (1024-bit key) header.d=samsung.com header.i=@samsung.com header.b="bPkTZJ1B"
Received: from epcas5p3.samsung.com (unknown [182.195.41.41])
	by mailout2.samsung.com (KnoxPortal) with ESMTP id 20240222110246epoutp028c201744462c0471640f35fcbf2d56db~2Km9RY5-a1199411994epoutp02W
	for <linux-kernel@vger.kernel.org>; Thu, 22 Feb 2024 11:02:46 +0000 (GMT)
DKIM-Filter: OpenDKIM Filter v2.11.0 mailout2.samsung.com 20240222110246epoutp028c201744462c0471640f35fcbf2d56db~2Km9RY5-a1199411994epoutp02W
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=samsung.com;
	s=mail20170921; t=1708599766;
	bh=8PIOFhJsIIMWYPJyMowiCezKsT6vzjmiMmWx/wIf0DE=;
	h=From:To:Cc:In-Reply-To:Subject:Date:References:From;
	b=bPkTZJ1BUKjP1PZ/v9PDX0JSRrr5gRE80VIjQLTEa92lqZn622VIKIx9mst9tBsaj
	 89UeAftbUEIg8nkTb1rP0e33POgxOKo+kV6x2XN6jL97oZrNIrFX/RBN6JV2Cziom7
	 SWcaPbc2MQqVyzqOnt5N2Nwm3q3PN4OpyGBcvfcE=
Received: from epsnrtp4.localdomain (unknown [182.195.42.165]) by
	epcas5p2.samsung.com (KnoxPortal) with ESMTP id
	20240222110245epcas5p21be6d117cb540b0f8f5e6f22ddf9b631~2Km8eTBAS1220712207epcas5p2t;
	Thu, 22 Feb 2024 11:02:45 +0000 (GMT)
Received: from epsmges5p2new.samsung.com (unknown [182.195.38.175]) by
	epsnrtp4.localdomain (Postfix) with ESMTP id 4TgVbl3X2nz4x9Px; Thu, 22 Feb
	2024 11:02:43 +0000 (GMT)
Received: from epcas5p2.samsung.com ( [182.195.41.40]) by
	epsmges5p2new.samsung.com (Symantec Messaging Gateway) with SMTP id
	FD.3D.10009.3D927D56; Thu, 22 Feb 2024 20:02:43 +0900 (KST)
Received: from epsmtrp1.samsung.com (unknown [182.195.40.13]) by
	epcas5p3.samsung.com (KnoxPortal) with ESMTPA id
	20240222110052epcas5p30249ded603442e6419507200ba072ddf~2KlTikoA42617126171epcas5p3-;
	Thu, 22 Feb 2024 11:00:52 +0000 (GMT)
Received: from epsmgmc1p1new.samsung.com (unknown [182.195.42.40]) by
	epsmtrp1.samsung.com (KnoxPortal) with ESMTP id
	20240222110052epsmtrp190ef866fac03b45f81659d76b6d414df~2KlThh8uy0673606736epsmtrp1R;
	Thu, 22 Feb 2024 11:00:52 +0000 (GMT)
X-AuditID: b6c32a4a-ff1ff70000002719-b1-65d729d3b5c3
Received: from epsmtip2.samsung.com ( [182.195.34.31]) by
	epsmgmc1p1new.samsung.com (Symantec Messaging Gateway) with SMTP id
	8F.88.07368.46927D56; Thu, 22 Feb 2024 20:00:52 +0900 (KST)
Received: from FDSFTE462 (unknown [107.122.81.248]) by epsmtip2.samsung.com
	(KnoxPortal) with ESMTPA id
	20240222110049epsmtip2e311e4dffe3492c337bb8a7104a3bb85~2KlQZY8PA2687826878epsmtip2M;
	Thu, 22 Feb 2024 11:00:49 +0000 (GMT)
From: "Shradha Todi" <shradha.t@samsung.com>
To: "'Manivannan Sadhasivam'" <manivannan.sadhasivam@linaro.org>,
	<bp@alien8.de>, <tony.luck@intel.com>, <james.morse@arm.com>,
	<mchehab@kernel.org>, <rric@kernel.org>
Cc: <lpieralisi@kernel.org>, <kw@linux.com>, <robh@kernel.org>,
	<bhelgaas@google.com>, <jingoohan1@gmail.com>,
	<gustavo.pimentel@synopsys.com>, <josh@joshtriplett.org>,
	<lukas.bulwahn@gmail.com>, <hongxing.zhu@nxp.com>,
	<pankaj.dubey@samsung.com>, <linux-kernel@vger.kernel.org>,
	<linux-pci@vger.kernel.org>, <vidyas@nvidia.com>, <gost.dev@samsung.com>,
	<alim.akhtar@samsung.com>
In-Reply-To: <20240216134921.GH2559@thinkpad>
Subject: RE: [PATCH v2 0/3] Add support for RAS DES feature in PCIe DW
 controller
Date: Thu, 22 Feb 2024 16:30:47 +0530
Message-ID: <120d01da657e$66b9d3b0$342d7b10$@samsung.com>
Precedence: bulk
X-Mailing-List: linux-kernel@vger.kernel.org
List-Id: <linux-kernel.vger.kernel.org>
List-Subscribe: <mailto:linux-kernel+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:linux-kernel+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
Content-Transfer-Encoding: quoted-printable
X-Mailer: Microsoft Outlook 16.0
Thread-Index: AQG/Q0WxGB9EWFeblm7N70OL8blxhQGR1/IBAmU4G1oB/2O7JgJFQ8VeAXfQWL0B/DJ/LbDu3RAw
Content-Language: en-in
X-Brightmail-Tracker: H4sIAAAAAAAAA01Te0xTZxTfd3t72xJLrgjxE3nlThLAUakr3UWBuWG2G5ymCYkbMsYaelcI
	pe3aAmMhgyCKNsA0yqMVSxmvjqe0vIeAbCgqTHmoUceAjREBQ3AQCVLnCi0b//3OOb/fd87v
	fDlshouW5c5OlGtolVwsIzAntO1nf7/AMf9HdJC1HZJThjaMrMxOIJev/YORj/s6EbJr4hyL
	1LddBeRkTw1CmlZ0LPKNUUFm5a0zybGuUowcNtzCyBxrDkrmDOSi5ETOeSZZbbYi5A+tKzZu
	dweLvFHbjJDP7/+Okg/buUfcqNUzBShVb6gHVKd+gkUZzSlURfccQj1ZCKPMtecx6reH3Rg1
	M16MUPmnFzGqebEDoQpaagHV0rsMqGWzl8j5VFJoAi2W0CofWh6vkCTKpWHEsai4iLhgYRA/
	kB9Cvkf4yMXJdBhx9BNR4EeJMptpwidVLEuxpURitZo4EB6qUqRoaJ8EhVoTRtBKiUwpUPLU
	4mR1ilzKk9OaQ/ygoIPBNuKXSQlND6oQ5dND3zzN78GyQOsBLeCwIS6Ak8MjmBY4sV3wnwAc
	Mq0i9uBvAI3DU0x78BLAs41WbEtS1vXCUbgO4PTMIMMePANw9pc/0A0Whr8DZ8atmwVXvA7A
	pYpeZKPAwHMZMNscrQVsNgcPhL/WSDbSu/AoWFyo3dSiuC/seT24SefiIdA8O4ja8U54WzeD
	2p/ZD6vLFxj2iXzg2l/VzA3sip+Clns3WHbObjiwlrc5A8QtHPi4t4ZpFxyFRQ1XUDveBedv
	tbDs2B3OfX/WgaXwR0uJo4EMvrRUInb8PuwbL0U35mfg/rCpy7FIT1h4p9Fh0Rnmr8846FzY
	YdjCb8OV192Otnug4eYY8wIg9Nus6bdZ02+zoP+/mxGgtWAPrVQnS2l1sPKgnE7778fjFclm
	sHkUAZEdYHpqidcPEDboB5DNIFy5aNo47cKViNO/pVWKOFWKjFb3g2Dbvi8y3N3iFbarkmvi
	+IKQIIFQKBSEvCvkE7u5C2euSlxwqVhDJ9G0klZt6RA2xz0LSRRYh3ZYvs70DX32QcaaTpHp
	t89V6+1hOckxtjL86mQvbvfF+l4/wcOMe+uXyt66HF0wFqTKqPQ65/X53akHMYtF7KGY0fhw
	6xJxIXJstOGzaycvJlqv1DZEReheedSvdf/5aUlAevb6iY+9E7DR4JIArii2LrqfmuOk8TpC
	vNqfEI/2+4yMNj6HBdXNNw+3RYsu3131PmZSDlOGNd5XTXs9OotSQyNFfBp4Xpp/NW3YsbPx
	SOyb9JjIcCfsnqjgPqf8zlKh54cD4VKC2uebdzrKVC8p/c45Y9CNaaqoOjyfHVmso/lCY8vs
	8Yiy8Yy4OVb56Ejm8apU06TuC5dcLYGqE8T8AIZKLf4X5iz8Np0EAAA=
X-Brightmail-Tracker: H4sIAAAAAAAAA02Sf1CLcRzHfZ/n2bNnnbmnFb44xXPnzGgZ3fnmV7hLj/MPLg7nqmmPftjW
	bOXX+VEaKdaF3NoilRSdX01lZaFcCadCSlPjjxYOuW5cjYQ1XP+9Pvf+8fn88aFwkYuYSiWo
	kzmtWq5kSB+i+gETGKSY08nNf1UYgN4WVJOo5Eg8ct0cIVHX/RoM1fYc5yNz9XmA3twtw9Dl
	ryY++lWYhFJP/uChF7XnSPS04CGJ9MN6AukbMwjUo8/koVLLMIaKq77+8dqsfFRfXoGhT20O
	AnXcFq6YyA4ezSbYqwVXAVtj7uGzhZYU9qLtA8baPy5jLeWZJNvdYSPZ3nYjxhrS+0m2ot+K
	sdmV5YCtvOcCrMsSsG7CVp+lCk6ZsJvTBi+P8Yl/1nmM0GQv3mttcvBSwWNpFhBQkA6BF2oH
	eFnAhxLRdwDsu2bFvcIU6Hp2HfOyH7wy8o7vNfUB+KGjG3gEkp4He9uHcY/gT1cAONB6BngG
	nDbi0H3C8bf3CQbP5rj/5ClKQAfBljKFJ+1Hr4dVFZ9HVxD0LHj3Z/MoC+lQaOlrJrzsCx+Z
	ekcZp+dCZ5fzP5cWffx76gzodpbyPOxPb4W3Wuv5Xs9k2Og+iecAP/OYKvOYKvOYKvOYSCEg
	ysEUTqNTxaliZRqZmtsj1clVuhR1nDQ2SWUBo38hEVuB48KItAFgFGgAkMIZfyGxp50TCRXy
	ffs5bVK0NkXJ6RrANIpgJgtlefkKER0nT+Z2cpyG0/5TMUowNRUramt+GRV4L4YXnj39faZa
	qc0YHyC+tSYtdIub2e5csbz2c7Q4MMgWPjOsbkgV5iu+Y3hvXFAlTq8zBBhVmG1jj70mzDGw
	2Xg0mI4XbJGMi325qO5yVIzQ1NKhPHXgxmu6zLQpDRua0ILyNn5LXKlfzeTmNphk0gi7da1k
	oFh17vThH/VZJbYYZ6LTIK/ZkWfZJijqrBuMKjuYbnBEzA4ZSk74cuXXz5A39sgnoaKLrmkH
	IroHE/px3/x25+ZV0xlDdPXgorRtjau+hy3Qrj60UByX03S2ZPyMEn14L2CoGxldyi/G55GL
	s+xL4K4NE4ObYndpJkn4+YmVl1r1s9sYQhcvl0lwrU7+G3pjpLaGAwAA
X-CMS-MailID: 20240222110052epcas5p30249ded603442e6419507200ba072ddf
X-Msg-Generator: CA
Content-Type: text/plain; charset="utf-8"
X-Sendblock-Type: REQ_APPROVE
CMS-TYPE: 105P
DLP-Filter: Pass
X-CFilter-Loop: Reflected
X-CMS-RootMailID: 20231130115055epcas5p4e29befa80877be45dbee308846edc0ba
References: <CGME20231130115055epcas5p4e29befa80877be45dbee308846edc0ba@epcas5p4.samsung.com>
	<20231130115044.53512-1-shradha.t@samsung.com>
	<20231130165514.GW3043@thinkpad>
	<000601da3e07$c39e5e00$4adb1a00$@samsung.com>
	<20240104055030.GA3031@thinkpad>
	<0df701da5ff0$df1165a0$9d3430e0$@samsung.com>
	<20240216134921.GH2559@thinkpad>

+ Borislav, Tony, James, Mauro, Robert

Hi All,

Synopsys DesignWare PCIe controllers have a vendor specific capability (whi=
ch
means that this set of registers are only present in DesignWare controllers=
)
to perform debug operations called =22RASDES=22.
The functionalities provided by this extended capability are:

1. Debug: This has some debug related diagnostic features like holding LTSS=
M
in certain states, reading the status of lane detection, checking if any PC=
Ie
lanes are broken (RX Valid) and so on. It's a debug only feature used for d=
iagnostic
use-cases.

2. Error Injection: This is a way to inject certain errors in PCIe like LCR=
C, ECRC,
Bad TLPs and so on. Again, this is a debug feature and generally not used i=
n
functional use-case.

3. Statistical counters: This has 3 parts
 - Error counters
 - Non error counters (covered as part of perf =5B1=5D)
 - Time based analysis counters (covered as part of perf =5B1=5D)

Selective features of  the above functionality has been implemented
by vendor specific PCIe controller drivers (pcie-tegra194.c) that use
Synopsys DesignWare PCIe controllers.
In order to make it useful to all vendors using DWC controller, we had
proposed a common implementation in DWC PCIe controller directory
(drivers/pci/controller/dwc/) and our original idea was based on debugfs
filesystem. v1 and v2 are mentioned in =5B2=5D and =5B3=5D.

We got a suggestion to implement this as part of EDAC framework =5B3=5D and
we looked into the same. But as far as I understood, what I am trying to
implement is a very specific feature (only valid for Synopsys DWC PCIe cont=
rollers).
This doesn't seem to fit in very well with the EDAC framework and we can=20
hardly use any of the EDAC framework APIs. We tried implementing a
=22pci_driver=22 but since a function driver will already be running on the=
 EP and
portdrv on the root-complex, we will not be able to bind 2 drivers to a sin=
gle
PCI device (root-complex or endpoint). Ultimately, what I will be doing is
writing a platform driver with debugfs entries which will be present in EDA=
C
directory instead of DWC directory.

Can  you please help us out by going through this thread =5B3=5D and lettin=
g us
know if our understanding is wrong at any point. If you think it is a bette=
r
idea to integrate this in the EDAC framework, can you guide me as
to how I can utilize the framework better?
Please let me know if you need any other information to conclude.

=5B1=5D https://lore.kernel.org/linux-pci/20231121013400.18367-1-xueshuai=
=40linux.alibaba.com/
=5B2=5D https://lore.kernel.org/all/20210518174618.42089-1-shradha.t=40sams=
ung.com/T/
=5B3=5D https://lore.kernel.org/all/20231130115044.53512-1-shradha.t=40sams=
ung.com/

Thanks,
Shradha

> -----Original Message-----
> From: 'Manivannan Sadhasivam' <manivannan.sadhasivam=40linaro.org>
> Sent: 16 February 2024 19:19
> To: Shradha Todi <shradha.t=40samsung.com>
> Cc: lpieralisi=40kernel.org; kw=40linux.com; robh=40kernel.org;
> bhelgaas=40google.com; jingoohan1=40gmail.com;
> gustavo.pimentel=40synopsys.com; josh=40joshtriplett.org;
> lukas.bulwahn=40gmail.com; hongxing.zhu=40nxp.com;
> pankaj.dubey=40samsung.com; linux-kernel=40vger.kernel.org; linux-
> pci=40vger.kernel.org; vidyas=40nvidia.com; gost.dev=40samsung.com
> Subject: Re: =5BPATCH v2 0/3=5D Add support for RAS DES feature in PCIe D=
W
> controller
>=20
> On Thu, Feb 15, 2024 at 02:55:06PM +0530, Shradha Todi wrote:
> >
> >
>=20
> =5B...=5D
>=20
> > > For the error injection and counters, we already have the EDAC
> > > framework. So adding them in the DWC driver doesn't make sense to me.
> > >
> >
> > Sorry for late response, was going through the EDAC framework to unders=
tand
> better how we can fit RAS DES support in it. Below are some technical cha=
llenges
> found so far:
> > 1: This debugfs framework proposed =5B1=5D can run on both side of the =
link i.e. RC
> and EP as it will be a part of the link controller platform driver. Here =
for the EP
> side the assumption is that it has Linux running, which is primarily a us=
e case for
> chip-to-chip communication.  After your suggestion to migrate to EDAC
> framework we studied and here are the findings:
> > - If we move to EDAC framework, we need to have RAS DES as a
> > pci_driver which will be binded based on vendor_id and device_id. Our
> > observation is that on EP side system we are unable to bind two
> > function driver (pci_driver), as pci_endpoint_test function driver or
> > some other chip-to-chip function driver will already be bound. On the
> > other hand, on RC side we observed that if we have portdrv enabled in
> > Linux running on RC system, it gets bound to RC controller and then it
> > does not allow EDAC pci_driver to bind. So basically we see a problem
> > here, that we can't have two pci_driver binding to same PCI device
> > 2: Another point is even though we use EDAC driver framework, we may no=
t be
> able to use any of EDAC framework APIs as they are mostly suitable for me=
mory
> controller devices sitting on PCI BUS. We will end up using debugfs entri=
es just via
> a pci_driver placed inside EDAC framework.
>=20
> Please wrap your replies to 80 characters.
>=20
> There is no need to bind the edac driver to VID:PID of the device. The ed=
ac driver
> can be a platform driver and you can instantiate the platform device from=
 the
> DWC driver. This way, the PCI device can be assocaited with whatever driv=
er, but
> still there can be a separate edac driver for handling errors.
>=20
> Regarding API limitation, you should ask the maintainer about the possibi=
lity of
> extending them.
>=20
> >
> > Please let me know if my understanding is wrong.
> >
> > > But first check with the perf driver author if they have any plans
> > > on adding the proposed functionality. If they do not have any plan
> > > or not working on it, then look into EDAC.
> > >
> > > - Mani
> > >
> >
> > Since we already worked and posted patches =5B1=5D, =5B2=5D, we will co=
ntinue to work
> on this and based on consent from community we will adopt to most suitabl=
e
> framework.
> > We see many subsystems like ethernet, usb, gpu, cxl having debugfs file=
s that
> give information about the current status of the running system and as of=
 now
> based on our findings, we still feel there is no harm in having debugfs e=
ntry based
> support in DesignWare controller driver itself.
>=20
> There is no issue in exposing the debug information through debugfs, that=
's the
> sole purpose of the interface. But here, you are trying to add support fo=
r DWC
> RAS feature for which a dedicated framework already exists.
>=20
> And there will be more similar requests coming for vendor specific error =
protocols
> as well. So your investigation could benefit everyone.
>=20
> From your above investigation, looks like there are some shortcomings of =
the
> EDAC framework. So let's get that clarified by writing to the EDAC mainta=
iners
> (keep us in CC). If the EDAC maintainer suggests you to add support for t=
his
> feature in DWC driver itself citing some reasons, then no issues with me.
>=20
> - Mani
>=20
> --
> =E0=AE=AE=E0=AE=A3=E0=AE=BF=E0=AE=B5=E0=AE=A3=E0=AF=8D=E0=AE=A3=E0=AE=A9=
=E0=AF=8D=20=E0=AE=9A=E0=AE=A4=E0=AE=BE=E0=AE=9A=E0=AE=BF=E0=AE=B5=E0=AE=AE=
=E0=AF=8D=0D=0A=0D=0A

